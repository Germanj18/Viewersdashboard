(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3],{67:function(){},2061:function(){},6745:function(e,t,a){Promise.resolve().then(a.bind(a,5825))},794:function(e,t,a){"use strict";a.d(t,{F:function(){return i},f:function(){return l}});var s=a(7437),r=a(2265);let n=(0,r.createContext)(void 0),l=e=>{let{children:t}=e,[a,l]=(0,r.useState)("dark");return(0,r.useEffect)(()=>{document.documentElement.setAttribute("data-theme",a)},[a]),(0,s.jsx)(n.Provider,{value:{theme:a,toggleTheme:()=>{l(e=>"light"===e?"dark":"light")}},children:t})},i=()=>{let e=(0,r.useContext)(n);if(!e)throw Error("useTheme must be used within a ThemeProvider");return e}},5825:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return v}});var s=a(7437),r=a(998),n=a(6463),l=a(2265),i=a(7800);let o=(0,l.createContext)(void 0),c=e=>{let{children:t}=e,[a,r]=(0,l.useState)(()=>localStorage.getItem("link")||""),[n,c]=(0,l.useState)(()=>{let e=localStorage.getItem("blocks");return e?JSON.parse(e):[{status:[],intervalId:null,isPaused:!1,currentOperation:0,state:"idle",totalOperations:35,title:"Block 1",totalViewers:0,serviceId:335,count:100,decrement:50,operationType:"subtract",autoStart:!1,startTime:""},{status:[],intervalId:null,isPaused:!1,currentOperation:0,state:"idle",totalOperations:35,title:"Block 2",totalViewers:0,serviceId:335,count:100,decrement:50,operationType:"subtract",autoStart:!1,startTime:""},{status:[],intervalId:null,isPaused:!1,currentOperation:0,state:"idle",totalOperations:35,title:"Block 3",totalViewers:0,serviceId:335,count:100,decrement:50,operationType:"subtract",autoStart:!1,startTime:""},{status:[],intervalId:null,isPaused:!1,currentOperation:0,state:"idle",totalOperations:35,title:"Block 4",totalViewers:0,serviceId:335,count:100,decrement:50,operationType:"subtract",autoStart:!1,startTime:""},{status:[],intervalId:null,isPaused:!1,currentOperation:0,state:"idle",totalOperations:35,title:"Block 5",totalViewers:0,serviceId:335,count:100,decrement:50,operationType:"subtract",autoStart:!1,startTime:""},{status:[],intervalId:null,isPaused:!1,currentOperation:0,state:"idle",totalOperations:35,title:"Block 6",totalViewers:0,serviceId:335,count:100,decrement:50,operationType:"subtract",autoStart:!1,startTime:""},{status:[],intervalId:null,isPaused:!1,currentOperation:0,state:"idle",totalOperations:35,title:"Block 7",totalViewers:0,serviceId:335,count:100,decrement:50,operationType:"subtract",autoStart:!1,startTime:""},{status:[],intervalId:null,isPaused:!1,currentOperation:0,state:"idle",totalOperations:35,title:"Block 8",totalViewers:0,serviceId:335,count:100,decrement:50,operationType:"subtract",autoStart:!1,startTime:""}]});(0,l.useEffect)(()=>{localStorage.setItem("blocks",JSON.stringify(n))},[n]),(0,l.useEffect)(()=>{localStorage.setItem("link",a)},[a]),(0,l.useEffect)(()=>{let e=e=>{let t=n.map(e=>"running"===e.state?(clearInterval(e.intervalId),{...e,intervalId:null,isPaused:!0,state:"paused"}):e);localStorage.setItem("blocks",JSON.stringify(t)),localStorage.setItem("link",a),c(t)};return window.addEventListener("beforeunload",e),()=>{window.removeEventListener("beforeunload",e)}},[n,a]),(0,l.useEffect)(()=>{n.forEach((e,t)=>{if(e.autoStart&&e.startTime){let[a,s]=e.startTime.split(":").map(Number),r=new Date,n=new Date(r.getFullYear(),r.getMonth(),r.getDate(),a,s,0,0).getTime()-r.getTime();n>0&&setTimeout(()=>p(t,!0),n)}})},[n]);let u=e=>{switch(e){case 336:return 120;case 337:return 150;case 334:return 60;case 335:return 90;case 338:return 180;case 459:return 240;case 460:return 360;case 657:return 480;default:return 0}},d=e=>{try{console.log("Generando Excel para el bloque: ".concat(e.title));let t=e.status.map(e=>{var t,a;return{Estado:e.status,Mensaje:e.message,Timestamp:e.timestamp,"Order ID":e.orderId,"Order Status":e.orderStatus,"Duraci\xf3n (minutos)":e.duration,"Cantidad de Viewers":e.count,"Costo de la Operaci\xf3n":(null===(a=e.details)||void 0===a?void 0:null===(t=a.res)||void 0===t?void 0:t.sum)||0,...e.details}}),a=new Date("1970-01-01T10:25:00Z"),s=new Date("1970-01-01T23:00:00Z"),r=[],n=new Date(a);for(;n<=s;)isNaN(n.getTime())?console.error("Fecha inv\xe1lida detectada durante la generaci\xf3n de intervalos:",n):r.push({Hora:n.toISOString().substr(11,5)}),n=new Date(n.getTime()+6e4);let l={Hora:"Costo"};e.status.forEach(e=>{if("success"===e.status&&e.count&&e.timestamp){let s=new Date("1970-01-01T".concat(e.timestamp,"Z"));if(isNaN(s.getTime()))console.error("Timestamp inv\xe1lido detectado:",e.timestamp);else{let n=s.toISOString().substr(11,5),i=e.duration||0,o="Operaci\xf3n ".concat(e.orderId);if(!(o in l)){var t,a;l[o]=(null===(a=e.details)||void 0===a?void 0:null===(t=a.res)||void 0===t?void 0:t.sum)||0}r.forEach(e=>{o in e||(e[o]="")});let c=r.findIndex(e=>e.Hora===n);if(-1!==c)for(let t=0;t<i&&c+t<r.length;t++)r[c+t][o]=e.count}}});let o=[l,...r],c=i.P6.json_to_sheet(t),u=i.P6.json_to_sheet(o),d=i.P6.book_new();i.P6.book_append_sheet(d,c,"Resumen de Operaciones"),i.P6.book_append_sheet(d,u,"Viewers por Minuto"),i.NC(d,"".concat(e.title,".xlsx")),console.log("Archivo Excel generado para el bloque: ".concat(e.title))}catch(e){console.error("Error al generar el archivo Excel:",e)}},m=async e=>{if(a&&"running"===n[e].state)try{let{count:t,decrement:s,serviceId:r,operationType:l}=n[e],i=n[e].currentOperation,o="add"===l?t+(s||0)*i:t-(s||0)*i,m=await fetch("/api/proxy?service_id=".concat(r,"&count=").concat(o,"&link=").concat(a)),p=await m.json(),h=new Date().toLocaleTimeString(),x=u(r);console.log("Block ".concat(e+1,", Operation ").concat(i+1,":"),p);let v={status:p.error?"error":"success",message:p.error?"Error en la operaci\xf3n":"Operaci\xf3n exitosa",details:p,timestamp:h,orderId:p.res.order_id,duration:x,count:o,serviceId:r},b=[...n];b[e].status.push(v),"success"===v.status&&(b[e].totalViewers+=o),b[e].currentOperation+=1,b[e].currentOperation>=b[e].totalOperations&&(clearInterval(b[e].intervalId),b[e].intervalId=null,b[e].state="completed",d(b[e])),c(b)}catch(s){console.error("Block ".concat(e+1,", Operation ").concat(n[e].currentOperation+1,":"),s);let t={status:"error",message:"Error en la operaci\xf3n",details:s,timestamp:new Date().toLocaleTimeString(),duration:0},a=[...n];a[e].status.push(t),a[e].currentOperation+=1,a[e].currentOperation>=a[e].totalOperations&&(clearInterval(a[e].intervalId),a[e].intervalId=null,a[e].state="completed",d(a[e])),c(a)}},p=function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1],c(t=>{let a=[...t];if("running"===a[e].state)return t;a[e].isPaused=!1,a[e].state="running",m(e);let s=setInterval(()=>m(e),12e4);return a[e].intervalId=s,a})};return(0,s.jsx)(o.Provider,{value:{blocks:n,link:a,setLink:r,startBlock:p,pauseBlock:e=>{let t=[...n];t[e].intervalId&&(clearInterval(t[e].intervalId),t[e].intervalId=null,t[e].isPaused=!0,t[e].state="paused"),c(t)},resumeBlock:e=>{let t=[...n];t[e].isPaused=!1,t[e].state="running",c(t);let a=setInterval(()=>m(e),12e4);t[e].intervalId=a,c(t),m(e)},finalizeBlock:e=>{c(t=>{let a=[...t];return a[e].intervalId&&(clearInterval(a[e].intervalId),a[e].intervalId=null),"completed"!==a[e].state&&(console.log("Finalizando bloque: ".concat(a[e].title)),a[e].state="completed",d(a[e])),a[e].autoStart=!1,a})},resetBlock:e=>{c(t=>{let a=[...t];return a[e].intervalId&&(clearInterval(a[e].intervalId),a[e].intervalId=null),a[e]={...a[e],status:[],intervalId:null,isPaused:!1,currentOperation:0,state:"idle",totalViewers:0,autoStart:!1,startTime:""},a})},generateExcel:d,editBlock:(e,t)=>{c(a=>{let s=[...a];return!1===t.autoStart&&(t.startTime=""),s[e]={...s[e],...t},s})},editOperation:(e,t,a)=>{let s=[...n];s[e].status[t]={...s[e].status[t],...a},c(s)}},children:t})},u=()=>{let e=(0,l.useContext)(o);if(!e)throw Error("useBlocks must be used within a BlocksProvider");return e};var d=a(794),m=a(3636),p=a(6920),h=a(5079);a(3062);var x=()=>{let{blocks:e,link:t,setLink:a,startBlock:r,pauseBlock:n,resumeBlock:o,finalizeBlock:c,resetBlock:m,generateExcel:p,editBlock:h}=u(),{theme:x}=(0,d.F)(),[v,b]=(0,l.useState)(null),[g,j]=(0,l.useState)(!1),[f,N]=(0,l.useState)(null),[w,k]=(0,l.useState)(null),[I,S]=(0,l.useState)(0),[C,O]=(0,l.useState)(0),[T,y]=(0,l.useState)(0),[E,P]=(0,l.useState)(!1),[D,_]=(0,l.useState)(""),[B,V]=(0,l.useState)(0),[F,A]=(0,l.useState)("subtract"),G=e=>{a(e)},z=t=>{let a=e[t];k(t),S(a.totalOperations||0),O(a.serviceId||0),y(a.count||0),V(a.decrement||0),A(a.operationType||"subtract"),P(a.autoStart||!1),_(a.startTime||"")},H=e.reduce((e,t)=>e+t.totalViewers,0);return(0,s.jsxs)("div",{className:"viewers-container",children:[(0,s.jsx)("input",{type:"text",value:t,onChange:e=>G(e.target.value),placeholder:"Ingrese el enlace de YouTube",className:"input-link ".concat(x)}),(0,s.jsxs)("div",{className:"total-viewers-header",children:["Total de espectadores cargado: ",H]}),(0,s.jsx)("button",{onClick:()=>j(!0),className:"upload-button",children:"Subir Excel"}),(0,s.jsx)("div",{className:"blocks-container",children:e.map((e,t)=>(0,s.jsxs)("div",{className:"block ".concat(x),children:[(0,s.jsx)("h2",{className:"block-title",children:e.title}),e.autoStart&&e.startTime&&(0,s.jsxs)("div",{className:"auto-start-info",children:["Configurado para iniciar autom\xe1ticamente a las ",e.startTime]}),("paused"===e.state||"completed"===e.state)&&(0,s.jsx)("button",{onClick:()=>p(e),className:"download-icon",children:(0,s.jsx)("span",{className:"icon-download"})}),(0,s.jsx)("div",{className:"status",style:{maxHeight:"200px",overflowY:"scroll"},children:Array.from({length:e.totalOperations}).map((t,a)=>(0,s.jsxs)("div",{className:"status-item",children:["Operaci\xf3n ".concat(a+1,": "),e.status[a]?(0,s.jsxs)(s.Fragment,{children:["success"===e.status[a].status?(0,s.jsx)("span",{className:"status-success",children:"✔️"}):(0,s.jsx)("span",{className:"status-error",children:"❌"}),(0,s.jsx)("span",{className:"timestamp",children:e.status[a].timestamp}),e.status[a].orderStatus&&(0,s.jsxs)("span",{className:"order-status",children:[" - ",e.status[a].orderStatus]})]}):(0,s.jsx)("span",{className:"status-pending",children:"⏳"})]},a))}),(0,s.jsxs)("div",{className:"block-controls",children:["idle"===e.state&&(0,s.jsx)("button",{onClick:()=>r(t),className:"start-button",children:"Iniciar"}),"running"===e.state&&(0,s.jsx)("button",{onClick:()=>n(t),className:"pause-button",children:"Pausar"}),"paused"===e.state&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("button",{onClick:()=>o(t),className:"resume-button",children:"Reanudar"}),(0,s.jsx)("button",{onClick:()=>b({type:"finalizar",index:t}),className:"finalize-button",children:"Finalizar"}),(0,s.jsx)("button",{onClick:()=>b({type:"reiniciar",index:t}),className:"reset-button",children:"Reiniciar"})]}),"completed"===e.state&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"completed-message",children:"Bloque finalizado"}),(0,s.jsx)("button",{onClick:()=>b({type:"reiniciar",index:t}),className:"reset-button",children:"Reiniciar"})]}),(0,s.jsx)("button",{onClick:()=>z(t),className:"edit-button",children:"Editar"})]}),(0,s.jsxs)("div",{className:"total-viewers",children:["Total de espectadores: ",e.totalViewers]})]},t))}),v&&(0,s.jsx)("div",{className:"warning-modal",children:(0,s.jsxs)("div",{className:"warning-content ".concat(x),children:[(0,s.jsxs)("p",{children:["Estas por ","finalizar"===v.type?"finalizar":"reiniciar"," este bloque de operaciones, si estas seguro presiona continuar"]}),(0,s.jsx)("button",{onClick:()=>{"finalizar"===v.type?c(v.index):m(v.index),b(null)},className:"continue-button",children:"Continuar"}),(0,s.jsx)("button",{onClick:()=>b(null),className:"cancel-button",children:"Cancelar"})]})}),g&&(0,s.jsx)("div",{className:"modal",children:(0,s.jsxs)("div",{className:"modal-content ".concat(x),children:[(0,s.jsx)("h2",{children:"Subir Excel"}),(0,s.jsx)("input",{type:"file",accept:".xlsx, .xls",onChange:e=>{e.target.files&&N(e.target.files[0])}}),(0,s.jsx)("button",{onClick:()=>{if(!f)return;let e=new FileReader;e.onload=e=>{var t;let a=new Uint8Array(null===(t=e.target)||void 0===t?void 0:t.result),s=i.ij(a,{type:"array"}),r=s.SheetNames[0],n=s.Sheets[r],l=i.P6.sheet_to_json(n,{header:1}).slice(1).map(e=>({Inicio:e[0],Views:e[1],Duracion:e[2],Fin:e[3],Gasto:e[4]})),o=new Date("1970-01-01T10:25:00Z"),c=new Date("1970-01-01T23:00:00Z"),u=[],d=new Date(o);for(;d<=c;)u.push({Hora:d.toISOString().substr(11,5)}),d=new Date(d.getTime()+6e4);let m={Hora:"Costo"};l.forEach((e,t)=>{if(e.Inicio&&"string"==typeof e.Inicio&&e.Views){let[a,s]=e.Inicio.split(":").map(Number),r=new Date(o);r.setHours(a,s,0,0);let n=r.toTimeString().substr(0,5),[l,i]=e.Duracion.split(":").map(Number),c=60*l+i+1,d="Operaci\xf3n ".concat(t+1);m[d]=e.Gasto||0,u.forEach(e=>{d in e||(e[d]="")});let p=u.findIndex(e=>e.Hora===n);if(-1!==p)for(let t=0;t<c&&p+t<u.length;t++)u[p+t][d]=e.Views}});let p=[m,...u],h=i.P6.json_to_sheet(p),x=i.P6.book_new();i.P6.book_append_sheet(x,h,"Viewers por Minuto"),i.NC(x,"ViewersPorMinuto.xlsx")},e.readAsArrayBuffer(f),j(!1)},className:"convert-button",children:"Convertir"}),(0,s.jsx)("button",{onClick:()=>j(!1),className:"close-button",children:"Cerrar"})]})}),null!==w&&(0,s.jsx)("div",{className:"modal",children:(0,s.jsxs)("div",{className:"modal-content ".concat(x),children:[(0,s.jsx)("h2",{children:"Editar Bloque"}),(0,s.jsxs)("label",{children:["Cantidad de Operaciones:",(0,s.jsx)("input",{type:"number",value:I,onChange:e=>S(Number(e.target.value)),className:"input-".concat(x)})]}),(0,s.jsxs)("label",{children:["Duraci\xf3n:",(0,s.jsxs)("select",{value:C,onChange:e=>O(Number(e.target.value)),className:"input-".concat(x),children:[(0,s.jsx)("option",{value:334,children:"1h"}),(0,s.jsx)("option",{value:335,children:"1.30h"}),(0,s.jsx)("option",{value:336,children:"2h"}),(0,s.jsx)("option",{value:337,children:"2.30h"}),(0,s.jsx)("option",{value:338,children:"3h"}),(0,s.jsx)("option",{value:459,children:"4h"}),(0,s.jsx)("option",{value:460,children:"6h"}),(0,s.jsx)("option",{value:657,children:"8h"})]})]}),(0,s.jsx)("div",{style:{color:"#4CAF50",fontWeight:"bold",marginBottom:8},children:"Solo se permiten m\xfaltiplos de 10. Ejemplo: 30, 40, 100, 150..."}),(0,s.jsxs)("label",{children:["Cantidad:",(0,s.jsx)("input",{type:"number",min:0,step:10,value:T,onChange:e=>y(Number(e.target.value)),className:"input-".concat(x," ").concat(T%10!=0?"input-error":"")})]}),(0,s.jsxs)("label",{children:["Cantidad a Restar/Sumar:",(0,s.jsx)("input",{type:"number",min:0,step:10,value:B,onChange:e=>V(Number(e.target.value)),className:"input-".concat(x," ").concat(B%10!=0?"input-error":"")})]}),(0,s.jsxs)("label",{children:["Operaci\xf3n:",(0,s.jsxs)("select",{value:F,onChange:e=>A(e.target.value),className:"input-".concat(x),children:[(0,s.jsx)("option",{value:"add",children:"Sumar"}),(0,s.jsx)("option",{value:"subtract",children:"Restar"})]})]}),(0,s.jsxs)("label",{children:["Inicio Autom\xe1tico:",(0,s.jsx)("input",{type:"checkbox",checked:E,onChange:e=>P(e.target.checked)})]}),E&&(0,s.jsxs)("label",{children:["Hora de Inicio:",(0,s.jsx)("input",{type:"time",value:D,onChange:e=>_(e.target.value),className:"input-".concat(x)})]}),(0,s.jsx)("button",{onClick:()=>{null!==w&&(h(w,{totalOperations:I,serviceId:C,count:T,decrement:B,operationType:F,autoStart:E,startTime:E?D:""}),k(null))},className:"save-button",children:"Guardar"}),(0,s.jsx)("button",{onClick:()=>k(null),className:"cancel-button",children:"Cancelar"})]})})]})};function v(){let{data:e,status:t}=(0,r.useSession)(),{theme:a,toggleTheme:l}=(0,d.F)(),i=(0,n.useRouter)();return"loading"===t?(0,s.jsx)(m.Z,{}):e?(0,s.jsx)(c,{children:(0,s.jsxs)("div",{className:"flex flex-col min-h-screen ".concat("dark"===a?"bg-black text-white":"bg-gray-100 text-black"),children:[(0,s.jsxs)("header",{className:"w-full flex justify-between items-center p-4 ".concat("dark"===a?"bg-black":"bg-white shadow-md"),children:[(0,s.jsx)("h1",{className:"text-2xl font-bold",children:"ServiceDG Dashboard"}),(0,s.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,s.jsx)("button",{onClick:l,className:"bg-gray-700 text-white py-2 px-4 rounded-lg shadow-md hover:bg-gray-600 transition duration-300",children:"dark"===a?(0,s.jsx)(p.G,{icon:h.enB}):(0,s.jsx)(p.G,{icon:h.DBF})}),(0,s.jsx)("button",{onClick:()=>(0,r.signOut)({callbackUrl:"/"}),className:"bg-red-500 text-white py-2 px-4 rounded-lg shadow-md hover:bg-red-600 transition duration-300",children:"Cerrar sesi\xf3n"})]})]}),(0,s.jsxs)("div",{className:"flex flex-1",children:[(0,s.jsxs)("aside",{className:"w-64 flex flex-col items-center py-8 ".concat("dark"===a?"bg-black":"bg-white shadow-md"),children:[(0,s.jsx)("button",{className:"bg-blue-500 text-white py-1 px-2 rounded-lg shadow-md hover:bg-blue-600 transition duration-300 mb-2 text-sm",disabled:!0,children:"Administrar Viewers"}),(0,s.jsx)("button",{onClick:()=>i.push("/pago"),className:"bg-green-500 text-white py-1 px-2 rounded-lg shadow-md hover:bg-green-600 transition duration-300 mb-2 text-sm",children:"Pagos"})]}),(0,s.jsx)("main",{className:"flex-1 flex flex-col items-center justify-start p-8",children:(0,s.jsx)(x,{})})]}),(0,s.jsx)("footer",{className:"w-full p-4 ".concat("dark"===a?"bg-black":"bg-white shadow-md"),children:(0,s.jsx)("p",{className:"text-center",children:"\xa9 2025 ServiceDG. Todos los derechos reservados."})})]})}):(i.replace("/"),null)}},3636:function(e,t,a){"use strict";var s=a(7437);a(2265);var r=a(6648);a(4253),t.Z=()=>(0,s.jsxs)("div",{className:"preloader-container",children:[(0,s.jsx)("div",{className:"preloader-logo",children:(0,s.jsx)(r.default,{src:"/servicedg-logo.svg",alt:"ServiceDG",width:120,height:120,className:"preloader-image"})}),(0,s.jsx)("div",{className:"preloader-text",children:"ServiceDG - An\xe1lisis de Datos"})]})},4253:function(){},3062:function(){}},function(e){e.O(0,[551,229,676,425,168,998,648,971,23,744],function(){return e(e.s=6745)}),_N_E=e.O()}]);