(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3],{67:function(){},2061:function(){},6745:function(e,t,a){Promise.resolve().then(a.bind(a,6072))},794:function(e,t,a){"use strict";a.d(t,{F:function(){return i},f:function(){return o}});var r=a(7437),s=a(2265);let n=(0,s.createContext)(void 0),o=e=>{let{children:t}=e,[a,o]=(0,s.useState)("dark"),[i,l]=(0,s.useState)(!1);return(0,s.useEffect)(()=>{o(localStorage.getItem("theme")||"dark"),l(!0)},[]),(0,s.useEffect)(()=>{i&&(document.documentElement.setAttribute("data-theme",a),document.documentElement.className=a)},[a,i]),(0,r.jsx)(n.Provider,{value:{theme:a,toggleTheme:()=>{o(e=>{let t="light"===e?"dark":"light";return localStorage.setItem("theme",t),t})}},children:i?t:(0,r.jsx)("div",{className:"min-h-screen bg-gray-900 flex items-center justify-center",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"})})})},i=()=>{let e=(0,s.useContext)(n);if(!e)throw Error("useTheme must be used within a ThemeProvider");return e}},6072:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return w}});var r=a(7437),s=a(998),n=a(6463),o=a(794),i=a(3636),l=a(6920),c=a(5079),d=a(2265);let u=(0,d.createContext)(void 0),m=e=>{let{children:t}=e,[a,s]=(0,d.useState)(()=>localStorage.getItem("link")||""),[n,o]=(0,d.useState)({});(0,d.useEffect)(()=>{localStorage.setItem("link",a)},[a]);let i=(0,d.useCallback)((e,t)=>{o(a=>a[e]!==t?{...a,[e]:t}:a)},[]),l=Object.values(n).reduce((e,t)=>e+t,0);return(0,r.jsx)(u.Provider,{value:{link:a,setLink:s,totalViewers:l,updateBlockViewers:i},children:t})},h=()=>{let e=(0,d.useContext)(u);if(!e)throw Error("useGlobal must be used within a GlobalProvider");return e};var p=a(7800),x=e=>{let{initialData:t,link:a,onTotalViewersChange:s,blockId:n,onShowWarning:i,onShowEditModal:l}=e,{theme:c}=(0,o.F)(),u=(0,d.useCallback)(()=>{let e=localStorage.getItem("blockState_".concat(n));if(e)try{let t=JSON.parse(e);if(t.lastSaved){let e=new Date(t.lastSaved);if((new Date().getTime()-e.getTime())/864e5>7)return localStorage.removeItem("blockState_".concat(n)),null}return t}catch(e){console.error("Error parsing saved block state:",e),localStorage.removeItem("blockState_".concat(n))}return null},[n]),[m,h]=(0,d.useState)(()=>{let e=u();return(null==e?void 0:e.status)||[]}),[x,v]=(0,d.useState)(null),[g,b]=(0,d.useState)(!1),[f,j]=(0,d.useState)(()=>{let e=u();return(null==e?void 0:e.currentOperation)||0}),[w,D]=(0,d.useState)(()=>{let e=u(),t=(null==e?void 0:e.state)||"idle";return"running"===t?"paused":t}),[N,S]=(0,d.useState)(()=>{let e=u();return(null==e?void 0:e.totalViewers)||0}),[C,y]=(0,d.useState)(()=>{let e=u();return(null==e?void 0:e.blockData)||t}),k=(0,d.useCallback)(()=>{let e={status:m,currentOperation:f,state:w,totalViewers:N,blockData:C,lastSaved:new Date().toISOString()};localStorage.setItem("blockState_".concat(n),JSON.stringify(e))},[n,m,f,w,N,C]);(0,d.useEffect)(()=>{k()},[m,f,w,N,C,k]);let O=(0,d.useRef)(null),T=(0,d.useRef)(0),I=(0,d.useRef)(w),E=(0,d.useRef)(f),R=(0,d.useRef)(C),B=(0,d.useRef)(m),A=(0,d.useRef)(N);(0,d.useEffect)(()=>{I.current=w},[w]),(0,d.useEffect)(()=>{E.current=f},[f]),(0,d.useEffect)(()=>{R.current=C},[C]),(0,d.useEffect)(()=>{B.current=m},[m]),(0,d.useEffect)(()=>{A.current=N},[N]),(0,d.useEffect)(()=>{if(C.autoStart&&C.startTime&&"idle"===w){let[e,t]=C.startTime.split(":").map(Number),a=new Date,r=new Date(a.getFullYear(),a.getMonth(),a.getDate(),e,t,0,0).getTime()-a.getTime();if(r>0){let e=setTimeout(()=>H(),r);return()=>clearTimeout(e)}}},[C.autoStart,C.startTime,w]),(0,d.useEffect)(()=>{T.current!==N&&(s(n,N),T.current=N)},[N,n,s]),(0,d.useEffect)(()=>{let e=()=>{O.current&&clearInterval(O.current);let e={status:B.current,currentOperation:E.current,state:"running"===I.current?"paused":I.current,totalViewers:A.current,blockData:R.current,lastSaved:new Date().toISOString()};localStorage.setItem("blockState_".concat(n),JSON.stringify(e))};return window.addEventListener("beforeunload",e),()=>{O.current&&clearInterval(O.current),window.removeEventListener("beforeunload",e)}},[n]);let V=e=>{switch(e){case 336:return 120;case 337:return 150;case 334:return 60;case 335:return 90;case 338:return 180;case 459:return 240;case 460:return 360;case 657:return 480;default:return 0}},F=(0,d.useCallback)(()=>{let e=B.current,t=R.current,a=e.map(e=>{var t,a;return{Estado:e.status,Mensaje:e.message,Timestamp:e.timestamp,"Order ID":e.orderId,"Order Status":e.orderStatus,"Duraci\xf3n (minutos)":e.duration,"Cantidad de Viewers":e.count,"Costo de la Operaci\xf3n":(null===(a=e.details)||void 0===a?void 0:null===(t=a.res)||void 0===t?void 0:t.sum)||0,...e.details}}),r=new Date("1970-01-01T10:25:00Z"),s=new Date("1970-01-01T23:00:00Z"),n=[],o=new Date(r);for(;o<=s;)n.push({Hora:o.toISOString().substr(11,5)}),o=new Date(o.getTime()+6e4);let i={Hora:"Costo"};e.forEach(e=>{if("success"===e.status&&e.count&&e.timestamp){let r;try{let t=e.timestamp.match(/(\d{1,2}):(\d{2}):(\d{2})/);if(t){let e=t[1].padStart(2,"0"),a=t[2];r="".concat(e,":").concat(a)}else console.warn("No se pudo parsear el timestamp:",e.timestamp),r="10:25"}catch(t){console.error("Error parseando timestamp:",e.timestamp,t),r="10:25"}let s=e.duration||0,o="Operaci\xf3n ".concat(e.orderId);if(!(o in i)){var t,a;i[o]=(null===(a=e.details)||void 0===a?void 0:null===(t=a.res)||void 0===t?void 0:t.sum)||0}n.forEach(e=>{o in e||(e[o]="")});let l=n.findIndex(e=>e.Hora===r);if(-1!==l)for(let t=0;t<s&&l+t<n.length;t++)n[l+t][o]=e.count}});let l=[i,...n],c=p.P6.json_to_sheet(a),d=p.P6.json_to_sheet(l),u=p.P6.book_new();p.P6.book_append_sheet(u,c,"Resumen de Operaciones"),p.P6.book_append_sheet(u,d,"Viewers por Minuto"),p.NC(u,"".concat(t.title,".xlsx"))},[]),P=(0,d.useCallback)(async()=>{if(!a||"running"!==I.current){console.log("".concat(R.current.title,": No ejecutando API call. Link: ").concat(a,", State: ").concat(I.current));return}try{var e,t;let r=R.current,s=E.current,{count:n,decrement:o,serviceId:i,operationType:l}=r,c="add"===l?n+(o||0)*s:n-(o||0)*s;console.log("".concat(r.title,": Iniciando operaci\xf3n ").concat(s+1," con ").concat(c," viewers"));let d=await fetch("/api/proxy?service_id=".concat(i,"&count=").concat(c,"&link=").concat(a)),u=await d.json(),m=new Date,p=m.toTimeString().split(" ")[0],x=V(i),g=m.toISOString(),b=new Date(m.getTime()+6e4*x).toISOString();console.log("".concat(r.title,", Operation ").concat(s+1,":"),u);let f={status:u.error?"error":"success",message:u.error?"Error en la operaci\xf3n":"Operaci\xf3n exitosa",details:u,timestamp:p,orderId:null===(e=u.res)||void 0===e?void 0:e.order_id,duration:x,count:c,serviceId:i,cost:(null===(t=u.res)||void 0===t?void 0:t.sum)||0,startTime:g,estimatedEndTime:b};h(e=>[...e,f]),_(f),"success"===f.status&&S(e=>e+c);let w=s+1;j(w),w>=r.totalOperations&&(O.current&&(clearInterval(O.current),O.current=null,v(null)),D("completed"),I.current="completed","Notification"in window&&"granted"===Notification.permission&&new Notification("\uD83C\uDF89 ".concat(r.title," Completado"),{body:"El bloque se ha completado exitosamente con ".concat(A.current," viewers totales"),icon:"/favicon.ico"}),setTimeout(()=>F(),1e3))}catch(r){console.error("".concat(R.current.title,", Operation ").concat(E.current+1,":"),r);let e=new Date,t={status:"error",message:"Error en la operaci\xf3n",details:r,timestamp:e.toTimeString().split(" ")[0],duration:0,cost:0,startTime:e.toISOString(),estimatedEndTime:e.toISOString()};h(e=>[...e,t]),_(t);let a=E.current+1;j(a),a>=R.current.totalOperations&&(O.current&&(clearInterval(O.current),O.current=null,v(null)),D("completed"),I.current="completed","Notification"in window&&"granted"===Notification.permission&&new Notification("\uD83C\uDFC1 ".concat(R.current.title," Finalizado"),{body:"El bloque ha finalizado (con errores) - Total viewers: ".concat(A.current),icon:"/favicon.ico"}),setTimeout(()=>F(),1e3))}},[a,F]),H=()=>{if("running"===w)return;b(!1),D("running"),I.current="running",P();let e=setInterval(()=>P(),12e4);O.current=e,v(e)},L=()=>{O.current&&(clearInterval(O.current),O.current=null,v(null)),"completed"!==w&&(D("completed"),I.current="completed","Notification"in window&&"granted"===Notification.permission&&new Notification("\uD83C\uDFC1 ".concat(C.title," Finalizado Manualmente"),{body:"El bloque fue finalizado manualmente con ".concat(N," viewers totales"),icon:"/favicon.ico"}),F()),y(e=>({...e,autoStart:!1}))},z=()=>{M(),O.current&&(clearInterval(O.current),O.current=null,v(null)),h([]),b(!1),j(0),D("idle"),I.current="idle",S(0),y(e=>({...e,autoStart:!1,startTime:""})),localStorage.removeItem("blockState_".concat(n))},q=e=>{y(e)};d.useEffect(()=>(window["updateBlockData_".concat(n)]=q,window["finalizeBlock_".concat(n)]=L,window["resetBlock_".concat(n)]=z,()=>{delete window["updateBlockData_".concat(n)],delete window["finalizeBlock_".concat(n)],delete window["resetBlock_".concat(n)]}),[n]);let _=(0,d.useCallback)(e=>{let t="globalOperationsHistory",a=localStorage.getItem(t),r=[];if(a)try{r=JSON.parse(a)}catch(e){console.error("Error parsing global history:",e),r=[]}let s={...e,blockId:n,blockTitle:C.title,savedAt:new Date().toISOString()};r.push(s),r.length>1e3&&(r=r.slice(-1e3)),localStorage.setItem(t,JSON.stringify(r))},[n,C.title]),M=(0,d.useCallback)(()=>{let e="blockResetHistory",t=localStorage.getItem(e),a=[];if(t)try{a=JSON.parse(t)}catch(e){console.error("Error parsing reset history:",e),a=[]}let r={blockId:n,blockTitle:C.title,resetAt:new Date().toISOString(),operationsLost:m.length,viewersLost:N};a.push(r),a.length>100&&(a=a.slice(-100)),localStorage.setItem(e,JSON.stringify(a))},[n,C.title,m.length,N]);return(0,r.jsxs)("div",{className:"block ".concat(c),children:[(0,r.jsx)("h2",{className:"block-title",children:C.title}),C.autoStart&&C.startTime&&(0,r.jsxs)("div",{className:"auto-start-info",children:["⏰ Inicio autom\xe1tico: ",C.startTime]}),("paused"===w||"completed"===w)&&(0,r.jsx)("button",{onClick:F,className:"download-icon",children:(0,r.jsx)("span",{className:"icon-download"})}),(0,r.jsx)("div",{className:"status",children:Array.from({length:C.totalOperations}).map((e,t)=>(0,r.jsxs)("div",{className:"status-item",children:["Operaci\xf3n ".concat(t+1,": "),m[t]?(0,r.jsxs)(r.Fragment,{children:["success"===m[t].status?(0,r.jsx)("span",{className:"status-success",children:"✅"}):(0,r.jsx)("span",{className:"status-error",children:"❌"}),(0,r.jsx)("span",{className:"timestamp",children:m[t].timestamp}),m[t].orderStatus&&(0,r.jsx)("span",{className:"order-status",children:m[t].orderStatus})]}):(0,r.jsx)("span",{className:"status-pending",children:"⏳"})]},t))}),(0,r.jsxs)("div",{className:"block-controls",children:["idle"===w&&(0,r.jsx)("button",{onClick:H,className:"start-button",children:"▶️ Iniciar"}),"running"===w&&(0,r.jsx)("button",{onClick:()=>{O.current&&(clearInterval(O.current),O.current=null,v(null),b(!0),D("paused"),I.current="paused")},className:"pause-button",children:"⏸️ Pausar"}),"paused"===w&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("button",{onClick:()=>{b(!1),D("running"),I.current="running",P();let e=setInterval(P,12e4);O.current=e,v(e)},className:"resume-button",children:"▶️ Reanudar"}),(0,r.jsx)("button",{onClick:()=>i(n,"finalizar"),className:"finalize-button",children:"\uD83C\uDFC1 Finalizar"}),(0,r.jsx)("button",{onClick:()=>i(n,"reiniciar"),className:"reset-button",children:"\uD83D\uDD04 Reiniciar"})]}),"completed"===w&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"completed-message",children:"✅ Bloque finalizado"}),(0,r.jsx)("button",{onClick:()=>i(n,"reiniciar"),className:"reset-button",children:"\uD83D\uDD04 Reiniciar"})]}),(0,r.jsx)("button",{onClick:()=>{l(n,C)},className:"edit-button",children:"✏️ Editar"})]}),(0,r.jsxs)("div",{className:"total-viewers",children:["\uD83D\uDC65 ",N]})]})};class v{static async requestPermission(){if(!("Notification"in window))return console.warn("Este navegador no soporta notificaciones"),!1;if("granted"===Notification.permission)return this.hasPermission=!0,!0;if("denied"!==Notification.permission){let e=await Notification.requestPermission();return this.hasPermission="granted"===e,this.hasPermission}return!1}static async showNotification(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!this.hasPermission&&!await this.requestPermission())return;let a=new Notification(e,{icon:"/favicon.ico",badge:"/favicon.ico",...t});return setTimeout(()=>{a.close()},5e3),a}static playSound(e){try{let t=new(window.AudioContext||window.webkitAudioContext);({success:[523,659,784],error:[370,415,466],warning:[440,554],info:[523,698]})[e].forEach((e,a)=>{let r=t.createOscillator(),s=t.createGain();r.connect(s),s.connect(t.destination),r.frequency.setValueAtTime(e,t.currentTime),r.type="sine",s.gain.setValueAtTime(0,t.currentTime),s.gain.linearRampToValueAtTime(.1,t.currentTime+.01),s.gain.exponentialRampToValueAtTime(.001,t.currentTime+.3);let n=t.currentTime+.1*a;r.start(n),r.stop(n+.3)})}catch(e){console.warn("No se pudo reproducir el sonido:",e)}}}v.hasPermission=!1;let g=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3e3,r=document.createElement("div");r.className="toast toast-".concat(t),r.innerHTML='\n    <div class="toast-content">\n      <span class="toast-icon">'.concat({success:"✅",error:"❌",warning:"⚠️",info:"ℹ️"}[t]||"ℹ️",'</span>\n      <span class="toast-message">').concat(e,"</span>\n    </div>\n  "),Object.assign(r.style,{position:"fixed",top:"20px",right:"20px",zIndex:"10000",padding:"12px 16px",borderRadius:"8px",color:"white",fontWeight:"500",fontSize:"14px",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.2)",transform:"translateX(100%)",transition:"transform 0.3s ease",maxWidth:"300px",wordWrap:"break-word"}),r.style.background=({success:"linear-gradient(135deg, #10b981, #059669)",error:"linear-gradient(135deg, #ef4444, #dc2626)",warning:"linear-gradient(135deg, #f59e0b, #d97706)",info:"linear-gradient(135deg, #3b82f6, #2563eb)"})[t],document.body.appendChild(r),setTimeout(()=>{r.style.transform="translateX(0)"},10),setTimeout(()=>{r.style.transform="translateX(100%)",setTimeout(()=>{r.parentNode&&r.parentNode.removeChild(r)},300)},a)};a(7653);var b=()=>{let{theme:e}=(0,o.F)(),{totalViewers:t}=h(),[a,s]=(0,d.useState)({totalOperations:0,successfulOperations:0,failedOperations:0,totalCost:0,totalViewers:0,totalResetOperations:0,totalResetViewers:0,operationsPerBlock:{},viewersPerHour:{},viewersByServiceDuration:{},lastUpdated:new Date().toISOString()}),[n,i]=(0,d.useState)([]),[l,c]=(0,d.useState)(!1),u=(0,d.useCallback)(()=>{let e=[],t=localStorage.getItem("globalOperationsHistory");if(t)try{JSON.parse(t).forEach(t=>{e.push({...t,isHistorical:!0})})}catch(e){console.error("Error parsing global history:",e)}return e.sort((e,t)=>{let a=new Date(e.savedAt||e.timestamp);return new Date(t.savedAt||t.timestamp).getTime()-a.getTime()})},[]),m=(0,d.useCallback)(()=>{let e=localStorage.getItem("blockResetHistory");if(e)try{return JSON.parse(e)}catch(e){console.error("Error parsing reset history:",e)}return[]},[]),p=e=>{switch(e){case 334:return 1;case 335:return 1.5;case 336:return 2;case 337:return 2.5;case 338:return 3;case 459:return 4;case 460:return 6;case 657:return 8;default:return 0}},x=()=>0===a.totalOperations?0:a.successfulOperations/a.totalOperations*100,b=(0,d.useCallback)(()=>{let e=u(),t=m(),r=new Blob([JSON.stringify({reportInfo:{generatedAt:new Date().toISOString(),generatedBy:"Dashboard de M\xe9tricas",reportType:"Complete Operations Report",totalOperationsIncludingHistory:e.length,blocksResetCount:t.length},summary:{totalOperations:a.totalOperations,successfulOperations:a.successfulOperations,failedOperations:a.failedOperations,successRate:x(),totalCost:a.totalCost,totalViewers:a.totalViewers,totalResetOperations:a.totalResetOperations,totalResetViewers:a.totalResetViewers,costPerViewer:a.totalViewers>0?a.totalCost/a.totalViewers:0},operationsPerBlock:a.operationsPerBlock,viewersPerHour:a.viewersPerHour,viewersByServiceDuration:a.viewersByServiceDuration,allOperations:e,blockResetHistory:t,alerts:n},null,2)],{type:"application/json"}),s=URL.createObjectURL(r),o=document.createElement("a");o.href=s,o.download="dashboard-report-".concat(new Date().toISOString().split("T")[0],".json"),document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(s),g("\uD83D\uDCC4 Reporte JSON descargado exitosamente","success")},[a,n,u,m]),f=(0,d.useCallback)(()=>{let e=new Blob([[["Fecha y Hora","Hora Inicio","Hora Finalizaci\xf3n","Bloque","Estado","Mensaje","Duraci\xf3n (min)","Viewers","Service ID","Costo","Order ID","Order Status","Es Hist\xf3rico"],...u().map(e=>{let t="N/A",a=e.timestamp;if(e.duration&&(e.savedAt||e.startTime))try{let a=e.savedAt||e.startTime,r=new Date(a);if(!isNaN(r.getTime())){let a=new Date(r.getTime()+6e4*e.duration);if(!isNaN(a.getTime())){let e=a.getHours().toString().padStart(2,"0"),r=a.getMinutes().toString().padStart(2,"0"),s=a.getSeconds().toString().padStart(2,"0");t="".concat(e,":").concat(r,":").concat(s)}}}catch(e){console.warn("Error calculando tiempo de finalizaci\xf3n en CSV:",e),t="N/A"}return[e.timestamp,a||"N/A",t||"N/A","Bloque ".concat(parseInt((e.blockId||"block-0").replace("block-",""))+1),e.status,e.message.replace(/,/g,";"),e.duration||0,e.count||0,e.serviceId||"",e.cost||0,e.orderId||"",e.orderStatus||"",e.isHistorical?"S\xed":"No"]})].map(e=>e.map(e=>'"'.concat(e,'"')).join(",")).join("\n")],{type:"text/csv;charset=utf-8;"}),t=URL.createObjectURL(e),a=document.createElement("a");a.href=t,a.download="operaciones-report-".concat(new Date().toISOString().split("T")[0],".csv"),document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(t),g("\uD83D\uDCCA Reporte CSV descargado exitosamente","success")},[u]),j=(0,d.useCallback)(()=>{let e=u(),t=m(),r=x(),s=new Blob(['<!DOCTYPE html>\n<html lang="es">\n<head>\n    <meta charset="UTF-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <title>Reporte Ejecutivo - Dashboard de M\xe9tricas</title>\n    <style>\n        body { font-family: Arial, sans-serif; margin: 40px; line-height: 1.6; }\n        .header { text-align: center; margin-bottom: 40px; }\n        .logo { color: #4CAF50; font-size: 24px; font-weight: bold; }\n        .summary-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin: 30px 0; }\n        .metric-card { background: #f9f9f9; padding: 20px; border-radius: 8px; border-left: 4px solid #4CAF50; }\n        .metric-value { font-size: 24px; font-weight: bold; color: #333; }\n        .metric-label { color: #666; font-size: 14px; }\n        .operations-table { width: 100%; border-collapse: collapse; margin: 30px 0; }\n        .operations-table th, .operations-table td { border: 1px solid #ddd; padding: 12px; text-align: left; }\n        .operations-table th { background-color: #4CAF50; color: white; }\n        .operations-table tr:nth-child(even) { background-color: #f2f2f2; }\n        .status-success { color: #4CAF50; font-weight: bold; }\n        .status-error { color: #f44336; font-weight: bold; }\n        .historical { background-color: #fff3cd; }\n        .footer { margin-top: 40px; text-align: center; color: #666; font-size: 12px; }\n        .reset-section { margin: 30px 0; padding: 20px; background: #fff3cd; border-radius: 8px; }\n    </style>\n</head>\n<body>\n    <div class="header">\n        <div class="logo">\uD83D\uDCCA REPORTE EJECUTIVO - DASHBOARD DE M\xc9TRICAS</div>\n        <p>Generado el: '.concat(new Date().toLocaleString("es-ES"),"</p>\n        <p><strong>Total de operaciones (incluyendo historial): ").concat(e.length,'</strong></p>\n    </div>\n\n    <div class="summary-grid">\n        <div class="metric-card">\n            <div class="metric-value">').concat(a.totalOperations,'</div>\n            <div class="metric-label">Total Operaciones</div>\n        </div>\n        <div class="metric-card">\n            <div class="metric-value">').concat(r.toFixed(1),'%</div>\n            <div class="metric-label">Tasa de \xc9xito</div>\n        </div>\n        <div class="metric-card">\n            <div class="metric-value">').concat(a.totalViewers.toLocaleString(),'</div>\n            <div class="metric-label">Total Viewers</div>\n        </div>\n        <div class="metric-card">\n            <div class="metric-value">$').concat(a.totalCost.toFixed(2),'</div>\n            <div class="metric-label">Costo Total</div>\n        </div>\n        <div class="metric-card">\n            <div class="metric-value">').concat(a.totalResetOperations,'</div>\n            <div class="metric-label">Operaciones Reseteadas</div>\n        </div>\n        <div class="metric-card">\n            <div class="metric-value">$').concat(a.totalViewers>0?(a.totalCost/a.totalViewers).toFixed(4):"0.0000",'</div>\n            <div class="metric-label">Costo por Viewer</div>\n        </div>\n        <div class="metric-card">\n            <div class="metric-value">').concat(a.totalResetViewers.toLocaleString(),'</div>\n            <div class="metric-label">Viewers Reseteados</div>\n        </div>\n        <div class="metric-card">\n            <div class="metric-value">').concat(t.length,'</div>\n            <div class="metric-label">Bloques Reiniciados</div>\n        </div>\n    </div>\n\n    <h2>\uD83D\uDCC8 Operaciones por Bloque</h2>\n    <table class="operations-table">\n        <thead>\n            <tr>\n                <th>Bloque</th>\n                <th>Operaciones</th>\n                <th>Porcentaje</th>\n            </tr>\n        </thead>\n        <tbody>\n            ').concat(Object.entries(a.operationsPerBlock).map(e=>{let[t,r]=e;return"\n                <tr>\n                    <td>Bloque ".concat(parseInt(t.replace("block-",""))+1,"</td>\n                    <td>").concat(r,"</td>\n                    <td>").concat(a.totalOperations>0?(r/a.totalOperations*100).toFixed(1):0,"%</td>\n                </tr>\n            ")}).join(""),'\n        </tbody>\n    </table>\n\n    <h2>⏱️ Viewers por Duraci\xf3n de Servicio</h2>\n    <table class="operations-table">\n        <thead>\n            <tr>\n                <th>Duraci\xf3n</th>\n                <th>Viewers</th>\n                <th>Porcentaje del Total</th>\n            </tr>\n        </thead>\n        <tbody>\n            ').concat(Object.entries(a.viewersByServiceDuration).sort((e,t)=>{let[a]=e,[r]=t;return parseFloat(a)-parseFloat(r)}).map(e=>{let[t,r]=e;return"\n                <tr>\n                    <td>".concat(t,"</td>\n                    <td>").concat(r.toLocaleString(),"</td>\n                    <td>").concat(a.totalViewers>0?(r/a.totalViewers*100).toFixed(1):0,"%</td>\n                </tr>\n            ")}).join(""),"\n        </tbody>\n    </table>\n\n    ").concat(t.length>0?'\n    <div class="reset-section">\n        <h2>� Historial de Reinicializaciones</h2>\n        <table class="operations-table">\n            <thead>\n                <tr>\n                    <th>Fecha</th>\n                    <th>Bloque</th>\n                    <th>Operaciones Perdidas</th>\n                    <th>Viewers Perdidos</th>\n                </tr>\n            </thead>\n            <tbody>\n                '.concat(t.slice(-10).map(e=>"\n                    <tr>\n                        <td>".concat(new Date(e.resetAt).toLocaleString("es-ES"),"</td>\n                        <td>").concat(e.blockTitle,"</td>\n                        <td>").concat(e.operationsLost,"</td>\n                        <td>").concat(e.viewersLost.toLocaleString(),"</td>\n                    </tr>\n                ")).join(""),"\n            </tbody>\n        </table>\n    </div>\n    "):"",'\n\n    <h2>\uD83D\uDCCB Todas las Operaciones</h2>\n    <p><em>Nota: Las operaciones con fondo amarillo son del historial (de bloques reiniciados)</em></p>\n    <table class="operations-table">\n        <thead>\n            <tr>\n                <th>Fecha y Hora</th>\n                <th>Hora Inicio</th>\n                <th>Finalizaci\xf3n</th>\n                <th>Bloque</th>\n                <th>Estado</th>\n                <th>Viewers</th>\n                <th>Duraci\xf3n</th>\n                <th>Costo</th>\n            </tr>\n        </thead>\n        <tbody>\n            ').concat(e.map(e=>{let t="N/A",a=e.timestamp;if(e.duration&&(e.savedAt||e.startTime))try{let a=e.savedAt||e.startTime,r=new Date(a);if(!isNaN(r.getTime())){let a=new Date(r.getTime()+6e4*e.duration);if(!isNaN(a.getTime())){let e=a.getHours().toString().padStart(2,"0"),r=a.getMinutes().toString().padStart(2,"0"),s=a.getSeconds().toString().padStart(2,"0");t="".concat(e,":").concat(r,":").concat(s)}}}catch(e){console.warn("Error calculando tiempo de finalizaci\xf3n en HTML:",e),t="N/A"}return"\n                <tr ".concat(e.isHistorical?'class="historical"':"",">\n                    <td>").concat(e.timestamp,"</td>\n                    <td>").concat(a||"N/A","</td>\n                    <td>").concat(t||"N/A","</td>\n                    <td>Bloque ").concat(parseInt((e.blockId||"block-0").replace("block-",""))+1,'</td>\n                    <td class="status-').concat(e.status,'">').concat("success"===e.status?"✅ Exitosa":"❌ Fallida","</td>\n                    <td>").concat(e.count||0,"</td>\n                    <td>").concat(e.duration||0," min</td>\n                    <td>$").concat(e.cost||0,"</td>\n                </tr>\n              ")}).join(""),'\n        </tbody>\n    </table>\n\n    <div class="footer">\n        <p>Reporte generado autom\xe1ticamente por Dashboard de M\xe9tricas</p>\n        <p>\xa9 ').concat(new Date().getFullYear()," - Todos los derechos reservados</p>\n        <p><strong>Total de operaciones procesadas: ").concat(e.length,"</strong></p>\n    </div>\n</body>\n</html>")],{type:"text/html;charset=utf-8;"}),n=URL.createObjectURL(s),o=document.createElement("a");o.href=n,o.download="reporte-ejecutivo-".concat(new Date().toISOString().split("T")[0],".html"),document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(n),g("\uD83D\uDCCB Reporte ejecutivo descargado exitosamente","success")},[a,u,m]),w=(0,d.useCallback)(()=>{let e={totalOperations:0,successfulOperations:0,failedOperations:0,totalCost:0,totalViewers:t,totalResetOperations:0,totalResetViewers:0,operationsPerBlock:{},viewersPerHour:{},viewersByServiceDuration:{},lastUpdated:new Date().toISOString()},a=0,r=0;u().forEach(t=>{let s=t.blockId||"block-".concat(t.blockId);if(e.operationsPerBlock[s]=(e.operationsPerBlock[s]||0)+1,e.totalOperations++,"success"===t.status){e.successfulOperations++;let s=t.cost||0;if(e.totalCost+=s,t.duration&&(a+=t.duration,r++),t.timestamp&&t.count){let a=t.timestamp.split(":")[0]+":00";e.viewersPerHour[a]=(e.viewersPerHour[a]||0)+t.count}if(t.serviceId&&t.count){let a=p(t.serviceId),r="".concat(a,"h");e.viewersByServiceDuration[r]=(e.viewersByServiceDuration[r]||0)+t.count}}else e.failedOperations++}),m().forEach(t=>{e.totalResetOperations+=t.operationsLost||0,e.totalResetViewers+=t.viewersLost||0}),s(e)},[t,u]),D=(0,d.useCallback)(()=>{let e=[],t=new Date().toLocaleTimeString(),r=a.totalOperations>0?a.failedOperations/a.totalOperations*100:0;if(r>20&&a.totalOperations>5){let a={id:"high-failure-rate-".concat(Math.floor(r)),type:"error",title:"⚠️ Alta Tasa de Fallo",message:"".concat(r.toFixed(1),"% de operaciones est\xe1n fallando"),timestamp:t};e.push(a)}let s=parseInt(localStorage.getItem("lastKnownViewers")||"0");if(a.totalViewers>s){let r=Math.floor(a.totalViewers/1e3);if(r>Math.floor(s/1e3)&&a.totalViewers>=1e3){let n={id:"milestone-".concat(r,"k-").concat(Date.now()),type:"success",title:"\uD83C\uDFAF Objetivo Alcanzado",message:"\xa1Has alcanzado ".concat(a.totalViewers.toLocaleString()," viewers! (+").concat(a.totalViewers-s," nuevos)"),timestamp:t};e.push(n)}localStorage.setItem("lastKnownViewers",a.totalViewers.toString())}let n=parseFloat(localStorage.getItem("lastKnownCost")||"0");if(a.totalCost>n&&a.totalCost>500){let r={id:"high-cost-".concat(Math.floor(a.totalCost),"-").concat(Date.now()),type:"warning",title:"\uD83D\uDCB0 Costo Elevado",message:"Costo total: $".concat(a.totalCost.toFixed(2)," (+$").concat((a.totalCost-n).toFixed(2),")"),timestamp:t};e.push(r),localStorage.setItem("lastKnownCost",a.totalCost.toString())}else a.totalCost>n&&localStorage.setItem("lastKnownCost",a.totalCost.toString());let o=parseInt(localStorage.getItem("lastKnownOperations")||"0"),i=a.totalOperations-o;if(i>0){if(i>=5){let a={id:"batch-completed-".concat(Date.now()),type:"info",title:"\uD83D\uDCCA Lote Completado",message:"Se completaron ".concat(i," operaciones nuevas"),timestamp:t};e.push(a)}localStorage.setItem("lastKnownOperations",a.totalOperations.toString())}let l=parseInt(localStorage.getItem("lastKnownSuccessful")||"0"),c=a.successfulOperations-l;if(c>0){if(c>=3){let a={id:"success-streak-".concat(Date.now()),type:"success",title:"✅ Racha de \xc9xito",message:"".concat(c," operaciones exitosas completadas"),timestamp:t};e.push(a)}localStorage.setItem("lastKnownSuccessful",a.successfulOperations.toString())}return e},[a]);(0,d.useEffect)(()=>{w();let e=setInterval(w,2e3);return()=>clearInterval(e)},[w]),(0,d.useEffect)(()=>{let e=D();e.length>0&&i(t=>{let a=t.map(e=>e.id),r=e.filter(e=>!a.includes(e.id));return r.forEach(e=>{v.showNotification(e.title,{body:e.message,tag:e.id,silent:"info"===e.type}),v.playSound(e.type),g(e.message,e.type)}),[...t,...r].slice(-10)})},[D]);let N=e=>{i(t=>t.filter(t=>t.id!==e))};return(0,r.jsxs)("div",{className:"metrics-dashboard ".concat(e),children:[(0,r.jsxs)("div",{className:"metrics-header",children:[(0,r.jsx)("h2",{children:"\uD83D\uDCCA Dashboard de M\xe9tricas"}),(0,r.jsxs)("div",{className:"metrics-actions",children:[(0,r.jsxs)("button",{onClick:()=>c(!l),className:"alerts-button ".concat(n.length>0?"has-alerts":""),children:["\uD83D\uDD14 Alertas (",n.length,")"]}),(0,r.jsxs)("div",{className:"export-buttons",style:{display:"flex",gap:"0.5rem",flexWrap:"wrap"},children:[(0,r.jsx)("button",{onClick:b,className:"export-button",title:"Descargar datos completos en JSON",children:"\uD83D\uDCC4 JSON"}),(0,r.jsx)("button",{onClick:f,className:"export-button",title:"Descargar operaciones en CSV",children:"\uD83D\uDCCA CSV"}),(0,r.jsx)("button",{onClick:j,className:"export-button",title:"Descargar reporte ejecutivo",children:"\uD83D\uDCCB Reporte"})]}),(0,r.jsxs)("span",{className:"last-updated",children:["Actualizado: ",new Date(a.lastUpdated).toLocaleTimeString()]})]})]}),l&&(0,r.jsxs)("div",{className:"alerts-panel",children:[(0,r.jsx)("h3",{children:"\uD83D\uDD14 Alertas Recientes"}),0===n.length?(0,r.jsx)("p",{className:"no-alerts",children:"No hay alertas pendientes"}):n.map(e=>(0,r.jsxs)("div",{className:"alert alert-".concat(e.type),children:[(0,r.jsxs)("div",{className:"alert-content",children:[(0,r.jsx)("strong",{children:e.title}),(0,r.jsx)("p",{children:e.message}),(0,r.jsx)("small",{children:e.timestamp})]}),(0,r.jsx)("button",{onClick:()=>N(e.id),className:"alert-close",children:"✕"})]},e.id))]}),(0,r.jsxs)("div",{className:"metrics-grid",children:[(0,r.jsxs)("div",{className:"metric-card",children:[(0,r.jsx)("div",{className:"metric-icon",children:"\uD83D\uDCC8"}),(0,r.jsxs)("div",{className:"metric-content",children:[(0,r.jsx)("h3",{children:"Total Operaciones"}),(0,r.jsx)("div",{className:"metric-value",children:a.totalOperations}),(0,r.jsxs)("div",{className:"metric-subtitle",children:["✅ ",a.successfulOperations," | ❌ ",a.failedOperations]})]})]}),(0,r.jsxs)("div",{className:"metric-card",children:[(0,r.jsx)("div",{className:"metric-icon",children:"\uD83C\uDFAF"}),(0,r.jsxs)("div",{className:"metric-content",children:[(0,r.jsx)("h3",{children:"Tasa de \xc9xito"}),(0,r.jsxs)("div",{className:"metric-value",children:[x().toFixed(1),"%"]}),(0,r.jsx)("div",{className:"metric-subtitle ".concat(x()>=80?"success":x()>=60?"warning":"error"),children:x()>=80?"Excelente":x()>=60?"Buena":"Mejorar"})]})]}),(0,r.jsxs)("div",{className:"metric-card",children:[(0,r.jsx)("div",{className:"metric-icon",children:"\uD83D\uDC65"}),(0,r.jsxs)("div",{className:"metric-content",children:[(0,r.jsx)("h3",{children:"Total Viewers"}),(0,r.jsx)("div",{className:"metric-value",children:a.totalViewers.toLocaleString()}),(0,r.jsx)("div",{className:"metric-subtitle",children:"Acumulados"})]})]}),(0,r.jsxs)("div",{className:"metric-card",children:[(0,r.jsx)("div",{className:"metric-icon",children:"\uD83D\uDCB0"}),(0,r.jsxs)("div",{className:"metric-content",children:[(0,r.jsx)("h3",{children:"Costo Total"}),(0,r.jsxs)("div",{className:"metric-value",children:["$",a.totalCost.toFixed(2)]}),(0,r.jsx)("div",{className:"metric-subtitle",children:"Operaciones exitosas"})]})]}),(0,r.jsxs)("div",{className:"metric-card",children:[(0,r.jsx)("div",{className:"metric-icon",children:"\uD83D\uDD04"}),(0,r.jsxs)("div",{className:"metric-content",children:[(0,r.jsx)("h3",{children:"Operaciones Reseteadas"}),(0,r.jsx)("div",{className:"metric-value",children:a.totalResetOperations}),(0,r.jsx)("div",{className:"metric-subtitle",children:"Total acumulado"})]})]}),(0,r.jsxs)("div",{className:"metric-card",children:[(0,r.jsx)("div",{className:"metric-icon",children:"\uD83D\uDCB5"}),(0,r.jsxs)("div",{className:"metric-content",children:[(0,r.jsx)("h3",{children:"Costo por Viewer"}),(0,r.jsxs)("div",{className:"metric-value",children:["$",a.totalViewers>0?(a.totalCost/a.totalViewers).toFixed(4):"0.0000"]}),(0,r.jsx)("div",{className:"metric-subtitle",children:"Eficiencia"})]})]}),(0,r.jsxs)("div",{className:"metric-card",children:[(0,r.jsx)("div",{className:"metric-icon",children:"\uD83D\uDC65"}),(0,r.jsxs)("div",{className:"metric-content",children:[(0,r.jsx)("h3",{children:"Viewers Reseteados"}),(0,r.jsx)("div",{className:"metric-value",children:a.totalResetViewers.toLocaleString()}),(0,r.jsx)("div",{className:"metric-subtitle",children:"Total acumulado"})]})]})]}),(0,r.jsxs)("div",{className:"charts-section",children:[(0,r.jsxs)("div",{className:"chart-card",children:[(0,r.jsx)("h3",{children:"\uD83D\uDCCA Operaciones por Bloque"}),(0,r.jsx)("div",{className:"simple-chart",children:Object.entries(a.operationsPerBlock).map(e=>{let[t,s]=e;return(0,r.jsxs)("div",{className:"chart-bar",children:[(0,r.jsxs)("div",{className:"bar-label",children:["B",parseInt(t.replace("block-",""))+1]}),(0,r.jsx)("div",{className:"bar-container",children:(0,r.jsx)("div",{className:"bar-fill",style:{width:"".concat(Math.max(10,s/Math.max(...Object.values(a.operationsPerBlock),1)*100),"%")}})}),(0,r.jsx)("div",{className:"bar-value",children:s})]},t)})})]}),(0,r.jsxs)("div",{className:"chart-card",children:[(0,r.jsx)("h3",{children:"⏰ Viewers por Hora"}),(0,r.jsx)("div",{className:"simple-chart",children:Object.entries(a.viewersPerHour).sort((e,t)=>{let[a]=e,[r]=t;return a.localeCompare(r)}).slice(-8).map(e=>{let[t,s]=e;return(0,r.jsxs)("div",{className:"chart-bar",children:[(0,r.jsx)("div",{className:"bar-label",children:t}),(0,r.jsx)("div",{className:"bar-container",children:(0,r.jsx)("div",{className:"bar-fill viewers-bar",style:{width:"".concat(Math.max(10,s/Math.max(...Object.values(a.viewersPerHour),1)*100),"%")}})}),(0,r.jsx)("div",{className:"bar-value",children:s})]},t)})})]}),(0,r.jsxs)("div",{className:"chart-card",children:[(0,r.jsx)("h3",{children:"⏱️ Viewers por Duraci\xf3n de Servicio"}),(0,r.jsx)("div",{className:"simple-chart",children:Object.entries(a.viewersByServiceDuration).sort((e,t)=>{let[a]=e,[r]=t;return parseFloat(a)-parseFloat(r)}).map(e=>{let[t,s]=e;return(0,r.jsxs)("div",{className:"chart-bar",children:[(0,r.jsx)("div",{className:"bar-label",children:t}),(0,r.jsx)("div",{className:"bar-container",children:(0,r.jsx)("div",{className:"bar-fill duration-bar",style:{width:"".concat(Math.max(10,s/Math.max(...Object.values(a.viewersByServiceDuration),1)*100),"%")}})}),(0,r.jsx)("div",{className:"bar-value",children:s.toLocaleString()})]},t)})})]})]}),(0,r.jsx)("div",{className:"recent-operations-section",children:(0,r.jsxs)("div",{className:"chart-card",style:{gridColumn:"1 / -1"},children:[(0,r.jsx)("h3",{children:"\uD83D\uDCCB Todas las Operaciones (con Horarios)"}),(0,r.jsx)("div",{className:"operations-table-container",style:{overflowX:"auto",overflowY:"auto",maxHeight:"400px"},children:(0,r.jsxs)("table",{className:"operations-table",style:{width:"100%",fontSize:"0.85rem"},children:[(0,r.jsx)("thead",{style:{position:"sticky",top:0,backgroundColor:"dark"===e?"#1f2937":"#f9fafb"},children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{children:"Bloque"}),(0,r.jsx)("th",{children:"Estado"}),(0,r.jsx)("th",{children:"Inicio"}),(0,r.jsx)("th",{children:"Finalizaci\xf3n Est."}),(0,r.jsx)("th",{children:"Duraci\xf3n"}),(0,r.jsx)("th",{children:"Viewers"}),(0,r.jsx)("th",{children:"Costo"})]})}),(0,r.jsx)("tbody",{children:u().map((t,a)=>{0===a&&(console.log("\uD83D\uDCCB Total operaciones encontradas:",u().length),console.log("\uD83D\uDCDD Muestra de operaci\xf3n:",t));let s="N/A",n=t.timestamp;if(t.duration&&(t.savedAt||t.startTime))try{let e=t.savedAt||t.startTime,a=new Date(e);if(!isNaN(a.getTime())){let e=new Date(a.getTime()+6e4*t.duration);if(!isNaN(e.getTime())){let t=e.getHours().toString().padStart(2,"0"),a=e.getMinutes().toString().padStart(2,"0"),r=e.getSeconds().toString().padStart(2,"0");s="".concat(t,":").concat(a,":").concat(r)}}}catch(e){console.warn("Error calculando tiempo de finalizaci\xf3n:",e,"Operaci\xf3n:",t)}return(0,r.jsxs)("tr",{style:{backgroundColor:t.isHistorical?"dark"===e?"#451a03":"#fef3c7":"transparent"},children:[(0,r.jsxs)("td",{children:["Bloque ",parseInt((t.blockId||"block-0").replace("block-",""))+1]}),(0,r.jsx)("td",{children:(0,r.jsxs)("span",{style:{color:"success"===t.status?"#10b981":"#ef4444",fontWeight:"bold"},children:["success"===t.status?"✅":"❌"," ",t.status]})}),(0,r.jsx)("td",{children:n||"N/A"}),(0,r.jsx)("td",{children:s}),(0,r.jsxs)("td",{children:[t.duration||0," min"]}),(0,r.jsx)("td",{children:(t.count||0).toLocaleString()}),(0,r.jsxs)("td",{children:["$",(t.cost||0).toFixed(2)]})]},"".concat(t.blockId,"-").concat(t.timestamp,"-").concat(a))})})]})})]})})]})};a(1750);var f=e=>{let{isOpen:t,onDownloadFirst:a,onProceedAnyway:s,onCancel:n,hasData:i}=e,{theme:l}=(0,o.F)();return t?(0,r.jsx)("div",{className:"reset-warning-overlay",children:(0,r.jsxs)("div",{className:"reset-warning-modal ".concat(l),children:[(0,r.jsxs)("div",{className:"reset-warning-header",children:[(0,r.jsx)("h2",{children:"\uD83D\uDEA8 Reset Completo de Dashboard"}),(0,r.jsx)("button",{className:"close-button",onClick:n,title:"Cerrar",children:"✕"})]}),(0,r.jsxs)("div",{className:"reset-warning-content",children:[(0,r.jsxs)("div",{className:"warning-section",children:[(0,r.jsx)("div",{className:"warning-icon",children:"⚠️"}),(0,r.jsxs)("div",{className:"warning-text",children:[(0,r.jsx)("h3",{children:"Esta acci\xf3n eliminar\xe1 TODOS los datos permanentemente"}),(0,r.jsx)("p",{children:"Se perder\xe1n todos los estados de bloques, historiales de operaciones, m\xe9tricas y reportes."})]})]}),i&&(0,r.jsxs)("div",{className:"recommendation-section",children:[(0,r.jsx)("h4",{children:"\uD83D\uDCCB Se recomienda descargar los reportes primero:"}),(0,r.jsxs)("ul",{children:[(0,r.jsxs)("li",{children:[(0,r.jsx)("strong",{children:"JSON:"})," Datos completos para respaldo y restauraci\xf3n"]}),(0,r.jsxs)("li",{children:[(0,r.jsx)("strong",{children:"CSV:"})," Operaciones para an\xe1lisis en Excel"]}),(0,r.jsxs)("li",{children:[(0,r.jsx)("strong",{children:"HTML:"})," Reporte ejecutivo visual"]})]})]}),(0,r.jsxs)("div",{className:"action-section",children:[(0,r.jsx)("h4",{children:"\xbfQu\xe9 deseas hacer?"}),(0,r.jsxs)("div",{className:"action-buttons",children:[(0,r.jsx)("button",{className:"download-button",onClick:a,title:"Ir al dashboard para descargar reportes",children:"\uD83D\uDCCA Descargar Reportes Primero"}),(0,r.jsx)("button",{className:"proceed-button warning",onClick:s,title:"Proceder sin descargar (se perder\xe1n los datos)",children:"\uD83D\uDDD1️ Proceder Sin Descargar"}),(0,r.jsx)("button",{className:"cancel-button",onClick:n,title:"Cancelar operaci\xf3n",children:"❌ Cancelar"})]})]}),(0,r.jsx)("div",{className:"final-warning",children:(0,r.jsx)("small",{children:"⚠️ Esta acci\xf3n NO se puede deshacer"})})]})]})}):null};a(3062);var j=()=>{let{link:e,setLink:t,totalViewers:a,updateBlockViewers:s}=h(),{theme:n}=(0,o.F)(),[i,l]=(0,d.useState)(!1),[c,u]=(0,d.useState)(!1),[m,p]=(0,d.useState)(!1),[v,g]=(0,d.useState)(null),[j,w]=(0,d.useState)(null),[D,N]=(0,d.useState)(null);(0,d.useEffect)(()=>{(()=>{let e=[];for(let t=0;t<localStorage.length;t++){let a=localStorage.key(t);if(a&&a.startsWith("blockState_"))try{let t=JSON.parse(localStorage.getItem(a)||"");if(t.lastSaved){let r=new Date(t.lastSaved);(new Date().getTime()-r.getTime())/864e5>7&&e.push(a)}}catch(t){e.push(a)}}e.forEach(e=>localStorage.removeItem(e))})()},[]);let S=(e,t)=>{g({blockId:e,type:t})},C=(e,t)=>{w({blockId:e,blockData:t}),N({...t})},y=[{title:"Bloque 1",totalOperations:5,serviceId:336,count:50,decrement:10,operationType:"subtract",autoStart:!1,startTime:""},{title:"Bloque 2",totalOperations:4,serviceId:337,count:60,decrement:15,operationType:"subtract",autoStart:!1,startTime:""},{title:"Bloque 3",totalOperations:6,serviceId:334,count:40,decrement:5,operationType:"add",autoStart:!1,startTime:""},{title:"Bloque 4",totalOperations:3,serviceId:335,count:70,decrement:20,operationType:"subtract",autoStart:!1,startTime:""},{title:"Bloque 5",totalOperations:4,serviceId:338,count:80,decrement:10,operationType:"add",autoStart:!1,startTime:""},{title:"Bloque 6",totalOperations:5,serviceId:459,count:90,decrement:25,operationType:"subtract",autoStart:!1,startTime:""},{title:"Bloque 7",totalOperations:3,serviceId:460,count:100,decrement:30,operationType:"add",autoStart:!1,startTime:""},{title:"Bloque 8",totalOperations:6,serviceId:657,count:120,decrement:40,operationType:"subtract",autoStart:!1,startTime:""},{title:"Bloque 9",totalOperations:4,serviceId:335,count:110,decrement:20,operationType:"add",autoStart:!1,startTime:""},{title:"Bloque 10",totalOperations:5,serviceId:336,count:130,decrement:35,operationType:"subtract",autoStart:!1,startTime:""}],k=e=>{t(e)},O=()=>{try{for(let e=0;e<10;e++){let t="block-".concat(e),a=window["resetBlock_".concat(t)];a?a():localStorage.removeItem("blockState_".concat(t))}localStorage.removeItem("globalOperationsHistory"),localStorage.removeItem("blockResetHistory");let e=[];for(let t=0;t<localStorage.length;t++){let a=localStorage.key(t);a&&(a.startsWith("blockState_")||a.includes("metrics")||a.includes("dashboard"))&&e.push(a)}e.forEach(e=>localStorage.removeItem(e)),u(!1),alert("✅ Reset completo realizado con \xe9xito.\n\nTodos los datos han sido eliminados permanentemente.\nLos bloques est\xe1n listos para usar desde cero.")}catch(e){console.error("Error durante el reset completo:",e),alert("❌ Error durante el reset completo. Algunos datos pueden no haberse eliminado correctamente.")}};return(0,r.jsxs)("div",{className:"viewers-container",children:[(0,r.jsx)("input",{type:"text",value:e,onChange:e=>k(e.target.value),placeholder:"Ingrese el enlace de YouTube",className:"input-link ".concat(n)}),(0,r.jsxs)("div",{className:"total-viewers-header",children:["\uD83D\uDCAB Total cargado: ",a.toLocaleString()]}),(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"center",gap:"1rem",marginBottom:"1rem"},children:[(0,r.jsxs)("button",{onClick:()=>u(!c),className:"edit-button",style:{padding:"0.75rem 1.5rem",fontSize:"0.875rem",borderRadius:"0.5rem",fontWeight:"500"},title:"Ver dashboard de m\xe9tricas",children:["\uD83D\uDCCA ",c?"Ocultar M\xe9tricas":"Ver M\xe9tricas"]}),(0,r.jsx)("button",{onClick:()=>{let e=y.some((e,t)=>{var a;let r=localStorage.getItem("blockState_block-".concat(t));return r&&(null===(a=JSON.parse(r).operations)||void 0===a?void 0:a.length)>0}),t=localStorage.getItem("globalOperationsHistory")||localStorage.getItem("blockResetHistory");if(!(e||t)){alert("No hay datos para resetear.");return}p(!0)},className:"reset-button",style:{padding:"0.75rem 1.5rem",fontSize:"0.875rem",borderRadius:"0.5rem",fontWeight:"500"},title:"Resetear todos los bloques",children:"\uD83D\uDDD1️ Reset All"})]}),c&&(0,r.jsx)(b,{}),(0,r.jsx)("div",{className:"blocks-container",children:y.map((t,a)=>(0,r.jsx)(x,{blockId:"block-".concat(a),initialData:t,link:e,onTotalViewersChange:s,onShowWarning:S,onShowEditModal:C},"block-".concat(a)))}),i&&(0,r.jsx)("div",{className:"modal",children:(0,r.jsxs)("div",{className:"modal-content ".concat(n),children:[(0,r.jsx)("h2",{children:"\uD83D\uDCC1 Subir Archivo Excel"}),(0,r.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:(0,r.jsx)("div",{style:{padding:"1rem",borderRadius:"0.5rem",border:"2px dashed rgba(156, 163, 175, 0.5)"},children:(0,r.jsx)("input",{type:"file",accept:".xlsx,.xls",onChange:e=>{var t;let a=null===(t=e.target.files)||void 0===t?void 0:t[0];a&&(console.log("Archivo seleccionado:",a.name),l(!1))},style:{width:"100%",fontSize:"0.875rem"}})})}),(0,r.jsx)("div",{style:{display:"flex",gap:"0.75rem",marginTop:"1.5rem"},children:(0,r.jsx)("button",{onClick:()=>l(!1),className:"cancel-button",children:"❌ Cancelar"})})]})}),v&&(0,r.jsx)("div",{className:"warning-modal",children:(0,r.jsx)("div",{className:"warning-content ".concat(n),children:(0,r.jsxs)("div",{style:{textAlign:"center"},children:[(0,r.jsx)("div",{style:{fontSize:"4rem",marginBottom:"1rem"},children:"⚠️"}),(0,r.jsx)("h3",{style:{fontSize:"1.25rem",fontWeight:"bold",marginBottom:"1rem"},children:"finalizar"===v.type?"\uD83C\uDFC1 Finalizar Bloque":"\uD83D\uDD04 Reiniciar Bloque"}),(0,r.jsxs)("p",{style:{marginBottom:"1.5rem"},children:["Est\xe1s por ","finalizar"===v.type?"finalizar":"reiniciar"," este bloque de operaciones.",(0,r.jsx)("br",{}),(0,r.jsx)("strong",{children:"Esta acci\xf3n no se puede deshacer."})]}),(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"center",gap:"1rem"},children:[(0,r.jsx)("button",{onClick:()=>{if(v){var e,t,a,r;let{blockId:s,type:n}=v;"finalizar"===n?null===(e=(t=window)["finalizeBlock_".concat(s)])||void 0===e||e.call(t):"reiniciar"===n&&(null===(a=(r=window)["resetBlock_".concat(s)])||void 0===a||a.call(r)),g(null)}},className:"continue-button",children:"✅ Continuar"}),(0,r.jsx)("button",{onClick:()=>g(null),className:"cancel-button",children:"❌ Cancelar"})]})]})})}),j&&D&&(0,r.jsx)("div",{className:"modal",children:(0,r.jsxs)("div",{className:"modal-content ".concat(n),children:[(0,r.jsx)("h2",{children:"✏️ Editar Bloque"}),(0,r.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:[(0,r.jsxs)("label",{children:["\uD83D\uDD22 Cantidad de Operaciones:",(0,r.jsx)("input",{type:"number",min:0,value:D.totalOperations,onChange:e=>N(t=>t?{...t,totalOperations:Number(e.target.value)}:null),className:"input-".concat(n)})]}),(0,r.jsxs)("label",{children:["⏱️ Duraci\xf3n:",(0,r.jsxs)("select",{value:D.serviceId,onChange:e=>N(t=>t?{...t,serviceId:Number(e.target.value)}:null),className:"input-".concat(n),children:[(0,r.jsx)("option",{value:334,children:"1h"}),(0,r.jsx)("option",{value:335,children:"1.30h"}),(0,r.jsx)("option",{value:336,children:"2h"}),(0,r.jsx)("option",{value:337,children:"2.30h"}),(0,r.jsx)("option",{value:338,children:"3h"}),(0,r.jsx)("option",{value:459,children:"4h"}),(0,r.jsx)("option",{value:460,children:"6h"}),(0,r.jsx)("option",{value:657,children:"8h"})]})]}),(0,r.jsx)("div",{style:{padding:"0.75rem",borderRadius:"0.5rem",background:"rgba(34, 197, 94, 0.1)",border:"1px solid rgba(34, 197, 94, 0.2)",color:"#16a34a"},children:(0,r.jsx)("p",{style:{fontSize:"0.875rem",fontWeight:"500"},children:"\uD83D\uDCA1 Solo m\xfaltiplos de 10 (ej: 30, 40, 100, 150...)"})}),(0,r.jsxs)("label",{children:["\uD83D\uDC65 Cantidad:",(0,r.jsx)("input",{type:"number",min:0,step:10,value:D.count,onChange:e=>N(t=>t?{...t,count:Number(e.target.value)}:null),className:"input-".concat(n," ").concat(D.count%10!=0?"input-error":"")})]}),(0,r.jsxs)("label",{children:["➕➖ Cantidad a Restar/Sumar:",(0,r.jsx)("input",{type:"number",min:0,step:10,value:D.decrement,onChange:e=>N(t=>t?{...t,decrement:Number(e.target.value)}:null),className:"input-".concat(n," ").concat(D.decrement%10!=0?"input-error":"")})]}),(0,r.jsxs)("label",{children:["\uD83D\uDD04 Operaci\xf3n:",(0,r.jsxs)("select",{value:D.operationType,onChange:e=>N(t=>t?{...t,operationType:e.target.value}:null),className:"input-".concat(n),children:[(0,r.jsx)("option",{value:"add",children:"➕ Sumar"}),(0,r.jsx)("option",{value:"subtract",children:"➖ Restar"})]})]}),(0,r.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[(0,r.jsx)("input",{type:"checkbox",checked:D.autoStart,onChange:e=>N(t=>t?{...t,autoStart:e.target.checked}:null),style:{width:"1.25rem",height:"1.25rem"}}),(0,r.jsx)("span",{children:"\uD83D\uDD50 Inicio Autom\xe1tico"})]}),D.autoStart&&(0,r.jsxs)("label",{children:["⏰ Hora de Inicio:",(0,r.jsx)("input",{type:"time",value:D.startTime,onChange:e=>N(t=>t?{...t,startTime:e.target.value}:null),className:"input-".concat(n)})]})]}),(0,r.jsxs)("div",{style:{display:"flex",gap:"0.75rem",marginTop:"1.5rem"},children:[(0,r.jsx)("button",{onClick:()=>{if(j&&D){var e,t;if(D.count%10!=0||D.decrement%10!=0){alert("La cantidad y el decremento deben ser m\xfaltiplos de 10");return}let{blockId:a}=j;null===(e=(t=window)["updateBlockData_".concat(a)])||void 0===e||e.call(t,D),w(null),N(null)}},className:"save-button",children:"\uD83D\uDCBE Guardar"}),(0,r.jsx)("button",{onClick:()=>{w(null),N(null)},className:"cancel-button",children:"❌ Cancelar"})]})]})}),(0,r.jsx)(f,{isOpen:m,onDownloadFirst:()=>{p(!1),u(!0),alert('\uD83D\uDCA1 Dashboard de m\xe9tricas abierto. Descarga los reportes y luego usa "Reset All" nuevamente.')},onProceedAnyway:()=>{p(!1),confirm("\uD83D\uDEA8 CONFIRMACI\xd3N FINAL\n\nEsto eliminar\xe1 PERMANENTEMENTE:\n• Todos los estados de bloques actuales\n• Todo el historial de operaciones\n• Todo el historial de resets\n• Todas las m\xe9tricas acumuladas\n\n⚠️ Esta acci\xf3n NO se puede deshacer.\n\n\xbfEst\xe1s absolutamente seguro de continuar?")&&O()},onCancel:()=>{p(!1)},hasData:!0})]})};function w(){let{data:e,status:t}=(0,s.useSession)(),{theme:a,toggleTheme:d}=(0,o.F)(),u=(0,n.useRouter)();return"loading"===t?(0,r.jsx)(i.Z,{}):e?(0,r.jsx)(m,{children:(0,r.jsxs)("div",{className:"flex flex-col min-h-screen transition-all duration-300 ".concat("dark"===a?"bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 text-slate-100":"bg-gradient-to-br from-gray-50 via-white to-gray-50 text-gray-900"),children:[(0,r.jsxs)("header",{className:"w-full flex justify-between items-center p-6 backdrop-blur-sm ".concat("dark"===a?"bg-slate-900/80 border-b border-slate-700/50":"bg-white/80 border-b border-gray-200/50 shadow-sm"),children:[(0,r.jsx)("h1",{className:"text-3xl font-bold bg-gradient-to-r from-slate-600 via-slate-500 to-slate-600 bg-clip-text text-transparent",children:"ServiceDG Dashboard"}),(0,r.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,r.jsx)("button",{onClick:d,className:"px-4 py-2 rounded-xl font-medium transition-all duration-200 ".concat("dark"===a?"bg-slate-800 hover:bg-slate-700 text-slate-200 border border-slate-700":"bg-white hover:bg-gray-50 text-gray-700 border border-gray-200 shadow-sm"),children:"dark"===a?(0,r.jsx)(l.G,{icon:c.enB}):(0,r.jsx)(l.G,{icon:c.DBF})}),(0,r.jsx)("button",{onClick:()=>(0,s.signOut)({callbackUrl:"/"}),className:"px-6 py-2 rounded-xl font-medium bg-gradient-to-r from-red-500 to-red-600 text-white hover:from-red-600 hover:to-red-700 transition-all duration-200 shadow-lg hover:shadow-xl",children:"Cerrar sesi\xf3n"})]})]}),(0,r.jsxs)("div",{className:"flex flex-1",children:[(0,r.jsx)("aside",{className:"w-80 flex flex-col p-6 backdrop-blur-sm ".concat("dark"===a?"bg-slate-800/60 border-r border-slate-700/50":"bg-white/80 border-r border-gray-200/50 shadow-sm"),children:(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"text-center mb-8",children:[(0,r.jsx)("div",{className:"w-16 h-16 bg-gradient-to-br from-blue-500 to-blue-600 rounded-2xl flex items-center justify-center mx-auto mb-4",children:(0,r.jsx)("span",{className:"text-white text-2xl",children:"\uD83D\uDCCA"})}),(0,r.jsx)("h2",{className:"text-xl font-bold mb-2",children:"Panel de Control"}),(0,r.jsx)("p",{className:"text-sm ".concat("dark"===a?"text-slate-400":"text-gray-600"),children:"Gestiona tu dashboard"})]}),(0,r.jsx)("button",{className:"w-full p-4 rounded-2xl font-medium transition-all duration-200 ".concat("dark"===a?"bg-slate-700/60 hover:bg-slate-600/80 text-slate-200 border border-slate-600/50":"bg-blue-50 hover:bg-blue-100 text-blue-700 border border-blue-200"),disabled:!0,children:(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl flex items-center justify-center mr-4",children:(0,r.jsx)("span",{className:"text-white text-sm",children:"\uD83D\uDCC8"})}),(0,r.jsxs)("div",{className:"text-left",children:[(0,r.jsx)("div",{className:"font-semibold",children:"Administrar Viewers"}),(0,r.jsx)("div",{className:"text-xs ".concat("dark"===a?"text-slate-500":"text-gray-500"),children:"Gesti\xf3n de datos"})]})]})}),(0,r.jsx)("button",{onClick:()=>u.push("/pago"),className:"w-full p-4 rounded-2xl font-medium transition-all duration-200 hover:scale-105 ".concat("dark"===a?"bg-slate-700/60 hover:bg-slate-600/80 text-slate-200 border border-slate-600/50 hover:border-green-500/50":"bg-green-50 hover:bg-green-100 text-green-700 border border-green-200 hover:border-green-400"),children:(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("div",{className:"w-10 h-10 bg-gradient-to-br from-green-500 to-green-600 rounded-xl flex items-center justify-center mr-4",children:(0,r.jsx)("span",{className:"text-white text-sm",children:"\uD83D\uDCB3"})}),(0,r.jsxs)("div",{className:"text-left",children:[(0,r.jsx)("div",{className:"font-semibold",children:"Pagos"}),(0,r.jsx)("div",{className:"text-xs ".concat("dark"===a?"text-slate-500":"text-gray-500"),children:"M\xe9todos de pago"})]})]})})]})}),(0,r.jsx)("main",{className:"flex-1 flex flex-col items-center justify-start p-8",children:(0,r.jsx)("div",{className:"w-full max-w-7xl p-8 rounded-2xl backdrop-blur-sm transition-all duration-300 ".concat("dark"===a?"bg-slate-800/60 border border-slate-700/50 shadow-2xl":"bg-white/80 border border-gray-200/50 shadow-xl"),children:(0,r.jsx)(j,{})})})]}),(0,r.jsx)("footer",{className:"w-full p-6 backdrop-blur-sm ".concat("dark"===a?"bg-slate-900/80 border-t border-slate-700/50":"bg-white/80 border-t border-gray-200/50 shadow-sm"),children:(0,r.jsx)("p",{className:"text-center text-sm ".concat("dark"===a?"text-slate-400":"text-gray-600"),children:"\xa9 2025 ServiceDG. Todos los derechos reservados."})})]})}):(u.replace("/"),null)}},3636:function(e,t,a){"use strict";var r=a(7437);a(2265);var s=a(6648);a(4253),t.Z=()=>(0,r.jsxs)("div",{className:"preloader-container",children:[(0,r.jsx)("div",{className:"preloader-logo",children:(0,r.jsx)(s.default,{src:"/servicedg-logo-professional.svg",alt:"ServiceDG",width:120,height:120,className:"preloader-image"})}),(0,r.jsx)("div",{className:"preloader-text",children:"ServiceDG Analytics"}),(0,r.jsx)("div",{className:"preloader-progress"})]})},7653:function(){},4253:function(){},1750:function(){},3062:function(){}},function(e){e.O(0,[551,127,676,425,168,998,648,971,23,744],function(){return e(e.s=6745)}),_N_E=e.O()}]);