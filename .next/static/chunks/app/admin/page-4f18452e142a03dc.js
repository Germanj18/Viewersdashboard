(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3],{67:function(){},2061:function(){},6745:function(e,t,a){Promise.resolve().then(a.bind(a,5131))},5589:function(e,t,a){"use strict";a.d(t,{F:function(){return i},f:function(){return o}});var s=a(7437),r=a(2265);let n=(0,r.createContext)(void 0),o=e=>{let{children:t}=e,[a,o]=(0,r.useState)("dark"),[i,l]=(0,r.useState)(!1);return(0,r.useEffect)(()=>{o(localStorage.getItem("theme")||"dark"),l(!0)},[]),(0,r.useEffect)(()=>{i&&(document.documentElement.setAttribute("data-theme",a),document.documentElement.className=a)},[a,i]),(0,s.jsx)(n.Provider,{value:{theme:a,toggleTheme:()=>{o(e=>{let t="light"===e?"dark":"light";return localStorage.setItem("theme",t),t})}},children:i?t:(0,s.jsx)("div",{className:"min-h-screen bg-gray-900 flex items-center justify-center",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"})})})},i=()=>{let e=(0,r.useContext)(n);if(!e)throw Error("useTheme must be used within a ThemeProvider");return e}},5131:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return w}});var s=a(7437),r=a(605),n=a(9376),o=a(2265),i=a(5589),l=a(8901),c=a(1268),d=a(5217);let u=(0,o.createContext)(void 0),m=e=>{let{children:t}=e,[a,r]=(0,o.useState)(()=>localStorage.getItem("link")||""),[n,i]=(0,o.useState)({}),[l,c]=(0,o.useState)(0),d=(0,o.useCallback)(()=>{try{let e=localStorage.getItem("globalOperationsHistory");if(!e)return 0;let t=JSON.parse(e),a=new Date,s=0;return t.forEach(e=>{if("success"===e.status&&e.duration&&(e.savedAt||e.startTime))try{let t=e.savedAt||e.startTime,r=new Date(t);if(!isNaN(r.getTime())){let t=new Date(r.getTime()+6e4*e.duration);a>t&&(s+=e.count||0)}}catch(e){console.warn("Error calculando operaci\xf3n expirada:",e)}}),s}catch(e){return console.error("Error calculando viewers expirados:",e),0}},[]);(0,o.useEffect)(()=>{let e=()=>{c(d())};e();let t=setInterval(e,6e4);return()=>clearInterval(t)},[d]),(0,o.useEffect)(()=>{localStorage.setItem("link",a)},[a]);let m=(0,o.useCallback)((e,t)=>{i(a=>a[e]!==t?{...a,[e]:t}:a)},[]);Object.values(n).reduce((e,t)=>e+t,0);let h=(0,o.useCallback)(()=>{try{let e=localStorage.getItem("globalOperationsHistory"),t=0;if(e)try{t=JSON.parse(e).filter(e=>"success"===e.status).reduce((e,t)=>e+(t.count||0),0)}catch(e){console.error("Error calculando viewers del historial:",e)}return console.log("\uD83D\uDCCA C\xe1lculo de viewers enviados:",{viewersFromOperations:t,note:"Este es el total REAL de viewers enviados desde operaciones exitosas"}),t}catch(e){return console.error("Error calculando total de viewers enviados:",e),0}},[d]),p=Math.max(0,h()-l);return(0,s.jsx)(u.Provider,{value:{link:a,setLink:r,totalViewers:p,updateBlockViewers:m,getExpiredViewersCount:d,getTotalViewersSent:h},children:t})},h=()=>{let e=(0,o.useContext)(u);if(!e)throw Error("useGlobal must be used within a GlobalProvider");return e};var p=a(2093),x=e=>{let{initialData:t,link:a,onTotalViewersChange:r,blockId:n,onShowWarning:l,onShowEditModal:c,isRecentlyEdited:d=!1}=e,{theme:u}=(0,i.F)(),[m,h]=(0,o.useState)(!0),x=(0,o.useCallback)(()=>{let e=localStorage.getItem("blockState_".concat(n));if(e)try{let t=JSON.parse(e);if(t.lastSaved){let e=new Date(t.lastSaved);if((new Date().getTime()-e.getTime())/864e5>7)return localStorage.removeItem("blockState_".concat(n)),null}return t}catch(e){console.error("Error parsing saved block state:",e),localStorage.removeItem("blockState_".concat(n))}return null},[n]),[g,v]=(0,o.useState)(()=>{let e=x();return(null==e?void 0:e.status)||[]}),[b,j]=(0,o.useState)(null),[D,f]=(0,o.useState)(!1),[w,N]=(0,o.useState)(()=>{let e=x();return(null==e?void 0:e.currentOperation)||0}),[y,C]=(0,o.useState)(()=>{let e=x(),t=(null==e?void 0:e.state)||"idle";return"running"===t?"paused":t}),[S,k]=(0,o.useState)(()=>{let e=x();return(null==e?void 0:e.totalViewers)||0}),[T,O]=(0,o.useState)(()=>{let e=x();return(null==e?void 0:e.blockStartTime)||null}),[E,I]=(0,o.useState)(()=>{let e=x(),a=(null==e?void 0:e.blockData)||t;return a.intervalMinutes||(a.intervalMinutes=2),a}),L=(0,o.useCallback)(()=>{let e={status:g,currentOperation:w,state:y,totalViewers:S,blockData:E,blockStartTime:T,lastSaved:new Date().toISOString()};localStorage.setItem("blockState_".concat(n),JSON.stringify(e))},[n,g,w,y,S,E,T]);(0,o.useEffect)(()=>{L()},[g,w,y,S,E,T,L]);let A=(0,o.useRef)(null),F=(0,o.useRef)(0),R=(0,o.useRef)(y),M=(0,o.useRef)(w),V=(0,o.useRef)(E),B=(0,o.useRef)(g),H=(0,o.useRef)(S);(0,o.useEffect)(()=>{R.current=y},[y]),(0,o.useEffect)(()=>{M.current=w},[w]),(0,o.useEffect)(()=>{V.current=E},[E]),(0,o.useEffect)(()=>{B.current=g},[g]),(0,o.useEffect)(()=>{H.current=S},[S]),(0,o.useEffect)(()=>{if(E.autoStart&&E.startTime&&"idle"===y){let[e,t]=E.startTime.split(":").map(Number),a=new Date,s=new Date(a.getFullYear(),a.getMonth(),a.getDate(),e,t,0,0).getTime()-a.getTime();if(s>0){let e=setTimeout(()=>$(),s);return()=>clearTimeout(e)}}},[E.autoStart,E.startTime,y]),(0,o.useEffect)(()=>{F.current!==S&&(r(n,S),F.current=S)},[S,n,r]),(0,o.useEffect)(()=>{let e=()=>{A.current&&clearInterval(A.current);let e={status:B.current,currentOperation:M.current,state:"running"===R.current?"paused":R.current,totalViewers:H.current,blockData:V.current,blockStartTime:T,lastSaved:new Date().toISOString()};localStorage.setItem("blockState_".concat(n),JSON.stringify(e))};return window.addEventListener("beforeunload",e),()=>{A.current&&clearInterval(A.current),window.removeEventListener("beforeunload",e)}},[n]);let P=e=>{switch(e){case 336:return 120;case 337:return 150;case 334:return 60;case 335:return 90;case 338:return 180;case 459:return 240;case 460:return 360;case 657:return 480;default:return 0}},z=(0,o.useCallback)(()=>{let e=E.intervalMinutes||2,t=(E.totalOperations-1)*e,a=Math.floor(t/60),s=t%60;return a>0?s>0?"".concat(a,"h ").concat(s,"m"):"".concat(a,"h"):"".concat(s,"m")},[E.totalOperations,E.intervalMinutes]),q=(0,o.useCallback)(()=>{let e=E.totalOperations-w;if(e<=0)return"✅ Completado";if("idle"===y)return z();let t=Math.max(0,(e-1)*(E.intervalMinutes||2)),a=Math.floor(t/60),s=t%60;return a>0?s>0?"⏳ ".concat(a,"h ").concat(s,"m restante"):"⏳ ".concat(a,"h restante"):s>0?"⏳ ".concat(s,"m restante"):"⏳ \xdaltima operaci\xf3n"},[E.totalOperations,E.intervalMinutes,w,y,z]),_=(0,o.useCallback)(()=>{let e=P(E.serviceId),t=Math.floor(e/60),a=e%60;return t>0?a>0?"".concat(t,"h ").concat(a,"m"):"".concat(t,"h"):"".concat(a,"m")},[E.serviceId]),U=(0,o.useCallback)(()=>Math.min(E.totalOperations>0?w/E.totalOperations*100:0,100),[w,E.totalOperations]),Y=(0,o.useCallback)(()=>T?new Date(T).toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit",hour12:!1}):null,[T]),W=(0,o.useCallback)(()=>({success:g.filter(e=>"success"===e.status).length,errors:g.filter(e=>"error"===e.status).length,totalCost:g.reduce((e,t)=>e+(t.cost||0),0).toFixed(2),progress:U()}),[g,U]),J=(0,o.useCallback)(()=>{let e=B.current,t=V.current,a=e.map(e=>{var t,a;return{Estado:e.status,Mensaje:e.message,Timestamp:e.timestamp,"Order ID":e.orderId,"Order Status":e.orderStatus,"Duraci\xf3n (minutos)":e.duration,"Cantidad de Viewers":e.count,"Costo de la Operaci\xf3n":(null===(a=e.details)||void 0===a?void 0:null===(t=a.res)||void 0===t?void 0:t.sum)||0,...e.details}}),s=new Date("1970-01-01T10:25:00Z"),r=new Date("1970-01-01T23:00:00Z"),n=[],o=new Date(s);for(;o<=r;)n.push({Hora:o.toISOString().substr(11,5)}),o=new Date(o.getTime()+6e4);let i={Hora:"Costo"};e.forEach(e=>{if("success"===e.status&&e.count&&e.timestamp){let s;try{let t=e.timestamp.match(/(\d{1,2}):(\d{2}):(\d{2})/);if(t){let e=t[1].padStart(2,"0"),a=t[2];s="".concat(e,":").concat(a)}else console.warn("No se pudo parsear el timestamp:",e.timestamp),s="10:25"}catch(t){console.error("Error parseando timestamp:",e.timestamp,t),s="10:25"}let r=e.duration||0,o="Operaci\xf3n ".concat(e.orderId);if(!(o in i)){var t,a;i[o]=(null===(a=e.details)||void 0===a?void 0:null===(t=a.res)||void 0===t?void 0:t.sum)||0}n.forEach(e=>{o in e||(e[o]="")});let l=n.findIndex(e=>e.Hora===s);if(-1!==l)for(let t=0;t<r&&l+t<n.length;t++)n[l+t][o]=e.count}});let l=[i,...n],c=p.P6.json_to_sheet(a),d=p.P6.json_to_sheet(l),u=p.P6.book_new();p.P6.book_append_sheet(u,c,"Resumen de Operaciones"),p.P6.book_append_sheet(u,d,"Viewers por Minuto"),p.NC(u,"".concat(t.title,".xlsx"))},[]),G=(0,o.useCallback)(async()=>{if("running"!==R.current){console.log("".concat(V.current.title,': No ejecutando API call. State: "').concat(R.current,'"'));return}if(!a){console.log("".concat(V.current.title,": ⚠️ Sin link configurado, pero manteniendo estado running"));return}try{var e,t;let s=V.current,r=M.current,{count:n,decrement:o,serviceId:i,operationType:l}=s,c="add"===l?n+(o||0)*r:n-(o||0)*r;console.log("".concat(s.title,": Iniciando operaci\xf3n ").concat(r+1," con ").concat(c," viewers"));let d=await fetch("/api/proxy?service_id=".concat(i,"&count=").concat(c,"&link=").concat(a)),u=await d.json(),m=new Date,h=m.toTimeString().split(" ")[0],p=P(i),x=m.toISOString(),g=new Date(m.getTime()+6e4*p).toISOString();console.log("".concat(s.title,", Operation ").concat(r+1,":"),u);let b={status:u.error?"error":"success",message:u.error?"Error en la operaci\xf3n":"Operaci\xf3n exitosa",details:u,timestamp:h,orderId:null===(e=u.res)||void 0===e?void 0:e.order_id,duration:p,count:c,serviceId:i,cost:(null===(t=u.res)||void 0===t?void 0:t.sum)||0,startTime:x,estimatedEndTime:g};v(e=>[...e,b]),ea(b),"success"===b.status&&k(e=>e+c);let D=r+1;N(D),D>=s.totalOperations&&(A.current&&(clearInterval(A.current),A.current=null,j(null)),C("completed"),R.current="completed","Notification"in window&&"granted"===Notification.permission&&new Notification("\uD83C\uDF89 ".concat(s.title," Completado"),{body:"El bloque se ha completado exitosamente con ".concat(H.current," viewers totales"),icon:"/favicon.ico"}),setTimeout(()=>J(),1e3))}catch(s){console.error("".concat(V.current.title,", Operation ").concat(M.current+1,":"),s);let e=new Date,t={status:"error",message:"Error en la operaci\xf3n",details:s,timestamp:e.toTimeString().split(" ")[0],duration:0,cost:0,startTime:e.toISOString(),estimatedEndTime:e.toISOString()};v(e=>[...e,t]),ea(t);let a=M.current+1;N(a),a>=V.current.totalOperations&&(A.current&&(clearInterval(A.current),A.current=null,j(null)),C("completed"),R.current="completed","Notification"in window&&"granted"===Notification.permission&&new Notification("\uD83C\uDFC1 ".concat(V.current.title," Finalizado"),{body:"El bloque ha finalizado (con errores) - Total viewers: ".concat(H.current),icon:"/favicon.ico"}),setTimeout(()=>J(),1e3))}},[a,J]),$=()=>{if("running"===y)return;O(new Date().toISOString()),f(!1),C("running"),R.current="running",G();let e=setInterval(()=>G(),6e4*(V.current.intervalMinutes||2));A.current=e,j(e)},K=()=>{A.current&&(clearInterval(A.current),A.current=null,j(null),f(!0),C("paused"),R.current="paused")},Z=()=>{f(!1),C("running"),R.current="running",G();let e=setInterval(G,6e4*(V.current.intervalMinutes||2));A.current=e,j(e)},X=(0,o.useCallback)(()=>{console.log("\uD83C\uDFC1 Finalizando bloque ".concat(E.title,", estado actual: ").concat(y)),A.current&&(clearInterval(A.current),A.current=null,j(null)),"completed"!==y?(console.log("\uD83C\uDFC1 Cambiando estado de ".concat(y," a completed")),C("completed"),R.current="completed","Notification"in window&&"granted"===Notification.permission&&new Notification("\uD83C\uDFC1 ".concat(E.title," Finalizado Manualmente"),{body:"El bloque fue finalizado manualmente con ".concat(S," viewers totales"),icon:"/favicon.ico"}),J()):console.log("\uD83C\uDFC1 Bloque ya estaba completado, no se realiz\xf3 cambio de estado"),I(e=>({...e,autoStart:!1}))},[y,E.title,S,J]),Q=(0,o.useCallback)(()=>{es(),A.current&&(clearInterval(A.current),A.current=null,j(null)),v([]),f(!1),N(0),C("idle"),R.current="idle",k(0),O(null),I(e=>({...e,autoStart:!1,startTime:""})),localStorage.removeItem("blockState_".concat(n))},[n]),ee=()=>{c(n,E)},et=(0,o.useCallback)(e=>{I(e)},[]);o.useEffect(()=>(window["updateBlockData_".concat(n)]=et,window["finalizeBlock_".concat(n)]=X,window["resetBlock_".concat(n)]=Q,()=>{delete window["updateBlockData_".concat(n)],delete window["finalizeBlock_".concat(n)],delete window["resetBlock_".concat(n)]}),[n,et,X,Q]);let ea=(0,o.useCallback)(e=>{let t="globalOperationsHistory",a=localStorage.getItem(t),s=[];if(a)try{s=JSON.parse(a)}catch(e){console.error("Error parsing global history:",e),s=[]}let r={...e,blockId:n,blockTitle:E.title,savedAt:new Date().toISOString()};s.push(r),s.length>1e3&&(s=s.slice(-1e3)),localStorage.setItem(t,JSON.stringify(s))},[n,E.title]),es=(0,o.useCallback)(()=>{let e="blockResetHistory",t=localStorage.getItem(e),a=[];if(t)try{a=JSON.parse(t)}catch(e){console.error("Error parsing reset history:",e),a=[]}let s=g.filter(e=>"success"===e.status),r=s.reduce((e,t)=>e+(t.count||0),0);console.log("\uD83D\uDCCA Registrando reset del bloque:",{blockId:n,blockTitle:E.title,totalOperations:g.length,successfulOperations:s.length,totalViewers:S,calculatedViewers:r});let o={blockId:n,blockTitle:E.title,resetAt:new Date().toISOString(),operationsLost:s.length,viewersLost:r,totalOperations:g.length,totalViewers:S};a.push(o),a.length>100&&(a=a.slice(-100)),localStorage.setItem(e,JSON.stringify(a)),console.log("✅ Reset registrado:",o)},[n,E.title,g,S]),er=W();return(0,s.jsxs)("div",{className:"block ".concat(u," ").concat(m?"minimized":"expanded"," ").concat(d?"recently-edited":""),children:[(0,s.jsxs)("div",{className:"block-header",children:[(0,s.jsx)("h2",{className:"block-title",children:E.title}),(0,s.jsxs)("div",{className:"block-header-buttons",children:[("paused"===y||"completed"===y)&&!m&&(0,s.jsx)("button",{onClick:J,className:"download-icon",children:"\uD83D\uDCCA Excel"}),(0,s.jsx)("button",{onClick:()=>h(!m),className:"minimize-toggle",title:m?"Expandir":"Minimizar",children:m?"\uD83D\uDCC8 Expandir":"\uD83D\uDCC9 Minimizar"})]})]}),m?(0,s.jsxs)("div",{className:"block-ultra-minimized",children:[(0,s.jsxs)("div",{className:"ultra-compact-header",children:[(0,s.jsx)("div",{className:"progress-micro",children:(0,s.jsx)("div",{className:"progress-fill-micro",style:{width:"".concat(er.progress,"%")}})}),(0,s.jsxs)("span",{className:"progress-label",children:[w,"/",E.totalOperations]}),Y()&&(0,s.jsxs)("span",{className:"start-time-label",title:"Hora de inicio del bloque",children:["\uD83D\uDD52 ",Y()]})]}),(0,s.jsxs)("div",{className:"ultra-compact-body",children:[(0,s.jsxs)("div",{className:"ultra-stats-column",children:[(0,s.jsxs)("div",{className:"stat-group",children:[(0,s.jsx)("label",{className:"stat-label",children:"Viewers:"}),(0,s.jsxs)("span",{className:"stat-value",children:["\uD83D\uDC65 ",S]})]}),(0,s.jsxs)("div",{className:"stat-group",children:[(0,s.jsx)("label",{className:"stat-label",children:"\xc9xito:"}),(0,s.jsxs)("span",{className:"stat-value success",children:["✅ ",er.success]})]}),er.errors>0&&(0,s.jsxs)("div",{className:"stat-group",children:[(0,s.jsx)("label",{className:"stat-label",children:"Errores:"}),(0,s.jsxs)("span",{className:"stat-value error",children:["❌ ",er.errors]})]}),(0,s.jsxs)("div",{className:"stat-group",children:[(0,s.jsx)("label",{className:"stat-label",children:"Costo:"}),(0,s.jsxs)("span",{className:"stat-value",children:["\uD83D\uDCB0 $",er.totalCost]})]})]}),(0,s.jsxs)("div",{className:"ultra-duration-column",children:[(0,s.jsxs)("div",{className:"duration-group",children:[(0,s.jsx)("label",{className:"duration-label",children:"Intervalo:"}),(0,s.jsxs)("span",{className:"duration-value",children:["\uD83D\uDD04 ",E.intervalMinutes||2,"m"]})]}),(0,s.jsxs)("div",{className:"duration-group",children:[(0,s.jsx)("label",{className:"duration-label",children:"Duraci\xf3n Op:"}),(0,s.jsxs)("span",{className:"duration-value",children:["⏱️ ",_()]})]}),(0,s.jsxs)("div",{className:"duration-group",children:[(0,s.jsx)("label",{className:"duration-label",children:"Tiempo Restante:"}),(0,s.jsxs)("span",{className:"duration-value",title:"Tiempo estimado restante para completar el bloque",children:["\uD83D\uDCC5 ",q()]})]})]})]}),(0,s.jsxs)("div",{className:"ultra-compact-controls",children:["idle"===y&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("button",{onClick:$,className:"micro-btn start",title:"Iniciar",children:"▶️ Iniciar"}),(0,s.jsx)("button",{onClick:ee,className:"micro-btn edit",title:"Editar",children:"✏️ Editar"})]}),"running"===y&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("button",{onClick:K,className:"micro-btn pause",title:"Pausar",children:"⏸️ Pausar"}),(0,s.jsx)("button",{onClick:ee,className:"micro-btn edit",title:"Editar",children:"✏️ Editar"})]}),"paused"===y&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("button",{onClick:Z,className:"micro-btn resume",title:"Reanudar",children:"▶️ Reanudar"}),(0,s.jsx)("button",{onClick:()=>l(n,"finalizar"),className:"micro-btn finalize",title:"Finalizar",children:"\uD83C\uDFC1 Finalizar"}),(0,s.jsx)("button",{onClick:()=>l(n,"reiniciar"),className:"micro-btn reset",title:"Reiniciar",children:"\uD83D\uDD04 Reiniciar"}),(0,s.jsx)("button",{onClick:ee,className:"micro-btn edit",title:"Editar",children:"✏️ Editar"}),(0,s.jsx)("button",{onClick:J,className:"micro-btn download",title:"Descargar Excel",children:"\uD83D\uDCCA Excel"})]}),"completed"===y&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{className:"micro-completed",children:"✅ Completado"}),(0,s.jsx)("button",{onClick:()=>l(n,"reiniciar"),className:"micro-btn reset",title:"Reiniciar",children:"\uD83D\uDD04 Reiniciar"}),(0,s.jsx)("button",{onClick:ee,className:"micro-btn edit",title:"Editar",children:"✏️ Editar"}),(0,s.jsx)("button",{onClick:J,className:"micro-btn download",title:"Descargar Excel",children:"\uD83D\uDCCA Excel"})]})]})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"block-info",children:[(0,s.jsxs)("div",{className:"info-row",children:[(0,s.jsxs)("span",{className:"duration-info",title:"Tiempo entre cada operaci\xf3n",children:["\uD83D\uDD04 Intervalo: ",E.intervalMinutes||2," min",(E.intervalMinutes||2)>1?"utos":"uto"]}),(0,s.jsxs)("span",{className:"operation-duration-info",title:"Duraci\xf3n estimada por operaci\xf3n",children:["⏱️ Duraci\xf3n Op: ",_()]}),(0,s.jsxs)("span",{className:"total-duration-info",title:"Tiempo estimado restante para completar el bloque",children:["\uD83D\uDCC5 ",q()]}),Y()&&(0,s.jsxs)("span",{className:"start-time-info",title:"Hora de inicio del bloque",children:["\uD83D\uDD52 Iniciado: ",Y()]})]}),E.autoStart&&E.startTime&&(0,s.jsxs)("div",{className:"auto-start-info",children:["⏰ Inicio autom\xe1tico: ",E.startTime]}),(0,s.jsx)("div",{className:"progress-container",children:(0,s.jsxs)("div",{className:"progress-bar",children:[(0,s.jsx)("div",{className:"progress-fill",style:{width:"".concat(er.progress,"%")}}),(0,s.jsxs)("span",{className:"progress-text",children:[w,"/",E.totalOperations," operaciones (",er.progress.toFixed(0),"%)"]})]})})]}),(0,s.jsxs)("div",{className:"status-compact",children:[(0,s.jsxs)("div",{className:"status-summary",children:[(0,s.jsxs)("span",{className:"summary-item success",title:"Operaciones completadas exitosamente",children:["✅ \xc9xito: ",er.success]}),(0,s.jsxs)("span",{className:"summary-item error",title:"Operaciones con errores",children:["❌ Errores: ",er.errors]}),(0,s.jsxs)("span",{className:"summary-item cost",title:"Costo total acumulado",children:["\uD83D\uDCB0 Costo: $",er.totalCost]})]}),(0,s.jsxs)("details",{className:"status-details",children:[(0,s.jsx)("summary",{children:"Ver detalles de operaciones"}),(0,s.jsx)("div",{className:"status-list",children:Array.from({length:E.totalOperations}).map((e,t)=>(0,s.jsxs)("div",{className:"status-item",children:["Op ".concat(t+1,": "),g[t]?(0,s.jsxs)(s.Fragment,{children:["success"===g[t].status?(0,s.jsx)("span",{className:"status-success",children:"✅"}):(0,s.jsx)("span",{className:"status-error",children:"❌"}),(0,s.jsx)("span",{className:"timestamp",children:g[t].timestamp}),g[t].orderStatus&&(0,s.jsx)("span",{className:"order-status",children:g[t].orderStatus})]}):(0,s.jsx)("span",{className:"status-pending",children:"⏳"})]},t))})]})]}),(0,s.jsxs)("div",{className:"block-controls",children:["idle"===y&&(0,s.jsx)("button",{onClick:$,className:"start-button",children:"▶️ Iniciar"}),"running"===y&&(0,s.jsx)("button",{onClick:K,className:"pause-button",children:"⏸️ Pausar"}),"paused"===y&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("button",{onClick:Z,className:"resume-button",children:"▶️ Reanudar"}),(0,s.jsx)("button",{onClick:()=>l(n,"finalizar"),className:"finalize-button",children:"\uD83C\uDFC1 Finalizar"}),(0,s.jsx)("button",{onClick:()=>l(n,"reiniciar"),className:"reset-button",children:"\uD83D\uDD04 Reiniciar"})]}),"completed"===y&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"completed-message",children:"✅ Bloque finalizado"}),(0,s.jsx)("button",{onClick:()=>l(n,"reiniciar"),className:"reset-button",children:"\uD83D\uDD04 Reiniciar"})]}),(0,s.jsx)("button",{onClick:ee,className:"edit-button",children:"✏️ Editar"})]}),(0,s.jsxs)("div",{className:"total-viewers",children:["\uD83D\uDC65 ",S," viewers totales"]})]})]})};class g{static async requestPermission(){if(!("Notification"in window))return console.warn("Este navegador no soporta notificaciones"),!1;if("granted"===Notification.permission)return this.hasPermission=!0,!0;if("denied"!==Notification.permission){let e=await Notification.requestPermission();return this.hasPermission="granted"===e,this.hasPermission}return!1}static async showNotification(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!this.hasPermission&&!await this.requestPermission())return;let a=new Notification(e,{icon:"/favicon.ico",badge:"/favicon.ico",...t});return setTimeout(()=>{a.close()},5e3),a}static playSound(e){try{let t=new(window.AudioContext||window.webkitAudioContext);({success:[523,659,784],error:[370,415,466],warning:[440,554],info:[523,698]})[e].forEach((e,a)=>{let s=t.createOscillator(),r=t.createGain();s.connect(r),r.connect(t.destination),s.frequency.setValueAtTime(e,t.currentTime),s.type="sine",r.gain.setValueAtTime(0,t.currentTime),r.gain.linearRampToValueAtTime(.1,t.currentTime+.01),r.gain.exponentialRampToValueAtTime(.001,t.currentTime+.3);let n=t.currentTime+.1*a;s.start(n),s.stop(n+.3)})}catch(e){console.warn("No se pudo reproducir el sonido:",e)}}}g.hasPermission=!1;let v=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3e3,s=document.createElement("div");s.className="toast toast-".concat(t),s.innerHTML='\n    <div class="toast-content">\n      <span class="toast-icon">'.concat({success:"✅",error:"❌",warning:"⚠️",info:"ℹ️"}[t]||"ℹ️",'</span>\n      <span class="toast-message">').concat(e,"</span>\n    </div>\n  "),Object.assign(s.style,{position:"fixed",top:"20px",right:"20px",zIndex:"10000",padding:"12px 16px",borderRadius:"8px",color:"white",fontWeight:"500",fontSize:"14px",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.2)",transform:"translateX(100%)",transition:"transform 0.3s ease",maxWidth:"300px",wordWrap:"break-word"}),s.style.background=({success:"linear-gradient(135deg, #10b981, #059669)",error:"linear-gradient(135deg, #ef4444, #dc2626)",warning:"linear-gradient(135deg, #f59e0b, #d97706)",info:"linear-gradient(135deg, #3b82f6, #2563eb)"})[t],document.body.appendChild(s),setTimeout(()=>{s.style.transform="translateX(0)"},10),setTimeout(()=>{s.style.transform="translateX(100%)",setTimeout(()=>{s.parentNode&&s.parentNode.removeChild(s)},300)},a)};a(4788);var b=()=>{let{theme:e}=(0,i.F)(),{totalViewers:t,getExpiredViewersCount:a,getTotalViewersSent:r}=h(),[n,l]=(0,o.useState)({totalOperations:0,successfulOperations:0,failedOperations:0,totalCost:0,totalViewers:0,totalResetOperations:0,totalResetViewers:0,operationsPerBlock:{},viewersPerHour:{},viewersByServiceDuration:{},costByServiceDuration:{},youtubeStreams:{},lastUpdated:new Date().toISOString()}),[c,d]=(0,o.useState)([]),[u,m]=(0,o.useState)(!1),[x,b]=(0,o.useState)(!1),[j,D]=(0,o.useState)(!1),f=(0,o.useCallback)(()=>{let e=[],t=localStorage.getItem("globalOperationsHistory");if(t)try{JSON.parse(t).forEach(t=>{e.push({...t,isHistorical:!0})})}catch(e){console.error("Error parsing global history:",e)}return e.sort((e,t)=>{let a=new Date(e.savedAt||e.timestamp);return new Date(t.savedAt||t.timestamp).getTime()-a.getTime()})},[]),w=(0,o.useCallback)(()=>{let e="blockResetHistory",t=localStorage.getItem(e);if(console.log("\uD83D\uDD0D Debug Reset History:",{key:e,exists:!!t,rawData:t,length:(null==t?void 0:t.length)||0}),t)try{let e=JSON.parse(t);return console.log("\uD83D\uDCCA Parsed Reset History:",{totalResets:e.length,sampleData:e.slice(0,3),totalOperationsLost:e.reduce((e,t)=>e+(t.operationsLost||0),0),totalViewersLost:e.reduce((e,t)=>e+(t.viewersLost||0),0)}),e}catch(e){return console.error("Error parsing reset history:",e),[]}console.log("⚠️ No se encontr\xf3 historial de resets, buscando en otras claves..."),console.log("\uD83D\uDD0D Claves posibles para resets:",Object.keys(localStorage).filter(e=>e.toLowerCase().includes("reset")||e.toLowerCase().includes("history")||e.includes("block")&&e.includes("reset")));for(let e=0;e<10;e++){let t="blockState_block-".concat(e),a=localStorage.getItem(t);if(a)try{let t=JSON.parse(a);t.status&&t.status.length>0&&t.totalViewers>0&&console.log("\uD83D\uDCCB Bloque ".concat(e," tiene datos:"),{operations:t.status.length,viewers:t.totalViewers,lastSaved:t.lastSaved})}catch(t){console.error("Error parsing block ".concat(e,":"),t)}}return[]},[]);(0,o.useCallback)(()=>{let e=localStorage.getItem("blockResetHistory");return e&&"[]"!==e||console.log("⚠️ No hay datos de reset history, no se crean datos de prueba autom\xe1ticamente"),null},[]);let N=(0,o.useCallback)(()=>0===n.totalOperations?0:n.successfulOperations/n.totalOperations*100,[n.totalOperations,n.successfulOperations]),y=e=>{switch(e){case 334:return 1;case 335:return 1.5;case 336:return 2;case 337:return 2.5;case 338:return 3;case 459:return 4;case 460:return 6;case 657:return 8;default:return 0}},C=(0,o.useCallback)(()=>{let e=f(),t=[],a=new Date;return e.forEach(e=>{if("success"===e.status&&e.savedAt&&e.duration)try{let s=new Date(e.savedAt),r=new Date(s.getTime()+6e4*e.duration);if(a>=r){let n=s.toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit",second:"2-digit"}),o=r.toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit",second:"2-digit"}),i=s.toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric"});t.push({...e,startTimeFormatted:n,endTimeFormatted:o,dateFormatted:i,startTime:s,endTime:r,minutesExpired:Math.floor((a.getTime()-r.getTime())/6e4)})}}catch(e){console.warn("Error processing operation for expiration:",e)}}),t.sort((e,t)=>t.endTime.getTime()-e.endTime.getTime())},[f]),S=(0,o.useCallback)(()=>{let e={};try{Object.keys(localStorage).filter(e=>e.startsWith("youtubeMonitor_")||e.includes("youtube")).forEach(t=>{try{let a=JSON.parse(localStorage.getItem(t)||"{}");if(a.url&&void 0!==a.viewers){let t=k(a.url);t&&(e[a.url]={videoId:t,url:a.url,title:a.title||"Stream de YouTube",currentViewers:a.viewers||0,isLive:a.isLive||!1,lastUpdated:a.timestamp||new Date().toISOString(),trend:a.trend||"stable",growthPercent:a.growthPercent||0,predictedFinal:a.predictedFinal||0})}}catch(e){console.warn("Error parsing YouTube data:",e)}}),0===Object.keys(e).length&&Object.keys(sessionStorage).filter(e=>e.includes("youtube")||e.includes("monitor")).forEach(t=>{try{let a=JSON.parse(sessionStorage.getItem(t)||"{}");if(a.url&&void 0!==a.viewers){let t=k(a.url);t&&(e[a.url]={videoId:t,url:a.url,title:a.title||"Stream de YouTube",currentViewers:a.viewers||0,isLive:a.isLive||!1,lastUpdated:a.timestamp||new Date().toISOString(),trend:a.trend||"stable",growthPercent:a.growthPercent||0,predictedFinal:a.predictedFinal||0})}}catch(e){console.warn("Error parsing YouTube session data:",e)}})}catch(e){console.error("Error getting YouTube streams data:",e)}return e},[]),k=e=>{try{let t=e.match(/(?:youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/embed\/)([^&\n?#]+)/);return t?t[1]:null}catch(e){return null}},T=(0,o.useCallback)(()=>{let e=f(),t=w(),a=R(),s=new Blob([JSON.stringify({reportInfo:{generatedAt:new Date().toISOString(),generatedBy:"Dashboard de M\xe9tricas",reportType:"Complete Operations Report",totalOperationsIncludingHistory:e.length,blocksResetCount:t.length,youtubeStreamsMonitored:Object.keys(n.youtubeStreams).length,youtubeHistoryEntries:a.length},summary:{totalOperations:n.totalOperations,successfulOperations:n.successfulOperations,failedOperations:n.failedOperations,successRate:N(),totalCost:n.totalCost,totalViewersSent:r(),totalResetOperations:n.totalResetOperations,totalResetViewers:n.totalResetViewers,costPerViewer:r()>0?n.totalCost/r():0},operationsPerBlock:n.operationsPerBlock,viewersPerHour:n.viewersPerHour,viewersByServiceDuration:n.viewersByServiceDuration,youtubeStreams:{currentStreams:n.youtubeStreams,monitoringHistory:a.sort((e,t)=>new Date(t.timestamp||t.lastUpdate||0).getTime()-new Date(e.timestamp||e.lastUpdate||0).getTime())},allOperations:e,blockResetHistory:t,alerts:c},null,2)],{type:"application/json"}),o=URL.createObjectURL(s),i=document.createElement("a");i.href=o,i.download="dashboard-report-".concat(new Date().toISOString().split("T")[0],".json"),document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(o),v("\uD83D\uDCC4 Reporte JSON descargado exitosamente","success")},[n,c,f,w,N]),O=(0,o.useCallback)(()=>{let e=f(),t=R(),a=e.map(e=>{let t="N/A",a=e.timestamp;if(e.duration&&(e.savedAt||e.startTime))try{let a=e.savedAt||e.startTime,s=new Date(a);if(!isNaN(s.getTime())){let a=new Date(s.getTime()+6e4*e.duration);if(!isNaN(a.getTime())){let e=a.getHours().toString().padStart(2,"0"),s=a.getMinutes().toString().padStart(2,"0"),r=a.getSeconds().toString().padStart(2,"0");t="".concat(e,":").concat(s,":").concat(r)}}}catch(e){console.warn("Error calculando tiempo de finalizaci\xf3n en CSV:",e),t="N/A"}return[e.timestamp,a||"N/A",t||"N/A","Bloque ".concat(parseInt((e.blockId||"block-0").replace("block-",""))+1),e.status,e.message.replace(/,/g,";"),e.duration||0,e.count||0,e.serviceId||"",e.cost||0,e.orderId||"",e.orderStatus||"",e.isHistorical?"S\xed":"No"]}),s=t.map(e=>{let t=e.change||0,a=0===t?"0":t>0?"+".concat(t.toLocaleString()):t.toLocaleString();return[new Date(e.timestamp||e.lastUpdate||0).toLocaleString("es-ES"),e.url||"",(e.title||"").replace(/,/g,";"),e.currentViewers||0,e.isLive?"En Vivo":"Offline",e.trend||"N/A",a,e.source||"YouTube Monitor"]}),r=[["Fecha y Hora","Hora Inicio","Hora Finalizaci\xf3n","Bloque","Estado","Mensaje","Duraci\xf3n (min)","Viewers","Service ID","Costo","Order ID","Order Status","Es Hist\xf3rico"],...a].map(e=>e.map(e=>'"'.concat(e,'"')).join(",")).join("\n"),o=new Blob([r+(s.length>0?["\n\n=== HISTORIAL DE YOUTUBE ===",["Fecha y Hora","URL","T\xedtulo","Viewers","Estado (Live/Offline)","Tendencia","Cambio","Fuente"],...s].map(e=>Array.isArray(e)?e.map(e=>'"'.concat(e,'"')).join(","):e).join("\n"):"\n\n=== HISTORIAL DE YOUTUBE ===\nNo hay datos de YouTube disponibles")+["\n\n=== RESUMEN POR DURACI\xd3N DE SERVICIO ===","Duraci\xf3n,Viewers,Costo Total",...Object.entries(n.viewersByServiceDuration).sort((e,t)=>{let[a]=e,[s]=t;return parseFloat(a)-parseFloat(s)}).map(e=>{let[t,a]=e,s=n.costByServiceDuration[t]||0;return'"'.concat(t,'","').concat(a,'","$').concat(s.toFixed(2),'"')})].join("\n")],{type:"text/csv;charset=utf-8;"}),i=URL.createObjectURL(o),l=document.createElement("a");l.href=i,l.download="operaciones-report-".concat(new Date().toISOString().split("T")[0],".csv"),document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(i),v("\uD83D\uDCCA Reporte CSV descargado exitosamente","success")},[f]),E=(0,o.useCallback)(()=>{let e=f(),t=w(),a=N(),s=R(),o=new Blob(['<!DOCTYPE html>\n<html lang="es">\n<head>\n    <meta charset="UTF-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <title>Reporte Ejecutivo - Dashboard de M\xe9tricas</title>\n    <style>\n        body { font-family: Arial, sans-serif; margin: 40px; line-height: 1.6; }\n        .header { text-align: center; margin-bottom: 40px; }\n        .logo { color: #4CAF50; font-size: 24px; font-weight: bold; }\n        .summary-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin: 30px 0; }\n        .metric-card { background: #f9f9f9; padding: 20px; border-radius: 8px; border-left: 4px solid #4CAF50; }\n        .metric-value { font-size: 24px; font-weight: bold; color: #333; }\n        .metric-label { color: #666; font-size: 14px; }\n        .operations-table { width: 100%; border-collapse: collapse; margin: 30px 0; }\n        .operations-table th, .operations-table td { border: 1px solid #ddd; padding: 12px; text-align: left; }\n        .operations-table th { background-color: #4CAF50; color: white; }\n        .operations-table tr:nth-child(even) { background-color: #f2f2f2; }\n        .status-success { color: #4CAF50; font-weight: bold; }\n        .status-error { color: #f44336; font-weight: bold; }\n        .historical { background-color: #fff3cd; }\n        .footer { margin-top: 40px; text-align: center; color: #666; font-size: 12px; }\n        .reset-section { margin: 30px 0; padding: 20px; background: #fff3cd; border-radius: 8px; }\n    </style>\n</head>\n<body>\n    <div class="header">\n        <div class="logo">\uD83D\uDCCA REPORTE EJECUTIVO - DASHBOARD DE M\xc9TRICAS</div>\n        <p>Generado el: '.concat(new Date().toLocaleString("es-ES"),"</p>\n        <p><strong>Total de operaciones (incluyendo historial): ").concat(e.length,'</strong></p>\n    </div>\n\n    <div class="summary-grid">\n        <div class="metric-card">\n            <div class="metric-value">').concat(n.totalOperations,'</div>\n            <div class="metric-label">Total Operaciones</div>\n        </div>\n        <div class="metric-card">\n            <div class="metric-value">').concat(a.toFixed(1),'%</div>\n            <div class="metric-label">Tasa de \xc9xito</div>\n        </div>\n        <div class="metric-card">\n            <div class="metric-value">').concat(r().toLocaleString(),'</div>\n            <div class="metric-label">Total Viewers Enviados</div>\n        </div>\n        <div class="metric-card">\n            <div class="metric-value">$').concat(n.totalCost.toFixed(2),'</div>\n            <div class="metric-label">Costo Total</div>\n        </div>\n        <div class="metric-card">\n            <div class="metric-value">').concat(n.totalResetOperations,'</div>\n            <div class="metric-label">Operaciones de Bloques Reiniciados</div>\n        </div>\n        <div class="metric-card">\n            <div class="metric-value">$').concat(r()>0?(n.totalCost/r()).toFixed(4):"0.0000",'</div>\n            <div class="metric-label">Costo por Viewer</div>\n        </div>\n        <div class="metric-card">\n            <div class="metric-value">').concat(n.totalResetViewers.toLocaleString(),'</div>\n            <div class="metric-label">Viewers de Bloques Reiniciados</div>\n        </div>\n        <div class="metric-card">\n            <div class="metric-value">').concat(t.length,'</div>\n            <div class="metric-label">Bloques Reiniciados</div>\n        </div>\n    </div>\n\n    <h2>\uD83D\uDCC8 Operaciones por Bloque</h2>\n    <table class="operations-table">\n        <thead>\n            <tr>\n                <th>Bloque</th>\n                <th>Operaciones</th>\n                <th>Porcentaje</th>\n            </tr>\n        </thead>\n        <tbody>\n            ').concat(Object.entries(n.operationsPerBlock).map(e=>{let[t,a]=e;return"\n                <tr>\n                    <td>Bloque ".concat(parseInt(t.replace("block-",""))+1,"</td>\n                    <td>").concat(a,"</td>\n                    <td>").concat(n.totalOperations>0?(a/n.totalOperations*100).toFixed(1):0,"%</td>\n                </tr>\n            ")}).join(""),'\n        </tbody>\n    </table>\n\n    <h2>⏱️ Viewers por Duraci\xf3n de Servicio</h2>\n    <table class="operations-table">\n        <thead>\n            <tr>\n                <th>Duraci\xf3n</th>\n                <th>Viewers</th>\n                <th>Costo Total</th>\n                <th>Porcentaje del Total</th>\n            </tr>\n        </thead>\n        <tbody>\n            ').concat(Object.entries(n.viewersByServiceDuration).sort((e,t)=>{let[a]=e,[s]=t;return parseFloat(a)-parseFloat(s)}).map(e=>{let[t,a]=e,s=n.costByServiceDuration[t]||0,o=r();return"\n                <tr>\n                    <td>".concat(t,"</td>\n                    <td>").concat(a.toLocaleString(),"</td>\n                    <td>$").concat(s.toFixed(2),"</td>\n                    <td>").concat(o>0?(a/o*100).toFixed(1):0,"%</td>\n                </tr>\n                ")}).join(""),"\n        </tbody>\n    </table>\n\n    ").concat(t.length>0?'\n    <div class="reset-section">\n        <h2>� Historial de Reinicializaciones</h2>\n        <table class="operations-table">\n            <thead>\n                <tr>\n                    <th>Fecha</th>\n                    <th>Bloque</th>\n                    <th>Operaciones Enviadas</th>\n                    <th>Viewers Enviados</th>\n                </tr>\n            </thead>\n            <tbody>\n                '.concat(t.slice(-10).map(e=>"\n                    <tr>\n                        <td>".concat(new Date(e.resetAt).toLocaleString("es-ES"),"</td>\n                        <td>").concat(e.blockTitle,"</td>\n                        <td>").concat(e.operationsLost,"</td>\n                        <td>").concat(e.viewersLost.toLocaleString(),"</td>\n                    </tr>\n                ")).join(""),"\n            </tbody>\n        </table>\n    </div>\n    "):"","\n\n    ").concat(s.length>0?'\n    <h2>\uD83D\uDCFA Historial de Monitoreo de YouTube</h2>\n    <table class="operations-table">\n        <thead>\n            <tr>\n                <th>Fecha y Hora</th>\n                <th>T\xedtulo</th>\n                <th>Viewers</th>\n                <th>Estado</th>\n                <th>Tendencia</th>\n                <th>Cambio</th>\n            </tr>\n        </thead>\n        <tbody>\n            '.concat(s.slice(0,50).map(e=>"\n                <tr>\n                    <td>".concat(new Date(e.timestamp||e.lastUpdate||0).toLocaleString("es-ES"),"</td>\n                    <td>").concat((e.title||"Stream de YouTube").replace(/</g,"&lt;").replace(/>/g,"&gt;"),"</td>\n                    <td>").concat((e.viewers||e.currentViewers||0).toLocaleString(),"</td>\n                    <td>").concat(e.isLive?"\uD83D\uDD34 En Vivo":"⏹️ Offline","</td>\n                    <td>").concat("up"===e.trend?"\uD83D\uDCC8 Subiendo":"down"===e.trend?"\uD83D\uDCC9 Bajando":"➡️ Estable","</td>\n                    <td>").concat((()=>{let t=e.change||0;return 0===t?"0":t>0?"+".concat(t.toLocaleString()):t.toLocaleString()})(),"</td>\n                </tr>\n            ")).join(""),"\n        </tbody>\n    </table>\n    <p><em>Mostrando las \xfaltimas 50 mediciones de YouTube</em></p>\n    "):"",'\n\n    <h2>\uD83D\uDCCB Todas las Operaciones</h2>\n    <p><em>Nota: Las operaciones con fondo amarillo son del historial (de bloques reiniciados)</em></p>\n    <table class="operations-table">\n        <thead>\n            <tr>\n                <th>Fecha y Hora</th>\n                <th>Hora Inicio</th>\n                <th>Finalizaci\xf3n</th>\n                <th>Bloque</th>\n                <th>Estado</th>\n                <th>Viewers</th>\n                <th>Duraci\xf3n</th>\n                <th>Costo</th>\n            </tr>\n        </thead>\n        <tbody>\n            ').concat(e.map(e=>{let t="N/A",a=e.timestamp;if(e.duration&&(e.savedAt||e.startTime))try{let a=e.savedAt||e.startTime,s=new Date(a);if(!isNaN(s.getTime())){let a=new Date(s.getTime()+6e4*e.duration);if(!isNaN(a.getTime())){let e=a.getHours().toString().padStart(2,"0"),s=a.getMinutes().toString().padStart(2,"0"),r=a.getSeconds().toString().padStart(2,"0");t="".concat(e,":").concat(s,":").concat(r)}}}catch(e){console.warn("Error calculando tiempo de finalizaci\xf3n en HTML:",e),t="N/A"}return"\n                <tr ".concat(e.isHistorical?'class="historical"':"",">\n                    <td>").concat(e.timestamp,"</td>\n                    <td>").concat(a||"N/A","</td>\n                    <td>").concat(t||"N/A","</td>\n                    <td>Bloque ").concat(parseInt((e.blockId||"block-0").replace("block-",""))+1,'</td>\n                    <td class="status-').concat(e.status,'">').concat("success"===e.status?"✅ Exitosa":"❌ Fallida","</td>\n                    <td>").concat(e.count||0,"</td>\n                    <td>").concat(e.duration||0," min</td>\n                    <td>$").concat(e.cost||0,"</td>\n                </tr>\n              ")}).join(""),'\n        </tbody>\n    </table>\n\n    <div class="footer">\n        <p>Reporte generado autom\xe1ticamente por Dashboard de M\xe9tricas</p>\n        <p>\xa9 ').concat(new Date().getFullYear()," - Todos los derechos reservados</p>\n        <p><strong>Total de operaciones procesadas: ").concat(e.length,"</strong></p>\n    </div>\n</body>\n</html>")],{type:"text/html;charset=utf-8;"}),i=URL.createObjectURL(o),l=document.createElement("a");l.href=i,l.download="reporte-ejecutivo-".concat(new Date().toISOString().split("T")[0],".html"),document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(i),v("\uD83D\uDCCB Reporte ejecutivo descargado exitosamente","success")},[n,f,w]),I=(0,o.useCallback)(()=>{let e={totalOperations:0,successfulOperations:0,failedOperations:0,totalCost:0,totalViewers:0,totalResetOperations:0,totalResetViewers:0,operationsPerBlock:{},viewersPerHour:{},viewersByServiceDuration:{},costByServiceDuration:{},youtubeStreams:{},lastUpdated:new Date().toISOString()},t=0,a=0,s=f(),r=0;s.forEach(s=>{let n=s.blockId||"block-".concat(s.blockId);if(e.operationsPerBlock[n]=(e.operationsPerBlock[n]||0)+1,e.totalOperations++,"success"===s.status){e.successfulOperations++;let n=s.cost||0;e.totalCost+=n;let o=s.count||0;if(r+=o,s.duration&&(t+=s.duration,a++),s.timestamp&&s.count){let t=s.timestamp.split(":")[0]+":00";e.viewersPerHour[t]=(e.viewersPerHour[t]||0)+s.count}if(s.serviceId&&s.count){let t=y(s.serviceId),a="".concat(t,"h");e.viewersByServiceDuration[a]=(e.viewersByServiceDuration[a]||0)+s.count,void 0!==s.cost&&(e.costByServiceDuration[a]=(e.costByServiceDuration[a]||0)+s.cost)}}else e.failedOperations++}),e.totalViewers=r,console.log("\uD83D\uDCCA M\xe9tricas calculadas:",{totalOperations:e.totalOperations,successfulOperations:e.successfulOperations,totalViewersFromOperations:r,note:"totalViewers ahora refleja viewers realmente enviados"});let n=w();console.log("\uD83D\uDCCA Calculando m\xe9tricas de resets:",{resetHistoryLength:n.length,resetHistory:n.slice(0,5)}),n.forEach(t=>{let a=t.operationsLost||0,s=t.viewersLost||0;console.log("\uD83D\uDD04 Procesando reset:",{blockId:t.blockId,blockTitle:t.blockTitle,operationsLost:a,viewersLost:s,resetAt:t.resetAt,note:"operationsLost = operaciones exitosas enviadas, viewersLost = viewers enviados"}),e.totalResetOperations+=a,e.totalResetViewers+=s}),console.log("✅ M\xe9tricas finales de resets:",{totalResetOperations:e.totalResetOperations,totalResetViewers:e.totalResetViewers}),e.youtubeStreams=S(),l(e)},[f,S,w]),L=(0,o.useCallback)(()=>{let e=[],t=new Date().toLocaleTimeString(),a=n.totalOperations>0?n.failedOperations/n.totalOperations*100:0;if(a>20&&n.totalOperations>5){let s={id:"high-failure-rate-".concat(Math.floor(a)),type:"error",title:"⚠️ Alta Tasa de Fallo",message:"".concat(a.toFixed(1),"% de operaciones est\xe1n fallando"),timestamp:t};e.push(s)}let s=parseInt(localStorage.getItem("lastKnownViewers")||"0");if(n.totalViewers>s){let a=Math.floor(n.totalViewers/1e3);if(a>Math.floor(s/1e3)&&n.totalViewers>=1e3){let r={id:"milestone-".concat(a,"k-").concat(Date.now()),type:"success",title:"\uD83C\uDFAF Objetivo Alcanzado",message:"\xa1Has alcanzado ".concat(n.totalViewers.toLocaleString()," viewers! (+").concat(n.totalViewers-s," nuevos)"),timestamp:t};e.push(r)}localStorage.setItem("lastKnownViewers",n.totalViewers.toString())}let r=parseFloat(localStorage.getItem("lastKnownCost")||"0");if(n.totalCost>r&&n.totalCost>500){let a={id:"high-cost-".concat(Math.floor(n.totalCost),"-").concat(Date.now()),type:"warning",title:"\uD83D\uDCB0 Costo Elevado",message:"Costo total: $".concat(n.totalCost.toFixed(2)," (+$").concat((n.totalCost-r).toFixed(2),")"),timestamp:t};e.push(a),localStorage.setItem("lastKnownCost",n.totalCost.toString())}else n.totalCost>r&&localStorage.setItem("lastKnownCost",n.totalCost.toString());let o=parseInt(localStorage.getItem("lastKnownOperations")||"0"),i=n.totalOperations-o;if(i>0){if(i>=5){let a={id:"batch-completed-".concat(Date.now()),type:"info",title:"\uD83D\uDCCA Lote Completado",message:"Se completaron ".concat(i," operaciones nuevas"),timestamp:t};e.push(a)}localStorage.setItem("lastKnownOperations",n.totalOperations.toString())}let l=parseInt(localStorage.getItem("lastKnownSuccessful")||"0"),c=n.successfulOperations-l;if(c>0){if(c>=3){let a={id:"success-streak-".concat(Date.now()),type:"success",title:"✅ Racha de \xc9xito",message:"".concat(c," operaciones exitosas completadas"),timestamp:t};e.push(a)}localStorage.setItem("lastKnownSuccessful",n.successfulOperations.toString())}return e},[n]);(0,o.useEffect)(()=>{I();let e=setInterval(I,2e3);return()=>clearInterval(e)},[I]),(0,o.useEffect)(()=>{let e=L();e.length>0&&d(t=>{let a=t.map(e=>e.id),s=e.filter(e=>!a.includes(e.id));return s.forEach(e=>{g.showNotification(e.title,{body:e.message,tag:e.id,silent:"info"===e.type}),g.playSound(e.type),v(e.message,e.type)}),[...t,...s].slice(-10)})},[L]);let A=e=>{d(t=>t.filter(t=>t.id!==e))},F=e=>{try{Object.keys(localStorage).filter(e=>e.startsWith("youtubeMonitor_")||e.includes("youtube")).forEach(t=>{try{JSON.parse(localStorage.getItem(t)||"{}").url===e&&localStorage.removeItem(t)}catch(e){console.warn("Error checking localStorage key:",t,e)}}),Object.keys(sessionStorage).filter(e=>e.includes("youtube")||e.includes("monitor")).forEach(t=>{try{JSON.parse(sessionStorage.getItem(t)||"{}").url===e&&sessionStorage.removeItem(t)}catch(e){console.warn("Error checking sessionStorage key:",t,e)}}),I(),v("Stream eliminado del monitoreo","info")}catch(e){console.error("Error eliminando stream de YouTube:",e),v("❌ Error al eliminar stream","error")}},R=(0,o.useCallback)(()=>{let e=[];try{var t,a;let s=Object.keys(localStorage);console.log("\uD83D\uDD0D Buscando historial de YouTube en localStorage..."),console.log("\uD83D\uDCCA Total de claves en localStorage:",s.length);let r=s.filter(e=>e.startsWith("youtubeHistory_"));console.log("\uD83D\uDCC8 Claves de historial encontradas:",r.length,r),r.forEach(t=>{try{let a=JSON.parse(localStorage.getItem(t)||"[]");Array.isArray(a)&&(console.log("\uD83D\uDCDA Procesando historial ".concat(t," con ").concat(a.length," entradas")),a.forEach(a=>{a.url&&(void 0!==a.viewers||void 0!==a.currentViewers)&&e.push({url:a.url,title:a.title||"Stream de YouTube",viewers:a.viewers||a.currentViewers||0,currentViewers:a.viewers||a.currentViewers||0,isLive:a.isLive||!1,timestamp:a.timestamp||a.lastUpdated||new Date().toISOString(),trend:a.trend||"stable",growthPercent:a.growthPercent||0,change:a.change||a.growthPercent||0,estado:a.estado||(a.isLive?"En Vivo":"Offline"),source:a.source||t})}))}catch(e){console.warn("⚠️ Error parsing YouTube history from ".concat(t,":"),e)}}),0===e.length&&(console.log("\uD83D\uDD04 No se encontr\xf3 historial espec\xedfico, buscando datos individuales..."),s.forEach(t=>{if(t.includes("youtube")||t.includes("YouTube"))try{let a=JSON.parse(localStorage.getItem(t)||"{}");a.url&&(void 0!==a.viewers||void 0!==a.currentViewers)&&(console.log("� Encontrado objeto individual en ".concat(t,":"),a),e.push({url:a.url,title:a.title||"Stream de YouTube",viewers:a.viewers||a.currentViewers||0,currentViewers:a.viewers||a.currentViewers||0,isLive:a.isLive||!1,timestamp:a.timestamp||a.lastUpdated||new Date().toISOString(),trend:a.trend||"stable",growthPercent:a.growthPercent||0,change:a.change||a.growthPercent||0,estado:a.isLive?"En Vivo":"Offline",source:t}))}catch(e){console.warn("⚠️ Error parsing individual YouTube data from ".concat(t,":"),e)}})),console.log("\uD83D\uDCCA Total de entradas de historial encontradas: ".concat(e.length));let n=e.filter((e,t,a)=>a.findIndex(t=>t.url===e.url&&t.timestamp===e.timestamp&&t.viewers===e.viewers)===t);console.log("\uD83D\uDCC8 Entradas \xfanicas despu\xe9s de eliminar duplicados: ".concat(n.length));let o=n.sort((e,t)=>{let a=new Date(e.timestamp||0);return new Date(t.timestamp||0).getTime()-a.getTime()});return console.log("\uD83D\uDCCA Historial de YouTube procesado:",{totalEntries:o.length,uniqueUrls:Array.from(new Set(o.map(e=>e.url))).length,dateRange:o.length>0?{newest:null===(t=o[0])||void 0===t?void 0:t.timestamp,oldest:null===(a=o[o.length-1])||void 0===a?void 0:a.timestamp}:null}),o}catch(e){return console.error("❌ Error getting YouTube monitoring history:",e),[]}},[]),M=(0,o.useCallback)(()=>{let e=C();if(0===e.length){v("⚠️ No hay operaciones expiradas para descargar","warning");return}let t=new Blob([[["Fecha","Bloque","Hora Inicio","Hora Finalizaci\xf3n","Duraci\xf3n (min)","Viewers","Costo ($)","Service ID","Minutos Expirados","Estado"],...e.map(e=>[e.dateFormatted,"Bloque ".concat(parseInt((e.blockId||"block-0").replace("block-",""))+1),e.startTimeFormatted,e.endTimeFormatted,e.duration||0,(e.count||0).toLocaleString(),(e.cost||0).toFixed(2),e.serviceId||"N/A",e.minutesExpired,"Expirada"])].map(e=>e.map(e=>'"'.concat(e,'"')).join(",")).join("\n")],{type:"text/csv;charset=utf-8;"}),a=URL.createObjectURL(t),s=document.createElement("a");s.href=a,s.download="operaciones-expiradas-".concat(new Date().toISOString().split("T")[0],".csv"),document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(a),v("\uD83D\uDCE5 Operaciones expiradas descargadas","success")},[C]),V=(0,o.useCallback)(()=>{let e=new Blob([[["Bloque","Estado","Hora Inicio","Finalizaci\xf3n Estimada","Duraci\xf3n (min)","Viewers","Costo ($)","Es Hist\xf3rico"],...f().map(e=>{let t="N/A",a=e.timestamp;if(e.duration&&(e.savedAt||e.startTime))try{let a=e.savedAt||e.startTime,s=new Date(a);if(!isNaN(s.getTime())){let a=new Date(s.getTime()+6e4*e.duration);if(!isNaN(a.getTime())){let e=a.getHours().toString().padStart(2,"0"),s=a.getMinutes().toString().padStart(2,"0"),r=a.getSeconds().toString().padStart(2,"0");t="".concat(e,":").concat(s,":").concat(r)}}}catch(e){t="N/A"}return["Bloque ".concat(parseInt((e.blockId||"block-0").replace("block-",""))+1),"success"===e.status?"Exitosa":"Fallida",a||"N/A",t,e.duration||0,(e.count||0).toLocaleString(),(e.cost||0).toFixed(2),e.isHistorical?"S\xed":"No"]})].map(e=>e.map(e=>'"'.concat(e,'"')).join(",")).join("\n")],{type:"text/csv;charset=utf-8;"}),t=URL.createObjectURL(e),a=document.createElement("a");a.href=t,a.download="tabla-operaciones-".concat(new Date().toISOString().split("T")[0],".csv"),document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(t),v("\uD83D\uDCCA Tabla de operaciones descargada","success")},[f]),B=(0,o.useCallback)(()=>{let e=R();if(0===e.length){v("⚠️ No hay historial de YouTube para descargar","warning");return}let t=e.map(e=>{let t=e.change||0,a=0===t?"0":t>0?"+".concat(t.toLocaleString()):t.toLocaleString();return{"Fecha y Hora":new Date(e.timestamp||e.lastUpdate||0).toLocaleString("es-ES"),Título:e.title||"Stream de YouTube",Viewers:e.viewers||e.currentViewers||0,Estado:e.isLive?"En Vivo":"Offline",Tendencia:"up"===e.trend?"Subiendo":"down"===e.trend?"Bajando":"Estable",Cambio:a,URL:e.url||"",Fuente:e.source||"YouTube Monitor"}});try{let e=p.P6.book_new(),a=p.P6.json_to_sheet(t);a["!cols"]=[{wch:20},{wch:40},{wch:12},{wch:12},{wch:12},{wch:12},{wch:50},{wch:20}],p.P6.book_append_sheet(e,a,"Historial YouTube");let s="historial-youtube-".concat(new Date().toISOString().split("T")[0],".xlsx");p.NC(e,s),v("\uD83D\uDCFA Historial de YouTube descargado como Excel","success")}catch(e){console.error("Error generando archivo Excel:",e),v("❌ Error al generar archivo Excel","error")}},[R]);return(0,s.jsxs)("div",{className:"metrics-dashboard ".concat(e),children:[(0,s.jsxs)("div",{className:"metrics-header",children:[(0,s.jsx)("h2",{children:"\uD83D\uDCCA Dashboard de M\xe9tricas"}),(0,s.jsxs)("div",{className:"metrics-actions",children:[(0,s.jsxs)("button",{onClick:()=>m(!u),className:"alerts-button ".concat(c.length>0?"has-alerts":""),children:["\uD83D\uDD14 Alertas (",c.length,")"]}),(0,s.jsxs)("div",{className:"export-buttons",style:{display:"flex",gap:"0.5rem",flexWrap:"wrap"},children:[(0,s.jsx)("button",{onClick:T,className:"export-button",title:"Descargar datos completos en JSON",children:"\uD83D\uDCC4 JSON"}),(0,s.jsx)("button",{onClick:O,className:"export-button",title:"Descargar operaciones en CSV",children:"\uD83D\uDCCA CSV"}),(0,s.jsx)("button",{onClick:E,className:"export-button",title:"Descargar reporte ejecutivo",children:"\uD83D\uDCCB Reporte"})]}),(0,s.jsxs)("span",{className:"last-updated",children:["Actualizado: ",new Date(n.lastUpdated).toLocaleTimeString()]})]})]}),u&&(0,s.jsxs)("div",{className:"alerts-panel",children:[(0,s.jsx)("h3",{children:"\uD83D\uDD14 Alertas Recientes"}),0===c.length?(0,s.jsx)("p",{className:"no-alerts",children:"No hay alertas pendientes"}):c.map(e=>(0,s.jsxs)("div",{className:"alert alert-".concat(e.type),children:[(0,s.jsxs)("div",{className:"alert-content",children:[(0,s.jsx)("strong",{children:e.title}),(0,s.jsx)("p",{children:e.message}),(0,s.jsx)("small",{children:e.timestamp})]}),(0,s.jsx)("button",{onClick:()=>A(e.id),className:"alert-close",children:"✕"})]},e.id))]}),(0,s.jsxs)("div",{className:"metrics-grid",children:[(0,s.jsxs)("div",{className:"metric-card",children:[(0,s.jsx)("div",{className:"metric-icon",children:"\uD83D\uDCC8"}),(0,s.jsxs)("div",{className:"metric-content",children:[(0,s.jsx)("h3",{children:"Total Operaciones"}),(0,s.jsx)("div",{className:"metric-value",children:n.totalOperations}),(0,s.jsxs)("div",{className:"metric-subtitle",children:["✅ ",n.successfulOperations," | ❌ ",n.failedOperations]})]})]}),(0,s.jsxs)("div",{className:"metric-card",children:[(0,s.jsx)("div",{className:"metric-icon",children:"\uD83C\uDFAF"}),(0,s.jsxs)("div",{className:"metric-content",children:[(0,s.jsx)("h3",{children:"Tasa de \xc9xito"}),(0,s.jsxs)("div",{className:"metric-value",children:[N().toFixed(1),"%"]}),(0,s.jsx)("div",{className:"metric-subtitle ".concat(N()>=80?"success":N()>=60?"warning":"error"),children:N()>=80?"Excelente":N()>=60?"Buena":"Mejorar"})]})]}),(0,s.jsxs)("div",{className:"metric-card",children:[(0,s.jsx)("div",{className:"metric-icon",children:"\uD83D\uDC65"}),(0,s.jsxs)("div",{className:"metric-content",children:[(0,s.jsx)("h3",{children:"Total Viewers"}),(0,s.jsx)("div",{className:"metric-value",children:(r()-a()).toLocaleString()}),(0,s.jsxs)("div",{className:"metric-subtitle",children:["Enviados: ",r().toLocaleString()," | Expirados: -",a().toLocaleString()]})]})]}),(0,s.jsxs)("div",{className:"metric-card clickable-card",onClick:()=>b(!0),style:{cursor:"pointer"},children:[(0,s.jsx)("div",{className:"metric-icon",children:"⏰"}),(0,s.jsxs)("div",{className:"metric-content",children:[(0,s.jsx)("h3",{children:"Viewers Expirados"}),(0,s.jsxs)("div",{className:"metric-value",style:{color:"#ef4444"},children:["-",a().toLocaleString()]}),(0,s.jsx)("div",{className:"metric-subtitle",children:"Operaciones terminadas"})]})]}),(0,s.jsxs)("div",{className:"metric-card",children:[(0,s.jsx)("div",{className:"metric-icon",children:"\uD83D\uDCB0"}),(0,s.jsxs)("div",{className:"metric-content",children:[(0,s.jsx)("h3",{children:"Costo Total"}),(0,s.jsxs)("div",{className:"metric-value",children:["$",n.totalCost.toFixed(2)]}),(0,s.jsx)("div",{className:"metric-subtitle",children:"Operaciones exitosas"})]})]}),(0,s.jsxs)("div",{className:"metric-card",children:[(0,s.jsx)("div",{className:"metric-icon",children:"\uD83D\uDD04"}),(0,s.jsxs)("div",{className:"metric-content",children:[(0,s.jsx)("h3",{children:"Operaciones de Bloques Reiniciados"}),(0,s.jsx)("div",{className:"metric-value",children:n.totalResetOperations}),(0,s.jsx)("div",{className:"metric-subtitle",children:"Operaciones enviadas"})]})]}),(0,s.jsxs)("div",{className:"metric-card",children:[(0,s.jsx)("div",{className:"metric-icon",children:"\uD83D\uDCB5"}),(0,s.jsxs)("div",{className:"metric-content",children:[(0,s.jsx)("h3",{children:"Costo por Viewer"}),(0,s.jsxs)("div",{className:"metric-value",children:["$",n.totalViewers>0?(n.totalCost/n.totalViewers).toFixed(4):"0.0000"]}),(0,s.jsx)("div",{className:"metric-subtitle",children:"Eficiencia"})]})]}),(0,s.jsxs)("div",{className:"metric-card",children:[(0,s.jsx)("div",{className:"metric-icon",children:"\uD83D\uDC65"}),(0,s.jsxs)("div",{className:"metric-content",children:[(0,s.jsx)("h3",{children:"Viewers de Bloques Reiniciados"}),(0,s.jsx)("div",{className:"metric-value",children:n.totalResetViewers.toLocaleString()}),(0,s.jsx)("div",{className:"metric-subtitle",children:"Viewers enviados"})]})]})]}),w().length>0&&(0,s.jsxs)("div",{className:"reset-history-section",children:[(0,s.jsxs)("h3",{onClick:()=>D(!j),style:{cursor:"pointer",display:"flex",alignItems:"center",gap:"0.5rem",userSelect:"none",transition:"opacity 0.2s ease"},onMouseEnter:e=>e.currentTarget.style.opacity="0.8",onMouseLeave:e=>e.currentTarget.style.opacity="1",children:[(0,s.jsx)("span",{style:{transform:j?"rotate(90deg)":"rotate(0deg)",transition:"transform 0.2s ease"},children:"▶️"}),"\uD83D\uDD04 Historial de Resets Detallado",(0,s.jsxs)("span",{style:{fontSize:"0.75rem",opacity:"0.7"},children:["(",w().length," resets)"]})]}),j&&(0,s.jsx)("div",{className:"reset-cards",children:w().slice(-10).reverse().map((e,t)=>(0,s.jsxs)("div",{className:"reset-card",children:[(0,s.jsxs)("div",{className:"reset-header",children:[(0,s.jsxs)("div",{className:"reset-title",children:[(0,s.jsx)("span",{className:"reset-icon",children:"\uD83D\uDD04"}),(0,s.jsx)("strong",{children:e.blockTitle||"Bloque ".concat(e.blockId)})]}),(0,s.jsx)("div",{className:"reset-date",children:new Date(e.resetAt).toLocaleString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})})]}),(0,s.jsxs)("div",{className:"reset-details",children:[(0,s.jsxs)("div",{className:"reset-stat",children:[(0,s.jsx)("span",{className:"stat-label",children:"\uD83D\uDCCA Operaciones enviadas:"}),(0,s.jsx)("span",{className:"stat-value",children:e.operationsLost||0})]}),(0,s.jsxs)("div",{className:"reset-stat",children:[(0,s.jsx)("span",{className:"stat-label",children:"\uD83D\uDC65 Viewers enviados:"}),(0,s.jsx)("span",{className:"stat-value",children:(e.viewersLost||0).toLocaleString()})]}),e.operationsLost>0&&e.viewersLost>0&&(0,s.jsxs)("div",{className:"reset-stat",children:[(0,s.jsx)("span",{className:"stat-label",children:"⚡ Promedio por operaci\xf3n:"}),(0,s.jsxs)("span",{className:"stat-value",children:[Math.round(e.viewersLost/e.operationsLost)," viewers"]})]})]})]},t))}),j&&w().length>10&&(0,s.jsx)("div",{className:"reset-summary",children:(0,s.jsxs)("p",{children:["Mostrando los \xfaltimos 10 resets. Total de resets: ",(0,s.jsx)("strong",{children:w().length})]})})]}),(0,s.jsxs)("div",{className:"charts-section",children:[(0,s.jsxs)("div",{className:"chart-card",children:[(0,s.jsx)("h3",{children:"\uD83D\uDCCA Operaciones por Bloque"}),(0,s.jsx)("div",{className:"simple-chart",children:Object.entries(n.operationsPerBlock).map(e=>{let[t,a]=e;return(0,s.jsxs)("div",{className:"chart-bar",children:[(0,s.jsxs)("div",{className:"bar-label",children:["B",parseInt(t.replace("block-",""))+1]}),(0,s.jsx)("div",{className:"bar-container",children:(0,s.jsx)("div",{className:"bar-fill",style:{width:"".concat(Math.max(10,a/Math.max(...Object.values(n.operationsPerBlock),1)*100),"%")}})}),(0,s.jsx)("div",{className:"bar-value",children:a})]},t)})})]}),(0,s.jsxs)("div",{className:"chart-card",children:[(0,s.jsx)("h3",{children:"⏰ Viewers por Hora"}),(0,s.jsx)("div",{className:"simple-chart",children:Object.entries(n.viewersPerHour).sort((e,t)=>{let[a]=e,[s]=t;return a.localeCompare(s)}).slice(-8).map(e=>{let[t,a]=e;return(0,s.jsxs)("div",{className:"chart-bar",children:[(0,s.jsx)("div",{className:"bar-label",children:t}),(0,s.jsx)("div",{className:"bar-container",children:(0,s.jsx)("div",{className:"bar-fill viewers-bar",style:{width:"".concat(Math.max(10,a/Math.max(...Object.values(n.viewersPerHour),1)*100),"%")}})}),(0,s.jsx)("div",{className:"bar-value",children:a})]},t)})})]}),(0,s.jsxs)("div",{className:"chart-card",children:[(0,s.jsx)("h3",{children:"⏱️ Viewers por Duraci\xf3n de Servicio"}),(0,s.jsxs)("div",{className:"service-duration-table",children:[(0,s.jsxs)("div",{className:"service-duration-header",children:[(0,s.jsx)("div",{className:"duration-cell",children:"Duraci\xf3n"}),(0,s.jsx)("div",{className:"viewers-cell",children:"Viewers"}),(0,s.jsx)("div",{className:"cost-cell",children:"Costo Total"}),(0,s.jsx)("div",{className:"percentage-cell",children:"Porcentaje"})]}),Object.entries(n.viewersByServiceDuration).sort((e,t)=>{let[a]=e,[s]=t;return parseFloat(a)-parseFloat(s)}).map(e=>{let[t,a]=e,o=n.costByServiceDuration[t]||0,i=r();return(0,s.jsxs)("div",{className:"service-duration-row",children:[(0,s.jsx)("div",{className:"duration-cell",children:(0,s.jsx)("span",{className:"duration-badge",children:t})}),(0,s.jsx)("div",{className:"viewers-cell",children:(0,s.jsx)("span",{className:"viewers-count",children:a.toLocaleString()})}),(0,s.jsx)("div",{className:"cost-cell",children:(0,s.jsxs)("span",{className:"cost-amount",children:["$",o.toFixed(2)]})}),(0,s.jsx)("div",{className:"percentage-cell",children:(0,s.jsxs)("span",{className:"percentage-value",children:[(i>0?a/i*100:0).toFixed(1),"%"]})})]},t)})]})]})]}),Object.keys(n.youtubeStreams).length>0&&(0,s.jsxs)("div",{className:"youtube-section",children:[(0,s.jsx)("h2",{children:"\uD83D\uDCFA Streams de YouTube Monitoreados"}),(0,s.jsx)("div",{className:"youtube-streams-grid",children:Object.entries(n.youtubeStreams).map(e=>{let[t,a]=e;return(0,s.jsxs)("div",{className:"youtube-stream-card",children:[(0,s.jsxs)("div",{className:"stream-header",children:[(0,s.jsxs)("h4",{children:["\uD83D\uDCDD ",a.title]}),(0,s.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[(0,s.jsx)("div",{className:"live-indicator ".concat(a.isLive?"live":"offline"),children:a.isLive?"\uD83D\uDD34 En Vivo":"⏹️ Offline"}),(0,s.jsx)("button",{className:"remove-stream-button",onClick:()=>F(t),title:"Eliminar stream del monitoreo",children:(0,s.jsxs)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,s.jsx)("path",{d:"M3 6H5H21",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),(0,s.jsx)("path",{d:"M8 6V4C8 3.46957 8.21071 2.96086 8.58579 2.58579C8.96086 2.21071 9.46957 2 10 2H14C14.5304 2 15.0391 2.21071 15.4142 2.58579C15.7893 2.96086 16 3.46957 16 4V6M19 6V20C19 20.5304 18.7893 21.0391 18.4142 21.4142C18.0391 21.7893 17.5304 22 17 22H7C6.46957 22 5.96086 21.7893 5.58579 21.4142C5.21071 21.0391 5 20.5304 5 20V6H19Z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),(0,s.jsx)("path",{d:"M10 11V17",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),(0,s.jsx)("path",{d:"M14 11V17",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]})})]})]}),(0,s.jsxs)("div",{className:"stream-metrics",children:[(0,s.jsxs)("div",{className:"metric",children:[(0,s.jsx)("span",{className:"metric-label",children:"Viewers Actuales:"}),(0,s.jsx)("span",{className:"metric-value",children:a.currentViewers.toLocaleString()})]}),(0,s.jsxs)("div",{className:"metric",children:[(0,s.jsx)("span",{className:"metric-label",children:"Tendencia:"}),(0,s.jsxs)("span",{className:"metric-value trend-".concat(a.trend),children:["up"===a.trend?"\uD83D\uDCC8":"down"===a.trend?"\uD83D\uDCC9":"➡️",a.growthPercent.toFixed(1),"%"]})]}),a.predictedFinal>0&&a.isLive&&(0,s.jsxs)("div",{className:"metric",children:[(0,s.jsx)("span",{className:"metric-label",children:"Predicci\xf3n Final:"}),(0,s.jsx)("span",{className:"metric-value",children:a.predictedFinal.toLocaleString()})]})]}),(0,s.jsx)("div",{className:"stream-footer",children:(0,s.jsxs)("small",{children:["\xdaltima actualizaci\xf3n: ",new Date(a.lastUpdated).toLocaleTimeString()]})})]},t)})})]}),(0,s.jsx)("div",{className:"recent-operations-section",children:(0,s.jsxs)("div",{className:"chart-card",style:{gridColumn:"1 / -1"},children:[(0,s.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[(0,s.jsx)("h3",{children:"\uD83D\uDCCB Todas las Operaciones (con Horarios)"}),(0,s.jsx)("button",{onClick:V,className:"export-button",style:{padding:"0.5rem 1rem",fontSize:"0.875rem",borderRadius:"0.375rem",background:"linear-gradient(135deg, #059669, #047857)",color:"white",border:"none",cursor:"pointer",fontWeight:"500",display:"flex",alignItems:"center",gap:"0.5rem"},title:"Descargar tabla de operaciones como CSV",children:"\uD83D\uDCE5 Descargar CSV"})]}),(0,s.jsx)("div",{className:"operations-table-container",style:{overflowX:"auto",overflowY:"auto",maxHeight:"400px"},children:(0,s.jsxs)("table",{className:"operations-table",style:{width:"100%",fontSize:"0.85rem"},children:[(0,s.jsx)("thead",{style:{position:"sticky",top:0,backgroundColor:"dark"===e?"#1f2937":"#f9fafb"},children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{children:"Bloque"}),(0,s.jsx)("th",{children:"Estado"}),(0,s.jsx)("th",{children:"Inicio"}),(0,s.jsx)("th",{children:"Finalizaci\xf3n Est."}),(0,s.jsx)("th",{children:"Duraci\xf3n"}),(0,s.jsx)("th",{children:"Viewers"}),(0,s.jsx)("th",{children:"Costo"})]})}),(0,s.jsx)("tbody",{children:f().map((t,a)=>{0===a&&(console.log("\uD83D\uDCCB Total operaciones encontradas:",f().length),console.log("\uD83D\uDCDD Muestra de operaci\xf3n:",t));let r="N/A",n=t.timestamp;if(t.duration&&(t.savedAt||t.startTime))try{let e=t.savedAt||t.startTime,a=new Date(e);if(!isNaN(a.getTime())){let e=new Date(a.getTime()+6e4*t.duration);if(!isNaN(e.getTime())){let t=e.getHours().toString().padStart(2,"0"),a=e.getMinutes().toString().padStart(2,"0"),s=e.getSeconds().toString().padStart(2,"0");r="".concat(t,":").concat(a,":").concat(s)}}}catch(e){console.warn("Error calculando tiempo de finalizaci\xf3n:",e,"Operaci\xf3n:",t)}return(0,s.jsxs)("tr",{style:{backgroundColor:t.isHistorical?"dark"===e?"#451a03":"#fef3c7":"transparent"},children:[(0,s.jsxs)("td",{children:["Bloque ",parseInt((t.blockId||"block-0").replace("block-",""))+1]}),(0,s.jsx)("td",{children:(0,s.jsxs)("span",{style:{color:"success"===t.status?"#10b981":"#ef4444",fontWeight:"bold"},children:["success"===t.status?"✅":"❌"," ",t.status]})}),(0,s.jsx)("td",{children:n||"N/A"}),(0,s.jsx)("td",{children:r}),(0,s.jsxs)("td",{children:[t.duration||0," min"]}),(0,s.jsx)("td",{children:(t.count||0).toLocaleString()}),(0,s.jsxs)("td",{children:["$",(t.cost||0).toFixed(2)]})]},"".concat(t.blockId,"-").concat(t.timestamp,"-").concat(a))})})]})})]})}),(0,s.jsx)("div",{className:"recent-operations-section",children:(0,s.jsxs)("div",{className:"chart-card",style:{gridColumn:"1 / -1"},children:[(0,s.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[(0,s.jsx)("h3",{children:"\uD83D\uDCFA Historial de Monitoreo de YouTube"}),(0,s.jsx)("button",{onClick:B,className:"export-button",style:{padding:"0.5rem 1rem",fontSize:"0.875rem",borderRadius:"0.375rem",background:"linear-gradient(135deg, #16a34a, #15803d)",color:"white",border:"none",cursor:"pointer",fontWeight:"500",display:"flex",alignItems:"center",gap:"0.5rem"},title:"Descargar historial de YouTube como Excel",children:"� Descargar Excel"})]}),(0,s.jsx)("div",{className:"operations-table-container",style:{overflowX:"auto",overflowY:"auto",maxHeight:"400px"},children:(()=>{let t=R();return t.length>0?(0,s.jsxs)("table",{className:"operations-table",style:{width:"100%",fontSize:"0.85rem"},children:[(0,s.jsx)("thead",{style:{position:"sticky",top:0,backgroundColor:"dark"===e?"#1f2937":"#f9fafb"},children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{children:"Hora"}),(0,s.jsx)("th",{children:"T\xedtulo"}),(0,s.jsx)("th",{children:"Viewers"}),(0,s.jsx)("th",{children:"Estado"}),(0,s.jsx)("th",{children:"Tendencia"}),(0,s.jsx)("th",{children:"Cambio"})]})}),(0,s.jsx)("tbody",{children:t.slice(0,50).map((e,t)=>(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{children:new Date(e.timestamp||e.lastUpdate||0).toLocaleTimeString()}),(0,s.jsx)("td",{style:{maxWidth:"200px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.title||"Stream de YouTube"}),(0,s.jsx)("td",{children:(e.viewers||e.currentViewers||0).toLocaleString()}),(0,s.jsx)("td",{children:(0,s.jsx)("span",{style:{color:e.isLive?"#10b981":"#ef4444",fontWeight:"bold"},children:e.isLive?"\uD83D\uDD34 En Vivo":"⏹️ Offline"})}),(0,s.jsx)("td",{children:(0,s.jsx)("span",{style:{color:"up"===e.trend?"#10b981":"down"===e.trend?"#ef4444":"#6b7280"},children:"up"===e.trend?"\uD83D\uDCC8 Subiendo":"down"===e.trend?"\uD83D\uDCC9 Bajando":"➡️ Estable"})}),(0,s.jsx)("td",{children:(0,s.jsx)("span",{style:{color:(e.change||0)>0?"#10b981":0>(e.change||0)?"#ef4444":"#6b7280"},children:(()=>{let t=e.change||0;return 0===t?"0":t>0?"+".concat(t.toLocaleString()):t.toLocaleString()})()})})]},"youtube-".concat(t,"-").concat(e.timestamp)))})]}):(0,s.jsxs)("div",{style:{padding:"2rem",textAlign:"center",color:"dark"===e?"#9ca3af":"#6b7280"},children:[(0,s.jsx)("p",{children:"\uD83D\uDCFA No hay historial de monitoreo de YouTube disponible"}),(0,s.jsx)("p",{style:{fontSize:"0.875rem",marginTop:"0.5rem"},children:"Los datos aparecer\xe1n aqu\xed cuando empieces a monitorear streams de YouTube"})]})})()})]})}),x&&(0,s.jsx)("div",{className:"modal-overlay",onClick:()=>b(!1),children:(0,s.jsxs)("div",{className:"modal-content-large",onClick:e=>e.stopPropagation(),children:[(0,s.jsxs)("div",{className:"modal-header",children:[(0,s.jsx)("h3",{children:"⏰ Operaciones Expiradas Detalladas"}),(0,s.jsxs)("div",{className:"modal-header-actions",children:[(0,s.jsx)("button",{onClick:M,className:"export-button",style:{marginRight:"1rem"},title:"Descargar operaciones expiradas como CSV",children:"\uD83D\uDCE5 Descargar CSV"}),(0,s.jsx)("button",{onClick:()=>b(!1),className:"close-button",children:"✕"})]})]}),(0,s.jsx)("div",{className:"modal-body",style:{maxHeight:"70vh",overflowY:"auto"},children:(()=>{let t=C();return t.length>0?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"expired-summary",style:{marginBottom:"1rem",padding:"1rem",backgroundColor:"dark"===e?"#1f2937":"#f9fafb",borderRadius:"0.5rem"},children:[(0,s.jsx)("h4",{children:"\uD83D\uDCCA Resumen"}),(0,s.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(150px, 1fr))",gap:"1rem",marginTop:"0.5rem"},children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("strong",{children:"Total Operaciones:"})," ",t.length]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("strong",{children:"Total Viewers:"})," ",t.reduce((e,t)=>e+(t.count||0),0).toLocaleString()]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("strong",{children:"Costo Total:"})," $",t.reduce((e,t)=>e+(t.cost||0),0).toFixed(2)]})]})]}),(0,s.jsxs)("table",{className:"expired-operations-table",style:{width:"100%",borderCollapse:"collapse",fontSize:"0.875rem"},children:[(0,s.jsx)("thead",{style:{position:"sticky",top:0,backgroundColor:"dark"===e?"#374151":"#f3f4f6",zIndex:1},children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{style:{padding:"0.75rem",border:"1px solid #d1d5db",textAlign:"left"},children:"Fecha"}),(0,s.jsx)("th",{style:{padding:"0.75rem",border:"1px solid #d1d5db",textAlign:"left"},children:"Bloque"}),(0,s.jsx)("th",{style:{padding:"0.75rem",border:"1px solid #d1d5db",textAlign:"left"},children:"Inicio"}),(0,s.jsx)("th",{style:{padding:"0.75rem",border:"1px solid #d1d5db",textAlign:"left"},children:"Finalizaci\xf3n"}),(0,s.jsx)("th",{style:{padding:"0.75rem",border:"1px solid #d1d5db",textAlign:"left"},children:"Duraci\xf3n"}),(0,s.jsx)("th",{style:{padding:"0.75rem",border:"1px solid #d1d5db",textAlign:"left"},children:"Viewers"}),(0,s.jsx)("th",{style:{padding:"0.75rem",border:"1px solid #d1d5db",textAlign:"left"},children:"Costo"}),(0,s.jsx)("th",{style:{padding:"0.75rem",border:"1px solid #d1d5db",textAlign:"left"},children:"Expir\xf3 hace"})]})}),(0,s.jsx)("tbody",{children:t.map((t,a)=>(0,s.jsxs)("tr",{style:{backgroundColor:a%2==0?"dark"===e?"#1f2937":"#ffffff":"dark"===e?"#111827":"#f9fafb"},children:[(0,s.jsx)("td",{style:{padding:"0.75rem",border:"1px solid #d1d5db"},children:t.dateFormatted}),(0,s.jsxs)("td",{style:{padding:"0.75rem",border:"1px solid #d1d5db"},children:["Bloque ",parseInt((t.blockId||"block-0").replace("block-",""))+1]}),(0,s.jsx)("td",{style:{padding:"0.75rem",border:"1px solid #d1d5db"},children:t.startTimeFormatted}),(0,s.jsx)("td",{style:{padding:"0.75rem",border:"1px solid #d1d5db"},children:t.endTimeFormatted}),(0,s.jsxs)("td",{style:{padding:"0.75rem",border:"1px solid #d1d5db"},children:[t.duration," min"]}),(0,s.jsx)("td",{style:{padding:"0.75rem",border:"1px solid #d1d5db",fontWeight:"bold"},children:(t.count||0).toLocaleString()}),(0,s.jsxs)("td",{style:{padding:"0.75rem",border:"1px solid #d1d5db"},children:["$",(t.cost||0).toFixed(2)]}),(0,s.jsxs)("td",{style:{padding:"0.75rem",border:"1px solid #d1d5db",color:"#ef4444",fontWeight:"bold"},children:[t.minutesExpired," min"]})]},"expired-".concat(a)))})]})]}):(0,s.jsxs)("div",{style:{textAlign:"center",padding:"3rem",color:"dark"===e?"#9ca3af":"#6b7280"},children:[(0,s.jsx)("h4",{children:"\uD83C\uDF89 \xa1No hay operaciones expiradas!"}),(0,s.jsx)("p",{children:"Todas las operaciones est\xe1n activas o a\xfan no han completado su duraci\xf3n."})]})})()})]})})]})};a(4965);var j=()=>{let{theme:e}=(0,i.F)(),[t,a]=(0,o.useState)(""),[r,n]=(0,o.useState)(!1),[l,c]=(0,o.useState)(null),[d,u]=(0,o.useState)([]),[m,h]=(0,o.useState)(60),[p,x]=(0,o.useState)(!1),[g,b]=(0,o.useState)(null),[j,D]=(0,o.useState)("video"),f=e=>{try{let t=e.match(/(?:youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/embed\/)([^&\n?#]+)/);return t?t[1]:null}catch(e){return null}},w=(0,o.useCallback)(async e=>{if(e){x(!0),b(null);try{let t=await fetch("/api/youtube-scraper",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:e,mode:j})}),a=await t.json();if("error"===a.status)b(a.message||"Error desconocido"),v("❌ Error: ".concat(a.message),"error");else{c(a);let t={timestamp:a.timestamp,viewers:a.viewers,isLive:a.isLive,title:a.title,url:a.redirectedUrl||a.url};u(s=>{let r=[...s,t].slice(-50),n="stable",o=0,i=0;if(r.length>=2){let e=r.slice(-5),t=e[0],s=e[e.length-1].viewers-t.viewers;if(o=t.viewers>0?s/t.viewers*100:0,n=s>0?"up":s<0?"down":"stable",r.length>=3&&a.isLive){let e=r.slice(-10),t=0;for(let a=1;a<e.length;a++)t+=e[a].viewers-e[a-1].viewers;let s=t/(e.length-1),n=7200/m;i=Math.max(0,Math.round(a.viewers+s*n))}}try{let t=f(e);if(t){let r={url:e,title:a.title,viewers:a.viewers,isLive:a.isLive,timestamp:a.timestamp,lastUpdated:new Date().toISOString(),trend:n,growthPercent:o,predictedFinal:i};localStorage.setItem("youtubeMonitor_".concat(t),JSON.stringify(r));let l="youtubeHistory_".concat(t),c=[];try{let e=localStorage.getItem(l);e&&(c=JSON.parse(e),Array.isArray(c)||(c=[]))}catch(e){console.warn("Error loading YouTube history:",e),c=[]}let d={...r,change:s.length>0?a.viewers-s[s.length-1].viewers:0,estado:a.isLive?"En Vivo":"Offline",source:"YouTubeMonitor_".concat(t)};c.push(d),c.length>500&&(c=c.slice(-500)),localStorage.setItem(l,JSON.stringify(c)),console.log("\uD83D\uDCCA Guardada medici\xf3n en historial. Total: ".concat(c.length," registros"))}}catch(e){console.warn("Error updating enhanced YouTube data:",e)}if(s.length>0){let e=s[s.length-1],t=a.viewers-e.viewers,r=e.viewers>0?t/e.viewers*100:0;if(Math.abs(t)>100||Math.abs(r)>10){let e=t>0?"\uD83D\uDCC8 +".concat(t.toLocaleString()," viewers (+").concat(r.toFixed(1),"%)"):"\uD83D\uDCC9 ".concat(t.toLocaleString()," viewers (").concat(r.toFixed(1),"%)");v(e,t>0?"success":"warning")}}return r}),console.log("\uD83D\uDCCA YouTube data actualizada:",a)}}catch(t){let e=t instanceof Error?t.message:"Error de conexi\xf3n";b(e),v("❌ Error: ".concat(e),"error"),console.error("Error en scraping:",t)}finally{x(!1)}}},[m,j]);(0,o.useEffect)(()=>{let e;return r&&t&&(w(t),e=setInterval(()=>{w(t)},1e3*m)),()=>{e&&clearInterval(e)}},[r,t,m,w]);let N=(()=>{if(d.length<2)return null;let e=d.slice(-5),t=e[0],a=e[e.length-1].viewers-t.viewers,s=t.viewers>0?a/t.viewers*100:0;return{growth:a,growthPercent:s,trend:a>0?"up":a<0?"down":"stable"}})(),y=(()=>{if(d.length<3)return null;let e=d.slice(-10),t=0;for(let a=1;a<e.length;a++)t+=e[a].viewers-e[a-1].viewers;let a=t/(e.length-1),s=3600*((null==l?void 0:l.isLive)?2:0)/m;return Math.max(0,Math.round(l?l.viewers+a*s:0))})();return(0,s.jsxs)("div",{className:"youtube-monitor ".concat(e),children:[(0,s.jsx)("div",{className:"monitor-header",children:(0,s.jsx)("h3",{children:"\uD83D\uDCFA Monitor de YouTube en Tiempo Real"})}),(0,s.jsxs)("div",{className:"monitor-config",children:[(0,s.jsx)("div",{className:"url-input",children:(0,s.jsx)("input",{type:"url",placeholder:"channel"===j?"https://www.youtube.com/@canalname":"https://www.youtube.com/watch?v=...",value:t,onChange:e=>a(e.target.value),disabled:r})}),(0,s.jsxs)("div",{className:"config-controls",children:[(0,s.jsxs)("div",{className:"mode-selector",children:[(0,s.jsx)("label",{children:"Modo:"}),(0,s.jsxs)("select",{value:j,onChange:e=>D(e.target.value),disabled:r,children:[(0,s.jsx)("option",{value:"video",children:"Video con Auto-Redirect"}),(0,s.jsx)("option",{value:"channel",children:"Canal (Auto-Detecci\xf3n)"})]})]}),(0,s.jsxs)("div",{className:"interval-selector",children:[(0,s.jsx)("label",{children:"Intervalo:"}),(0,s.jsxs)("select",{value:m,onChange:e=>h(Number(e.target.value)),disabled:r,children:[(0,s.jsx)("option",{value:30,children:"30 segundos"}),(0,s.jsx)("option",{value:60,children:"1 minuto"}),(0,s.jsx)("option",{value:120,children:"2 minutos"}),(0,s.jsx)("option",{value:300,children:"5 minutos"})]})]}),(0,s.jsx)("div",{className:"monitor-buttons",children:r?(0,s.jsx)("button",{onClick:()=>{n(!1),v("⏹️ Monitoreo detenido","info")},className:"stop-button",children:"⏹️ Detener Monitor"}):(0,s.jsx)("button",{onClick:()=>{if(!t.trim()){v("❌ Por favor ingresa una URL de YouTube","error");return}n(!0),u([]),b(null),v("\uD83D\uDD34 Monitoreo iniciado","success")},className:"start-button",children:"\uD83D\uDD34 Iniciar Monitor"})})]})]}),(0,s.jsx)("div",{className:"mode-info",children:"video"===j?(0,s.jsxs)("p",{children:["\uD83D\uDCFA ",(0,s.jsx)("strong",{children:"Modo Video:"})," Monitorea un video espec\xedfico. Si termina, busca autom\xe1ticamente nuevos streams del mismo canal."]}):(0,s.jsxs)("p",{children:["\uD83D\uDD0D ",(0,s.jsx)("strong",{children:"Modo Canal:"})," Busca autom\xe1ticamente streams en vivo del canal especificado."]})}),r&&(0,s.jsxs)("div",{className:"monitor-status",children:[(0,s.jsxs)("div",{className:"status-indicator",children:[(0,s.jsx)("div",{className:"status-dot ".concat(p?"loading":"active")}),(0,s.jsx)("span",{children:p?"Actualizando...":"Monitoreando cada ".concat(m,"s")})]}),g&&(0,s.jsxs)("div",{className:"error-message",children:["❌ ",g]})]}),l&&(0,s.jsxs)("div",{className:"current-data",children:[(0,s.jsxs)("div",{className:"data-grid",children:[(0,s.jsxs)("div",{className:"data-card viewers",children:[(0,s.jsx)("div",{className:"data-icon",children:"\uD83D\uDC65"}),(0,s.jsxs)("div",{className:"data-content",children:[(0,s.jsx)("h4",{children:"Viewers Actuales"}),(0,s.jsx)("div",{className:"data-value",children:l.viewers.toLocaleString()}),(0,s.jsx)("div",{className:"data-subtitle",children:l.isLive?"\uD83D\uDD34 En Vivo":"⏹️ Grabado"})]})]}),N&&(0,s.jsxs)("div",{className:"data-card trend",children:[(0,s.jsx)("div",{className:"data-icon",children:"up"===N.trend?"\uD83D\uDCC8":"down"===N.trend?"\uD83D\uDCC9":"➡️"}),(0,s.jsxs)("div",{className:"data-content",children:[(0,s.jsx)("h4",{children:"Tendencia (5 min)"}),(0,s.jsxs)("div",{className:"data-value",children:[N.growth>0?"+":"",N.growth.toLocaleString()]}),(0,s.jsxs)("div",{className:"data-subtitle",children:[N.growthPercent>0?"+":"",N.growthPercent.toFixed(1),"%"]})]})]}),y&&l.isLive&&(0,s.jsxs)("div",{className:"data-card prediction",children:[(0,s.jsx)("div",{className:"data-icon",children:"\uD83D\uDD2E"}),(0,s.jsxs)("div",{className:"data-content",children:[(0,s.jsx)("h4",{children:"Predicci\xf3n Final"}),(0,s.jsx)("div",{className:"data-value",children:y.toLocaleString()}),(0,s.jsx)("div",{className:"data-subtitle",children:"En 2 horas"})]})]})]}),l.title&&(0,s.jsxs)("div",{className:"video-title",children:[(0,s.jsx)("strong",{children:"\uD83D\uDCDD T\xedtulo:"})," ",l.title]})]}),d.length>0&&(0,s.jsxs)("div",{className:"history-section",children:[(0,s.jsx)("h4",{children:"\uD83D\uDCCA Historial Reciente"}),(0,s.jsxs)("div",{className:"history-content",children:[(0,s.jsx)("div",{className:"history-chart-container",children:(0,s.jsx)("svg",{className:"line-chart",viewBox:"0 0 800 180",preserveAspectRatio:"xMidYMid meet",children:(()=>{let e=d.slice(-20);if(0===e.length)return null;let t=Math.max(...e.map(e=>e.viewers)),a=Math.min(...e.map(e=>e.viewers)),r=t-a||1,n=e.map((t,s)=>({x:40+720*s/Math.max(e.length-1,1),y:140-(t.viewers-a)/r*100,entry:t,index:s})),o="";if(n.length>0){o="M ".concat(n[0].x," ").concat(n[0].y);for(let e=1;e<n.length;e++){let t=n[e-1],a=n[e];if(n.length>2){let e=(t.x+a.x)/2;o+=" Q ".concat(e," ").concat(t.y," ").concat(a.x," ").concat(a.y)}else o+=" L ".concat(a.x," ").concat(a.y)}}let i=n.length>0?"M ".concat(40," ").concat(140," L ").concat(n.map(e=>"".concat(e.x," ").concat(e.y)).join(" L ")," L ").concat(n[n.length-1].x," ").concat(140," Z"):"";return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("defs",{children:[(0,s.jsx)("pattern",{id:"grid",width:"50",height:"20",patternUnits:"userSpaceOnUse",children:(0,s.jsx)("path",{d:"M 50 0 L 0 0 0 20",fill:"none",stroke:"currentColor",strokeWidth:"0.5",opacity:"0.1"})}),(0,s.jsxs)("linearGradient",{id:"lineGradient",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[(0,s.jsx)("stop",{offset:"0%",stopColor:"currentColor",stopOpacity:"0.8"}),(0,s.jsx)("stop",{offset:"50%",stopColor:"currentColor",stopOpacity:"1"}),(0,s.jsx)("stop",{offset:"100%",stopColor:"currentColor",stopOpacity:"0.8"})]}),(0,s.jsxs)("linearGradient",{id:"areaGradient",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[(0,s.jsx)("stop",{offset:"0%",stopColor:"currentColor",stopOpacity:"0.2"}),(0,s.jsx)("stop",{offset:"100%",stopColor:"currentColor",stopOpacity:"0.05"})]})]}),(0,s.jsx)("rect",{width:"100%",height:"100%",fill:"url(#grid)"}),[.25,.5,.75].map((e,t)=>(0,s.jsx)("line",{x1:40,y1:40+100*e,x2:760,y2:40+100*e,stroke:"currentColor",strokeWidth:"1",opacity:"0.1",strokeDasharray:"5,5"},t)),i&&(0,s.jsx)("path",{d:i,fill:"url(#areaGradient)",className:"line-area"}),o&&(0,s.jsx)("path",{d:o,fill:"none",stroke:"url(#lineGradient)",strokeWidth:"3",strokeLinejoin:"round",strokeLinecap:"round",className:"line-path"}),n.map((e,t)=>{let a=0===t,r=t===n.length-1,o=t>0?e.entry.viewers-n[t-1].entry.viewers:0;return(0,s.jsxs)("g",{children:[(0,s.jsx)("circle",{cx:e.x,cy:e.y,r:a||r?"4":"2.5",fill:"currentColor",stroke:a||r?"rgba(255,255,255,0.8)":"none",strokeWidth:a||r?"2":"0",className:"line-point",opacity:a||r?"1":"0.8"}),(0,s.jsxs)("title",{children:[new Date(e.entry.timestamp).toLocaleTimeString(),": ",e.entry.viewers.toLocaleString()," viewers",0!==o&&" (".concat(o>0?"+":"").concat(o.toLocaleString(),")"),e.entry.isLive?" • \uD83D\uDD34 En Vivo":" • ⏹️ Grabado"]})]},t)}),(0,s.jsx)("text",{x:"10",y:35,fontSize:"10",fill:"currentColor",opacity:"0.7",textAnchor:"start",children:t.toLocaleString()}),(0,s.jsx)("text",{x:"10",y:152,fontSize:"10",fill:"currentColor",opacity:"0.7",textAnchor:"start",children:a.toLocaleString()}),e.length>0&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("text",{x:40,y:165,fontSize:"9",fill:"currentColor",opacity:"0.7",textAnchor:"start",children:new Date(e[0].timestamp).toLocaleTimeString()}),(0,s.jsx)("text",{x:760,y:165,fontSize:"9",fill:"currentColor",opacity:"0.7",textAnchor:"end",children:new Date(e[e.length-1].timestamp).toLocaleTimeString()})]}),N&&(0,s.jsxs)("text",{x:750,y:55,fontSize:"11",fill:"currentColor",opacity:"0.8",textAnchor:"end",children:["up"===N.trend?"\uD83D\uDCC8":"down"===N.trend?"\uD83D\uDCC9":"➡️"," ",N.growthPercent.toFixed(1),"%"]})]})})()})}),(0,s.jsx)("div",{className:"history-table-container",children:(0,s.jsx)("div",{className:"history-table",children:(0,s.jsxs)("table",{children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{children:"Hora"}),(0,s.jsx)("th",{children:"Viewers"}),(0,s.jsx)("th",{children:"Estado"}),(0,s.jsx)("th",{children:"Cambio"})]})}),(0,s.jsx)("tbody",{children:d.slice(-8).reverse().map((e,t)=>{let a=d[d.length-2-t],r=a?e.viewers-a.viewers:0;return(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{children:new Date(e.timestamp).toLocaleTimeString().slice(0,5)}),(0,s.jsx)("td",{children:e.viewers.toLocaleString()}),(0,s.jsx)("td",{children:(0,s.jsx)("span",{className:"status ".concat(e.isLive?"live":"offline"),children:e.isLive?"\uD83D\uDD34":"⏹️"})}),(0,s.jsxs)("td",{className:"change ".concat(r>0?"positive":r<0?"negative":""),children:[0!==r&&(r>0?"+":""),r.toLocaleString()]})]},e.timestamp)})})]})})})]})]})]})};a(1934);var D=e=>{let{isOpen:t,onDownloadFirst:a,onProceedAnyway:r,onCancel:n,hasData:o}=e,{theme:l}=(0,i.F)();return t?(0,s.jsx)("div",{className:"reset-warning-overlay",children:(0,s.jsxs)("div",{className:"reset-warning-modal ".concat(l),children:[(0,s.jsxs)("div",{className:"reset-warning-header",children:[(0,s.jsx)("h2",{children:"\uD83D\uDEA8 Reset Completo de Dashboard"}),(0,s.jsx)("button",{className:"close-button",onClick:n,title:"Cerrar",children:"✕"})]}),(0,s.jsxs)("div",{className:"reset-warning-content",children:[(0,s.jsxs)("div",{className:"warning-section",children:[(0,s.jsx)("div",{className:"warning-icon",children:"⚠️"}),(0,s.jsxs)("div",{className:"warning-text",children:[(0,s.jsx)("h3",{children:"Esta acci\xf3n eliminar\xe1 TODOS los datos permanentemente"}),(0,s.jsx)("p",{children:"Se perder\xe1n todos los estados de bloques, historiales de operaciones, m\xe9tricas y reportes."})]})]}),o&&(0,s.jsxs)("div",{className:"recommendation-section",children:[(0,s.jsx)("h4",{children:"\uD83D\uDCCB Se recomienda descargar los reportes primero:"}),(0,s.jsxs)("ul",{children:[(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"JSON:"})," Datos completos para respaldo y restauraci\xf3n"]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"CSV:"})," Operaciones para an\xe1lisis en Excel"]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"HTML:"})," Reporte ejecutivo visual"]})]})]}),(0,s.jsxs)("div",{className:"action-section",children:[(0,s.jsx)("h4",{children:"\xbfQu\xe9 deseas hacer?"}),(0,s.jsxs)("div",{className:"action-buttons",children:[(0,s.jsx)("button",{className:"download-button",onClick:a,title:"Ir al dashboard para descargar reportes",children:"\uD83D\uDCCA Descargar Reportes Primero"}),(0,s.jsx)("button",{className:"proceed-button warning",onClick:r,title:"Proceder sin descargar (se perder\xe1n los datos)",children:"\uD83D\uDDD1️ Proceder Sin Descargar"}),(0,s.jsx)("button",{className:"cancel-button",onClick:n,title:"Cancelar operaci\xf3n",children:"❌ Cancelar"})]})]}),(0,s.jsx)("div",{className:"final-warning",children:(0,s.jsx)("small",{children:"⚠️ Esta acci\xf3n NO se puede deshacer"})})]})]})}):null};a(5072);var f=()=>{let{link:e,setLink:t,totalViewers:a,updateBlockViewers:r,getExpiredViewersCount:n,getTotalViewersSent:l}=h(),{theme:c}=(0,i.F)(),[d,u]=(0,o.useState)(!1),[m,p]=(0,o.useState)(!1),[g,v]=(0,o.useState)(!1),[f,w]=(0,o.useState)(!1),[N,y]=(0,o.useState)(null),[C,S]=(0,o.useState)(null),[k,T]=(0,o.useState)(null),[O,E]=(0,o.useState)(null);(0,o.useEffect)(()=>{(()=>{let e=[];for(let t=0;t<localStorage.length;t++){let a=localStorage.key(t);if(a&&a.startsWith("blockState_"))try{let t=JSON.parse(localStorage.getItem(a)||"");if(t.lastSaved){let s=new Date(t.lastSaved);(new Date().getTime()-s.getTime())/864e5>7&&e.push(a)}}catch(t){e.push(a)}}e.forEach(e=>localStorage.removeItem(e))})()},[]);let I=(e,t)=>{y({blockId:e,type:t})},L=(e,t)=>{S({blockId:e,blockData:t}),T({...t,intervalMinutes:t.intervalMinutes||2})},A=[{title:"Bloque 1",totalOperations:5,serviceId:336,count:50,decrement:10,operationType:"subtract",autoStart:!1,startTime:"",intervalMinutes:2},{title:"Bloque 2",totalOperations:4,serviceId:337,count:60,decrement:15,operationType:"subtract",autoStart:!1,startTime:"",intervalMinutes:2},{title:"Bloque 3",totalOperations:6,serviceId:334,count:40,decrement:5,operationType:"add",autoStart:!1,startTime:"",intervalMinutes:2},{title:"Bloque 4",totalOperations:3,serviceId:335,count:70,decrement:20,operationType:"subtract",autoStart:!1,startTime:"",intervalMinutes:2},{title:"Bloque 5",totalOperations:4,serviceId:338,count:80,decrement:10,operationType:"add",autoStart:!1,startTime:"",intervalMinutes:2},{title:"Bloque 6",totalOperations:5,serviceId:459,count:90,decrement:25,operationType:"subtract",autoStart:!1,startTime:"",intervalMinutes:2},{title:"Bloque 7",totalOperations:3,serviceId:460,count:100,decrement:30,operationType:"add",autoStart:!1,startTime:"",intervalMinutes:2},{title:"Bloque 8",totalOperations:6,serviceId:657,count:120,decrement:40,operationType:"subtract",autoStart:!1,startTime:"",intervalMinutes:2},{title:"Bloque 9",totalOperations:4,serviceId:335,count:110,decrement:20,operationType:"add",autoStart:!1,startTime:"",intervalMinutes:2},{title:"Bloque 10",totalOperations:5,serviceId:336,count:130,decrement:35,operationType:"subtract",autoStart:!1,startTime:"",intervalMinutes:2}],F=e=>{t(e)},R=()=>{try{for(let e=0;e<10;e++){let t="block-".concat(e),a=window["resetBlock_".concat(t)];a?a():localStorage.removeItem("blockState_".concat(t))}localStorage.removeItem("globalOperationsHistory"),localStorage.removeItem("blockResetHistory");let e=[];for(let t=0;t<localStorage.length;t++){let a=localStorage.key(t);a&&(a.startsWith("blockState_")||a.includes("metrics")||a.includes("dashboard")||a.includes("reset")||a.includes("Reset")||a.includes("history")||a.includes("History")||a.startsWith("youtubeMonitor_")||a.includes("youtube")||a.includes("stream")||a.startsWith("lastKnown")||a.includes("Alert")||a.includes("Successful")||a.includes("Operations")||a.includes("Viewers")||a.includes("Cost"))&&e.push(a)}e.forEach(e=>localStorage.removeItem(e)),p(!1),alert("✅ Reset completo realizado con \xe9xito.\n\nTodos los datos han sido eliminados permanentemente:\n• Estados de bloques\n• Historial de operaciones\n• Datos de monitoreo de YouTube\n• M\xe9tricas del dashboard\n\nLos bloques est\xe1n listos para usar desde cero.")}catch(e){console.error("Error durante el reset completo:",e),alert("❌ Error durante el reset completo. Algunos datos pueden no haberse eliminado correctamente.")}};return(0,s.jsxs)("div",{className:"viewers-container ".concat(c),children:[(0,s.jsxs)("div",{className:"input-total-container",children:[(0,s.jsx)("input",{type:"text",value:e,onChange:e=>F(e.target.value),placeholder:"Ingrese el enlace de YouTube",className:"input-link ".concat(c)}),(0,s.jsxs)("div",{className:"total-viewers-header",title:"Total de viewers enviados (activos + expirados + reiniciados) menos viewers expirados",children:[(0,s.jsxs)("div",{style:{fontSize:"1rem",fontWeight:"600"},children:["\uD83D\uDCAB Total cargado: ",(l()-n()).toLocaleString()]}),(0,s.jsxs)("div",{style:{fontSize:"0.75rem",opacity:"0.8",marginTop:"0.25rem"},children:["\uD83D\uDCCA Expirados: -",n().toLocaleString()]})]})]}),(0,s.jsxs)("div",{className:"dashboard-buttons-container",children:[(0,s.jsxs)("button",{onClick:()=>p(!m),className:"dashboard-button metrics-button",title:"Ver dashboard de m\xe9tricas",children:["\uD83D\uDCCA ",m?"Ocultar M\xe9tricas":"Ver M\xe9tricas"]}),(0,s.jsxs)("button",{onClick:()=>v(!g),className:"dashboard-button youtube-monitor-button",title:"Monitor de YouTube en tiempo real",children:["\uD83D\uDCFA ",g?"Ocultar YouTube":"Monitor YouTube"]}),(0,s.jsx)("button",{onClick:()=>{let e=A.some((e,t)=>{var a;let s=localStorage.getItem("blockState_block-".concat(t));return s&&(null===(a=JSON.parse(s).operations)||void 0===a?void 0:a.length)>0}),t=localStorage.getItem("globalOperationsHistory")||localStorage.getItem("blockResetHistory"),a=Array.from({length:localStorage.length},(e,t)=>localStorage.key(t)).some(e=>e&&(e.startsWith("youtubeMonitor_")||e.includes("youtube")||e.includes("stream")));if(!(e||t||a)){alert("No hay datos para resetear.");return}w(!0)},className:"dashboard-button reset-all-button",title:"Resetear todos los bloques",children:"\uD83D\uDDD1️ Reset All"})]}),m&&(0,s.jsx)("div",{className:"main-components-container",children:(0,s.jsx)(b,{})}),g&&(0,s.jsx)("div",{className:"main-components-container",children:(0,s.jsx)(j,{})}),(0,s.jsx)("div",{className:"blocks-container",children:A.map((t,a)=>(0,s.jsx)("div",{"data-block-id":"block-".concat(a),className:"block-wrapper ".concat(O==="block-".concat(a)?"recently-edited":""),children:(0,s.jsx)(x,{blockId:"block-".concat(a),initialData:t,link:e,onTotalViewersChange:r,onShowWarning:I,onShowEditModal:L,isRecentlyEdited:O==="block-".concat(a)})},"block-".concat(a)))}),d&&(0,s.jsx)("div",{className:"modal",children:(0,s.jsxs)("div",{className:"modal-content ".concat(c),children:[(0,s.jsx)("h2",{children:"\uD83D\uDCC1 Subir Archivo Excel"}),(0,s.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:(0,s.jsx)("div",{style:{padding:"1rem",borderRadius:"0.5rem",border:"2px dashed rgba(156, 163, 175, 0.5)"},children:(0,s.jsx)("input",{type:"file",accept:".xlsx,.xls",onChange:e=>{var t;let a=null===(t=e.target.files)||void 0===t?void 0:t[0];a&&(console.log("Archivo seleccionado:",a.name),u(!1))},style:{width:"100%",fontSize:"0.875rem"}})})}),(0,s.jsx)("div",{style:{display:"flex",gap:"0.75rem",marginTop:"1.5rem"},children:(0,s.jsx)("button",{onClick:()=>u(!1),className:"cancel-button",children:"❌ Cancelar"})})]})}),N&&(0,s.jsx)("div",{className:"warning-modal",children:(0,s.jsx)("div",{className:"warning-content ".concat(c),children:(0,s.jsxs)("div",{style:{textAlign:"center"},children:[(0,s.jsx)("div",{style:{fontSize:"4rem",marginBottom:"1rem"},children:"⚠️"}),(0,s.jsx)("h3",{style:{fontSize:"1.25rem",fontWeight:"bold",marginBottom:"1rem"},children:"finalizar"===N.type?"\uD83C\uDFC1 Finalizar Bloque":"\uD83D\uDD04 Reiniciar Bloque"}),(0,s.jsxs)("p",{style:{marginBottom:"1.5rem"},children:["Est\xe1s por ","finalizar"===N.type?"finalizar":"reiniciar"," este bloque de operaciones.",(0,s.jsx)("br",{}),(0,s.jsx)("strong",{children:"Esta acci\xf3n no se puede deshacer."})]}),(0,s.jsxs)("div",{style:{display:"flex",justifyContent:"center",gap:"1rem"},children:[(0,s.jsx)("button",{onClick:()=>{if(N){let{blockId:a,type:s}=N;if(console.log("\uD83D\uDEA8 Confirmando warning para bloque ".concat(a,", tipo: ").concat(s)),"finalizar"===s){console.log("\uD83C\uDFC1 Llamando finalizeBlock_".concat(a));let e=window["finalizeBlock_".concat(a)];e?(e(),console.log("✅ Funci\xf3n finalizeBlock_".concat(a," ejecutada"))):console.error("❌ Funci\xf3n finalizeBlock_".concat(a," no encontrada"))}else if("reiniciar"===s){var e,t;console.log("\uD83D\uDD04 Llamando resetBlock_".concat(a)),null===(e=(t=window)["resetBlock_".concat(a)])||void 0===e||e.call(t)}y(null)}},className:"continue-button",children:"✅ Continuar"}),(0,s.jsx)("button",{onClick:()=>y(null),className:"cancel-button",children:"❌ Cancelar"})]})]})})}),C&&k&&(0,s.jsx)("div",{className:"modal",children:(0,s.jsxs)("div",{className:"modal-content ".concat(c),children:[(0,s.jsx)("h2",{children:"✏️ Editar Bloque"}),(0,s.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:[(0,s.jsxs)("label",{children:["\uD83D\uDD22 Cantidad de Operaciones:",(0,s.jsx)("input",{type:"number",min:0,value:k.totalOperations,onChange:e=>T(t=>t?{...t,totalOperations:Number(e.target.value)}:null),className:"input-".concat(c)})]}),(0,s.jsxs)("label",{children:["⏱️ Duraci\xf3n:",(0,s.jsxs)("select",{value:k.serviceId,onChange:e=>T(t=>t?{...t,serviceId:Number(e.target.value)}:null),className:"input-".concat(c),children:[(0,s.jsx)("option",{value:334,children:"1h"}),(0,s.jsx)("option",{value:335,children:"1.30h"}),(0,s.jsx)("option",{value:336,children:"2h"}),(0,s.jsx)("option",{value:337,children:"2.30h"}),(0,s.jsx)("option",{value:338,children:"3h"}),(0,s.jsx)("option",{value:459,children:"4h"}),(0,s.jsx)("option",{value:460,children:"6h"}),(0,s.jsx)("option",{value:657,children:"8h"})]})]}),(0,s.jsx)("div",{style:{padding:"0.75rem",borderRadius:"0.5rem",background:"rgba(34, 197, 94, 0.1)",border:"1px solid rgba(34, 197, 94, 0.2)",color:"#16a34a"},children:(0,s.jsx)("p",{style:{fontSize:"0.875rem",fontWeight:"500"},children:"\uD83D\uDCA1 Solo m\xfaltiplos de 10 (ej: 30, 40, 100, 150...)"})}),(0,s.jsxs)("label",{children:["\uD83D\uDC65 Cantidad:",(0,s.jsx)("input",{type:"number",min:0,step:10,value:k.count,onChange:e=>T(t=>t?{...t,count:Number(e.target.value)}:null),className:"input-".concat(c," ").concat(k.count%10!=0?"input-error":"")})]}),(0,s.jsxs)("label",{children:["➕➖ Cantidad a Restar/Sumar:",(0,s.jsx)("input",{type:"number",min:0,step:10,value:k.decrement,onChange:e=>T(t=>t?{...t,decrement:Number(e.target.value)}:null),className:"input-".concat(c," ").concat(k.decrement%10!=0?"input-error":"")})]}),(0,s.jsxs)("label",{children:["\uD83D\uDD04 Operaci\xf3n:",(0,s.jsxs)("select",{value:k.operationType,onChange:e=>T(t=>t?{...t,operationType:e.target.value}:null),className:"input-".concat(c),children:[(0,s.jsx)("option",{value:"add",children:"➕ Sumar"}),(0,s.jsx)("option",{value:"subtract",children:"➖ Restar"})]})]}),(0,s.jsxs)("label",{children:["⏱️ Intervalo entre Operaciones:",(0,s.jsxs)("select",{value:k.intervalMinutes||2,onChange:e=>T(t=>t?{...t,intervalMinutes:Number(e.target.value)}:null),className:"input-".concat(c),children:[(0,s.jsx)("option",{value:2,children:"⏱️ 2 minutos"}),(0,s.jsx)("option",{value:3,children:"⏱️ 3 minutos"}),(0,s.jsx)("option",{value:4,children:"⏱️ 4 minutos"}),(0,s.jsx)("option",{value:5,children:"⏱️ 5 minutos"}),(0,s.jsx)("option",{value:10,children:"⏱️ 10 minutos"})]})]}),(0,s.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[(0,s.jsx)("input",{type:"checkbox",checked:k.autoStart,onChange:e=>T(t=>t?{...t,autoStart:e.target.checked}:null),style:{width:"1.25rem",height:"1.25rem"}}),(0,s.jsx)("span",{children:"\uD83D\uDD50 Inicio Autom\xe1tico"})]}),k.autoStart&&(0,s.jsxs)("label",{children:["⏰ Hora de Inicio:",(0,s.jsx)("input",{type:"time",value:k.startTime,onChange:e=>T(t=>t?{...t,startTime:e.target.value}:null),className:"input-".concat(c)})]})]}),(0,s.jsxs)("div",{style:{display:"flex",gap:"0.75rem",marginTop:"1.5rem"},children:[(0,s.jsx)("button",{onClick:()=>{if(C&&k){var e,t;if(k.count%10!=0||k.decrement%10!=0){alert("La cantidad y el decremento deben ser m\xfaltiplos de 10");return}let a={...k,intervalMinutes:k.intervalMinutes||2},{blockId:s}=C;null===(e=(t=window)["updateBlockData_".concat(s)])||void 0===e||e.call(t,a),S(null),T(null),E(s),setTimeout(()=>{let e=document.querySelector('[data-block-id="'.concat(s,'"]'));e&&e.scrollIntoView({behavior:"smooth",block:"center"})},100),setTimeout(()=>{E(null)},3e3)}},className:"save-button",children:"\uD83D\uDCBE Guardar"}),(0,s.jsx)("button",{onClick:()=>{S(null),T(null)},className:"cancel-button",children:"❌ Cancelar"})]})]})}),(0,s.jsx)(D,{isOpen:f,onDownloadFirst:()=>{w(!1),p(!0),alert('\uD83D\uDCA1 Dashboard de m\xe9tricas abierto. Descarga los reportes y luego usa "Reset All" nuevamente.')},onProceedAnyway:()=>{w(!1),confirm("\uD83D\uDEA8 CONFIRMACI\xd3N FINAL\n\nEsto eliminar\xe1 PERMANENTEMENTE:\n• Todos los estados de bloques actuales\n• Todo el historial de operaciones\n• Todo el historial de resets\n• Todas las m\xe9tricas acumuladas\n• Todos los datos de monitoreo de YouTube\n• Historial de streams monitoreados\n\n⚠️ Esta acci\xf3n NO se puede deshacer.\n\n\xbfEst\xe1s absolutamente seguro de continuar?")&&R()},onCancel:()=>{w(!1)},hasData:!0})]})};function w(){let{data:e,status:t}=(0,r.useSession)(),{theme:a,toggleTheme:u}=(0,i.F)(),h=(0,n.useRouter)(),[p,x]=(0,o.useState)(!1);return"loading"===t?(0,s.jsx)(l.Z,{}):e?(0,s.jsx)(m,{children:(0,s.jsxs)("div",{className:"flex flex-col min-h-screen transition-all duration-300 overflow-hidden ".concat("dark"===a?"bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 text-slate-100":"bg-gradient-to-br from-gray-50 via-white to-gray-50 text-gray-900"),children:[(0,s.jsxs)("header",{className:"w-full flex justify-between items-center p-4 lg:p-6 backdrop-blur-sm ".concat("dark"===a?"bg-slate-900/80 border-b border-slate-700/50":"bg-white/80 border-b border-gray-200/50 shadow-sm"),children:[(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,s.jsx)("button",{onClick:()=>x(!p),className:"lg:hidden px-3 py-2 rounded-xl font-medium transition-all duration-200 ".concat("dark"===a?"bg-slate-800 hover:bg-slate-700 text-slate-200 border border-slate-700":"bg-white hover:bg-gray-50 text-gray-700 border border-gray-200 shadow-sm"),children:(0,s.jsx)(c.G,{icon:p?d.NBC:d.xiG})}),(0,s.jsx)("h1",{className:"text-xl lg:text-3xl font-bold bg-gradient-to-r from-slate-600 via-slate-500 to-slate-600 bg-clip-text text-transparent",children:"ServiceDG Dashboard"})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2 lg:space-x-4",children:[(0,s.jsx)("button",{onClick:u,className:"px-3 py-2 lg:px-4 lg:py-2 rounded-xl font-medium transition-all duration-200 ".concat("dark"===a?"bg-slate-800 hover:bg-slate-700 text-slate-200 border border-slate-700":"bg-white hover:bg-gray-50 text-gray-700 border border-gray-200 shadow-sm"),children:"dark"===a?(0,s.jsx)(c.G,{icon:d.enB}):(0,s.jsx)(c.G,{icon:d.DBF})}),(0,s.jsx)("button",{onClick:()=>(0,r.signOut)({callbackUrl:"/"}),className:"px-4 py-2 lg:px-6 lg:py-2 rounded-xl font-medium bg-gradient-to-r from-red-500 to-red-600 text-white hover:from-red-600 hover:to-red-700 transition-all duration-200 shadow-lg hover:shadow-xl text-sm lg:text-base",children:"Cerrar sesi\xf3n"})]})]}),(0,s.jsxs)("div",{className:"flex flex-1 overflow-hidden relative",children:[p&&(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-40 lg:hidden",onClick:()=>x(!1)}),(0,s.jsx)("aside",{className:"\n              ".concat(p?"translate-x-0":"-translate-x-full"," \n              lg:translate-x-0 \n              fixed lg:relative\n              z-50 lg:z-auto\n              w-80 lg:w-64 xl:w-80 \n              flex-shrink-0 \n              flex flex-col \n              p-4 lg:p-6 \n              backdrop-blur-sm \n              overflow-y-auto \n              transition-transform duration-300 ease-in-out\n              h-full lg:h-auto\n              ").concat("dark"===a?"bg-slate-800/95 lg:bg-slate-800/60 border-r border-slate-700/50":"bg-white/95 lg:bg-white/80 border-r border-gray-200/50 shadow-sm","\n            "),children:(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"text-center mb-6 lg:mb-8",children:[(0,s.jsx)("div",{className:"w-12 h-12 lg:w-16 lg:h-16 bg-gradient-to-br from-blue-500 to-blue-600 rounded-2xl flex items-center justify-center mx-auto mb-4",children:(0,s.jsx)("span",{className:"text-white text-lg lg:text-2xl",children:"\uD83D\uDCCA"})}),(0,s.jsx)("h2",{className:"text-lg lg:text-xl font-bold mb-2",children:"Panel de Control"}),(0,s.jsx)("p",{className:"text-xs lg:text-sm ".concat("dark"===a?"text-slate-400":"text-gray-600"),children:"Gestiona tu dashboard"})]}),(0,s.jsx)("button",{className:"w-full p-3 lg:p-4 rounded-2xl font-medium transition-all duration-200 ".concat("dark"===a?"bg-slate-700/60 hover:bg-slate-600/80 text-slate-200 border border-slate-600/50":"bg-blue-50 hover:bg-blue-100 text-blue-700 border border-blue-200"),disabled:!0,children:(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("div",{className:"w-8 h-8 lg:w-10 lg:h-10 bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl flex items-center justify-center mr-3 lg:mr-4 flex-shrink-0",children:(0,s.jsx)("span",{className:"text-white text-xs lg:text-sm",children:"\uD83D\uDCC8"})}),(0,s.jsxs)("div",{className:"text-left min-w-0",children:[(0,s.jsx)("div",{className:"font-semibold text-sm lg:text-base",children:"Administrar Viewers"}),(0,s.jsx)("div",{className:"text-xs ".concat("dark"===a?"text-slate-500":"text-gray-500"),children:"Gesti\xf3n de datos"})]})]})}),(0,s.jsx)("button",{onClick:()=>{h.push("/pago"),x(!1)},className:"w-full p-3 lg:p-4 rounded-2xl font-medium transition-all duration-200 hover:scale-105 ".concat("dark"===a?"bg-slate-700/60 hover:bg-slate-600/80 text-slate-200 border border-slate-600/50 hover:border-green-500/50":"bg-green-50 hover:bg-green-100 text-green-700 border border-green-200 hover:border-green-400"),children:(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("div",{className:"w-8 h-8 lg:w-10 lg:h-10 bg-gradient-to-br from-green-500 to-green-600 rounded-xl flex items-center justify-center mr-3 lg:mr-4 flex-shrink-0",children:(0,s.jsx)("span",{className:"text-white text-xs lg:text-sm",children:"\uD83D\uDCB3"})}),(0,s.jsxs)("div",{className:"text-left min-w-0",children:[(0,s.jsx)("div",{className:"font-semibold text-sm lg:text-base",children:"Pagos"}),(0,s.jsx)("div",{className:"text-xs ".concat("dark"===a?"text-slate-500":"text-gray-500"),children:"M\xe9todos de pago"})]})]})})]})}),(0,s.jsx)("main",{className:"flex-1 flex flex-col items-center justify-start p-4 lg:p-8 overflow-auto",children:(0,s.jsx)("div",{className:"w-full max-w-none p-4 lg:p-8 rounded-2xl backdrop-blur-sm transition-all duration-300 ".concat("dark"===a?"bg-slate-800/60 border border-slate-700/50 shadow-2xl":"bg-white/80 border border-gray-200/50 shadow-xl"),children:(0,s.jsx)("div",{className:"w-full",children:(0,s.jsx)(f,{})})})})]}),(0,s.jsx)("footer",{className:"w-full p-4 lg:p-6 backdrop-blur-sm ".concat("dark"===a?"bg-slate-900/80 border-t border-slate-700/50":"bg-white/80 border-t border-gray-200/50 shadow-sm"),children:(0,s.jsx)("p",{className:"text-center text-xs lg:text-sm ".concat("dark"===a?"text-slate-400":"text-gray-600"),children:"\xa9 2025 ServiceDG. Todos los derechos reservados."})})]})}):(h.replace("/"),null)}},8901:function(e,t,a){"use strict";var s=a(7437);a(2265);var r=a(3145);a(290),t.Z=()=>(0,s.jsxs)("div",{className:"preloader-container",children:[(0,s.jsx)("div",{className:"preloader-logo",children:(0,s.jsx)(r.default,{src:"/servicedg-logo-professional.svg",alt:"ServiceDG",width:120,height:120,className:"preloader-image"})}),(0,s.jsx)("div",{className:"preloader-text",children:"ServiceDG Analytics"}),(0,s.jsx)("div",{className:"preloader-progress"})]})},4788:function(){},290:function(){},1934:function(){},5072:function(){},4965:function(){}},function(e){e.O(0,[396,464,676,425,755,605,145,971,117,744],function(){return e(e.s=6745)}),_N_E=e.O()}]);