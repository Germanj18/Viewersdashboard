"use strict";(()=>{var e={};e.id=147,e.ids=[147],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},92438:(e,s,t)=>{t.r(s),t.d(s,{originalPathname:()=>b,patchFetch:()=>f,requestAsyncStorage:()=>m,routeModule:()=>w,serverHooks:()=>g,staticGenerationAsyncStorage:()=>k});var r={};t.r(r),t.d(r,{DELETE:()=>p,GET:()=>u,POST:()=>d,PUT:()=>l});var a=t(49303),o=t(88716),n=t(60670),c=t(87070),i=t(88688);async function u(e){try{let{searchParams:s}=new URL(e.url),t=s.get("userId"),r="true"===s.get("activeOnly");if(!t)return c.NextResponse.json({success:!1,message:"userId is required"},{status:400});let a=r?{userId:t,isActive:!0,endTime:{gt:new Date}}:{userId:t},o=await i._.block.findMany({where:a,orderBy:{createdAt:"desc"},include:{operations:{orderBy:{timestamp:"desc"},take:5}}});return c.NextResponse.json({success:!0,blocks:o})}catch(e){return console.error("Get blocks error:",e),c.NextResponse.json({success:!1,message:"Failed to fetch blocks",error:e instanceof Error?e.message:"Unknown error"},{status:500})}}async function d(e){try{let{userId:s,name:t,viewers:r,minutes:a}=await e.json();if(!s||!t||!r||!a)return c.NextResponse.json({success:!1,message:"userId, name, viewers, and minutes are required"},{status:400});let o=new Date,n=new Date(o.getTime()+6e4*a),u=await i._.block.create({data:{userId:s,name:t,viewers:parseInt(r),minutes:parseInt(a),startTime:o,endTime:n}});return await i._.operation.create({data:{userId:s,blockId:u.id,type:"add",viewers:parseInt(r),description:`Block created: ${t}`}}),c.NextResponse.json({success:!0,message:"Block created successfully",block:u})}catch(e){return console.error("Create block error:",e),c.NextResponse.json({success:!1,message:"Failed to create block",error:e instanceof Error?e.message:"Unknown error"},{status:500})}}async function l(e){try{let{blockId:s,userId:t,action:r,viewers:a}=await e.json();if(!s||!t||!r)return c.NextResponse.json({success:!1,message:"blockId, userId, and action are required"},{status:400});let o=await i._.block.findFirst({where:{id:s,userId:t}});if(!o)return c.NextResponse.json({success:!1,message:"Block not found"},{status:404});switch(r){case"add_viewers":if(!a)return c.NextResponse.json({success:!1,message:"viewers amount is required for add_viewers action"},{status:400});let n=await i._.block.update({where:{id:s},data:{viewers:o.viewers+parseInt(a),updatedAt:new Date}});return await i._.operation.create({data:{userId:t,blockId:s,type:"add",viewers:parseInt(a),description:`Added ${a} viewers to ${o.name}`}}),c.NextResponse.json({success:!0,message:"Viewers added successfully",block:n});case"deactivate":let u=await i._.block.update({where:{id:s},data:{isActive:!1,endTime:new Date,updatedAt:new Date}});return await i._.operation.create({data:{userId:t,blockId:s,type:"subtract",viewers:0,description:`Block deactivated: ${o.name}`}}),c.NextResponse.json({success:!0,message:"Block deactivated successfully",block:u});default:return c.NextResponse.json({success:!1,message:"Invalid action"},{status:400})}}catch(e){return console.error("Update block error:",e),c.NextResponse.json({success:!1,message:"Failed to update block",error:e instanceof Error?e.message:"Unknown error"},{status:500})}}async function p(e){try{let{searchParams:s}=new URL(e.url),t=s.get("blockId"),r=s.get("userId");if(!t||!r)return c.NextResponse.json({success:!1,message:"blockId and userId are required"},{status:400});if(!await i._.block.findFirst({where:{id:t,userId:r}}))return c.NextResponse.json({success:!1,message:"Block not found"},{status:404});return await i._.block.delete({where:{id:t}}),c.NextResponse.json({success:!0,message:"Block deleted successfully"})}catch(e){return console.error("Delete block error:",e),c.NextResponse.json({success:!1,message:"Failed to delete block",error:e instanceof Error?e.message:"Unknown error"},{status:500})}}let w=new a.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/blocks/route",pathname:"/api/blocks",filename:"route",bundlePath:"app/api/blocks/route"},resolvedPagePath:"C:\\Users\\German\\Desktop\\Dashboard Viewers- LaCasa\\youtube-viewers-lacasa\\src\\app\\api\\blocks\\route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:m,staticGenerationAsyncStorage:k,serverHooks:g}=w,b="/api/blocks/route";function f(){return(0,n.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:k})}},88688:(e,s,t)=>{t.d(s,{_:()=>a});var r=t(53524);let a=globalThis.prisma??new r.PrismaClient({log:["query","info","warn","error"]})}};var s=require("../../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),r=s.X(0,[948,972],()=>t(92438));module.exports=r})();