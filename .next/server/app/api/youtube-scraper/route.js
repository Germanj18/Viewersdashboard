"use strict";(()=>{var e={};e.id=489,e.ids=[489],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},33890:(e,t,o)=>{o.r(t),o.d(t,{originalPathname:()=>R,patchFetch:()=>$,requestAsyncStorage:()=>E,routeModule:()=>S,serverHooks:()=>A,staticGenerationAsyncStorage:()=>L});var r={};o.r(r),o.d(r,{POST:()=>v});var n=o(49303),a=o(88716),i=o(60670),l=o(87070);let s=["Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/121.0.0.0 Safari/537.36","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36 Edg/120.0.0.0","Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/121.0.0.0 Safari/537.36","Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:122.0) Gecko/20100101 Firefox/122.0","Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.2.1 Safari/605.1.15","Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/121.0.0.0 Safari/537.36"],c=0;async function u(){let e=Math.floor(1500*Math.random())+500;console.log(`‚è≥ Aplicando delay anti-detecci\xf3n: ${e}ms`),await new Promise(t=>setTimeout(t,e))}function d(e){let t=Date.now();if(t-c<2e3){let e=2e3-(t-c);console.log(`üõ°Ô∏è Rate limiting activo - esperando ${e}ms`)}c=t;let o=s[Math.floor(Math.random()*s.length)],r={"User-Agent":o,Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7","Accept-Language":"es-ES,es;q=0.9,en-US;q=0.8,en;q=0.7","Accept-Encoding":"gzip, deflate, br",DNT:"1",Connection:"keep-alive","Upgrade-Insecure-Requests":"1","Sec-Fetch-Dest":"document","Sec-Fetch-Mode":"navigate","Sec-Fetch-Site":e?"same-origin":"none","Sec-Fetch-User":"?1","Cache-Control":"max-age=0","sec-ch-ua":'"Not_A Brand";v="8", "Chromium";v="120", "Google Chrome";v="120"',"sec-ch-ua-mobile":"?0","sec-ch-ua-platform":'"Windows"'};return e&&(r.Referer=e),r.Cookie="YSC=DwKYllHNwuw; VISITOR_INFO1_LIVE=Gt6OEzkgVQg; PREF=f4=4000000&tz=America.Argentina.Buenos_Aires",console.log(`üîÑ Usando User-Agent: ${o.substring(0,50)}...`),r}async function f(e,t={},o=3){for(let r=1;r<=o;r++)try{console.log(`üåê Intento ${r}/${o} - Fetching: ${e}`),r>1&&await u();let n=d(e.includes("youtube.com")?"https://www.youtube.com":void 0),a=await fetch(e,{...t,headers:{...n,...t.headers},signal:AbortSignal.timeout(15e3)});if(a.ok)return console.log(`‚úÖ Request exitoso en intento ${r}`),a;if(429===a.status){let e=a.headers.get("retry-after"),t=e?1e3*parseInt(e):5e3+2e3*r;console.log(`‚ö†Ô∏è Rate limit detectado (429) - esperando ${t}ms antes del siguiente intento`),await new Promise(e=>setTimeout(e,t));continue}if(403===a.status||404===a.status)return console.log(`‚ùå Error ${a.status} - no reintentando`),a;if(console.log(`‚ö†Ô∏è Intento ${r} fall\xf3 con status ${a.status}`),r<o){let e=1e3*r+2e3*Math.random();console.log(`‚è≥ Esperando ${e}ms antes del siguiente intento...`),await new Promise(t=>setTimeout(t,e))}}catch(t){if(console.log(`‚ùå Error en intento ${r}:`,t),r===o)throw t;let e=2e3*r+3e3*Math.random();console.log(`‚è≥ Esperando ${e}ms antes del siguiente intento...`),await new Promise(t=>setTimeout(t,e))}throw Error(`Fall\xf3 despu\xe9s de ${o} intentos`)}async function v(e){try{let t;let{url:o,mode:r="video"}=await e.json();if(!o)return l.NextResponse.json({status:"error",message:"URL de YouTube requerida",viewers:0,isLive:!1,title:"",timestamp:new Date().toISOString(),url:""},{status:400});return console.log(`üîç Iniciando scraping con anti-detecci\xf3n - Modo: ${r}, URL: ${o}`),t="channel"===r?await p(o):await g(o),console.log("‚úÖ Scraping completado:",t),l.NextResponse.json(t)}catch(e){return console.error("‚ùå Error en scraping de YouTube:",e),l.NextResponse.json({status:"error",message:e instanceof Error?e.message:"Error desconocido",viewers:0,isLive:!1,title:"",timestamp:new Date().toISOString(),url:""},{status:500})}}async function g(e){try{if(console.log("\uD83C\uDFAF Iniciando scraping con anti-detecci\xf3n para:",e),!/^(https?:\/\/)?(www\.)?(youtube\.com|youtu\.be)\/.+$/.test(e))throw Error("URL de YouTube inv\xe1lida");await u();let t=await f(e);if(!t.ok)throw Error(`HTTP ${t.status}: ${t.statusText}`);let o=await t.text();if(o.includes("blocked")||o.includes("captcha")||o.includes("unusual traffic")){console.log("‚ö†Ô∏è Posible bloqueo detectado - ajustando estrategia"),await new Promise(e=>setTimeout(e,5e3));let t=await f(e,{headers:{...d("https://www.google.com"),Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8"}});if(t.ok){let o=await t.text();return C(o,e)}}return C(o,e)}catch(t){return console.error("‚ùå Error en scrapeVideoData:",t),{viewers:0,isLive:!1,title:"",status:"error",message:`Error: ${t instanceof Error?t.message:"Error desconocido"}`,timestamp:new Date().toISOString(),url:e}}}async function p(e){try{console.log("\uD83D\uDD0D Buscando streams en vivo en canal:",e);let t=e;t.startsWith("http")||(t=`https://www.youtube.com/${t.replace(/^[@\/]/,"@")}`),console.log("\uD83D\uDD17 URL normalizada:",t),t.includes("somoslacasa")&&console.log("\uD83C\uDFE0 Detectado canal de prueba @somoslacasa - logs detallados activados");let o=[async()=>await w(t),async()=>await m(t),async()=>await h(t),async()=>await y(t)];for(let e=0;e<o.length;e++){console.log(`üîé Ejecutando estrategia ${e+1}/4...`);try{let r=await o[e]();if(r){console.log("‚úÖ Stream en vivo encontrado con estrategia",e+1,":",r);let o=await g(r);return o.redirectedUrl=r,o.channelName=await D(t),console.log("\uD83D\uDCCA Datos del stream:",{title:o.title,viewers:o.viewers,isLive:o.isLive,channelName:o.channelName}),o}console.log(`‚ùå Estrategia ${e+1} no encontr\xf3 streams en vivo`)}catch(t){console.warn(`‚ö†Ô∏è Estrategia ${e+1} fall\xf3:`,t)}}let r=await D(t);return console.log("‚ùå No se encontraron streams en vivo en el canal:",r),{viewers:0,isLive:!1,title:`${r} - Sin streams en vivo`,status:"success",message:"No se encontr\xf3 ning\xfan stream en vivo en este canal actualmente",timestamp:new Date().toISOString(),url:e,channelName:r}}catch(t){return console.error("‚ùå Error buscando stream en canal:",t),{viewers:0,isLive:!1,title:"",status:"error",message:`Error buscando stream en canal: ${t instanceof Error?t.message:"Error desconocido"}`,timestamp:new Date().toISOString(),url:e}}}async function w(e){try{console.log("\uD83D\uDCFA Buscando en p\xe1gina principal del canal...");let t=await f(e);if(!t.ok)return null;let o=await t.text();return I(o,e)}catch(e){return console.error("Error en searchInChannelHome:",e),null}}async function m(e){try{console.log("\uD83D\uDD34 Buscando en p\xe1gina /live del canal...");let t=`${e}/live`;console.log("\uD83D\uDD17 URL de live:",t);let o=await f(t);if(!o.ok)return console.log(`‚ö†Ô∏è Response not ok: ${o.status} ${o.statusText}`),null;if(console.log("‚úÖ Response OK, analizando respuesta..."),console.log("\uD83D\uDD17 Final URL:",o.url),o.url.includes("/watch?v=")){console.log("‚úÖ Redirecci\xf3n directa a video detectada");let e=o.url.match(/watch\?v=([a-zA-Z0-9_-]{11})/);if(e&&e[1]){let t=`https://www.youtube.com/watch?v=${e[1]}`;return console.log("‚úÖ Video en vivo encontrado por redirecci\xf3n:",t),t}}let r=await o.text();if(console.log("\uD83D\uDCC4 HTML recibido, tama\xf1o:",r.length),r.includes("This channel is not live")||r.includes("No live streams")||r.includes("isn't live right now"))return console.log("‚ùå Canal no est\xe1 en vivo seg\xfan la p\xe1gina /live"),null;return I(r,e)}catch(e){return console.error("Error en searchInChannelLive:",e),null}}async function h(e){try{console.log("\uD83D\uDCF9 Buscando en p\xe1gina de videos del canal...");let t=`${e}/videos`,o=await f(t);if(!o.ok)return null;let r=await o.text();return I(r,e)}catch(e){return console.error("Error en searchInChannelVideos:",e),null}}async function y(e){try{console.log("\uD83D\uDCE1 Buscando en RSS feed del canal...");let t=await b(e);if(!t)return null;let o=`https://www.youtube.com/feeds/videos.xml?channel_id=${t}`,r=await f(o);if(!r.ok)return null;let n=(await r.text()).match(/<yt:videoId>([^<]+)<\/yt:videoId>/g);if(n)for(let e of n.slice(0,5)){let t=e.replace(/<\/?yt:videoId>/g,""),o=`https://www.youtube.com/watch?v=${t}`,r=await x(o);if(r?.isLive)return o}return null}catch(e){return console.error("Error en searchInChannelRSS:",e),null}}async function D(e){try{let t=await f(e);if(!t.ok)return"Canal de YouTube";let o=await t.text();for(let e of[/<meta property="og:title" content="([^"]+)"/,/<title[^>]*>([^<]+)<\/title>/,/"title":"([^"]+)"/]){let t=o.match(e);if(t)return t[1].replace(" - YouTube","").trim()}return"Canal de YouTube"}catch(e){return console.error("Error extrayendo nombre del canal:",e),"Canal de YouTube"}}async function b(e){try{let t=e.match(/\/channel\/([UC][a-zA-Z0-9_-]+)/);if(t)return t[1];if(e.includes("/@")){let t=await f(e);if(t.ok){let e=(await t.text()).match(/"channelId":"([UC][a-zA-Z0-9_-]+)"/);if(e)return e[1]}}return null}catch(e){return console.error("Error extrayendo channel ID:",e),null}}async function x(e){try{let t=await f(e);if(!t.ok)return null;let o=await t.text();return{isLive:[/"isLiveContent":true/i,/"isLive":true/i,/watching now/i,/viewers watching/i].some(e=>e.test(o))}}catch(e){return console.error("Error en quickCheckIfLive:",e),null}}function I(e,t){try{for(let t of(console.log("\uD83D\uDD0D Analizando HTML para encontrar streams en vivo..."),[/href="\/watch\?v=([a-zA-Z0-9_-]{11})[^"]*"[^>]*>[^<]*(?:LIVE|EN VIVO|üî¥|DIRECTO|Live)/i,/href="\/watch\?v=([a-zA-Z0-9_-]{11})[^"]*"[^>]*data-live="true"/i,/"videoId":"([a-zA-Z0-9_-]{11})"[^}]*"isLive":true/,/"videoId":"([a-zA-Z0-9_-]{11})"[^}]*"isLiveContent":true/,/"videoId":"([a-zA-Z0-9_-]{11})"[^}]*"watching"/i,/"videoId":"([a-zA-Z0-9_-]{11})"[^}]*"viewers"/i,/"videoId":"([a-zA-Z0-9_-]{11})"[^}]*"liveBadgeRenderer"/i])){let o;let r=new RegExp(t.source,t.flags.includes("g")?t.flags:t.flags+"g");for(;null!==(o=r.exec(e));)if(o&&o[1]){let e=o[1];return console.log("‚úÖ Video ID encontrado con patr\xf3n directo:",e),`https://www.youtube.com/watch?v=${e}`}}let t=e.match(/var ytInitialData = ({[\s\S]*?});/);if(t)try{console.log("\uD83D\uDD0D Analizando ytInitialData...");let e=JSON.parse(t[1]),o=function e(t){if(!t||"object"!=typeof t)return null;if(t.videoId){if(t.isLive||t.isLiveContent||t.isLiveNow)return console.log("‚úÖ Video en vivo encontrado por isLive:",t.videoId),t.videoId;if(t.viewCountText&&"object"==typeof t.viewCountText){let e=t.viewCountText.simpleText||t.viewCountText.runs?.[0]?.text||"";if(/watching|viewers/i.test(e))return console.log("‚úÖ Video en vivo encontrado por viewCountText:",t.videoId),t.videoId}if(t.badges)for(let e of t.badges){if(e.liveBadgeRenderer)return console.log("‚úÖ Video en vivo encontrado por liveBadgeRenderer:",t.videoId),t.videoId;if(e.metadataBadgeRenderer&&e.metadataBadgeRenderer.label&&/live|en vivo|directo/i.test(e.metadataBadgeRenderer.label))return console.log("‚úÖ Video en vivo encontrado por badge label:",t.videoId),t.videoId}if(t.thumbnailOverlays){for(let e of t.thumbnailOverlays)if(e.thumbnailOverlayTimeStatusRenderer&&"LIVE"===e.thumbnailOverlayTimeStatusRenderer.style)return console.log("‚úÖ Video en vivo encontrado por thumbnailOverlay:",t.videoId),t.videoId}}if(t.tabRenderer&&t.tabRenderer.content){let o=e(t.tabRenderer.content);if(o)return o}if(t.richGridRenderer){let o=e(t.richGridRenderer);if(o)return o}for(let o of["contents","items","videos","tabs","richItemRenderer","videoRenderer"])if(t[o]){let r=t[o];if(Array.isArray(r))for(let t of r){let o=e(t);if(o)return o}else if("object"==typeof r&&null!==r){let t=e(r);if(t)return t}}return null}(e);if(o)return console.log("‚úÖ Video ID encontrado en ytInitialData:",o),`https://www.youtube.com/watch?v=${o}`}catch(e){console.warn("Error parseando ytInitialData:",e)}for(let t of[/class="[^"]*live[^"]*"[^>]*href="\/watch\?v=([a-zA-Z0-9_-]{11})"/i,/href="\/watch\?v=([a-zA-Z0-9_-]{11})"[^>]*>[^<]*(\d+[KM]?\s*(?:watching|viewers))/i,/watch\?v=([a-zA-Z0-9_-]{11})[^"]*"[^>]*>[^<]*(?:üî¥|live|LIVE|EN VIVO)/i]){let o=e.match(t);if(o&&o[1]){let e=o[1];return console.log("‚úÖ Video ID encontrado con patr\xf3n HTML:",e),`https://www.youtube.com/watch?v=${e}`}}return console.log("‚ùå No se encontraron streams en vivo en la p\xe1gina del canal"),null}catch(e){return console.error("Error en extractLiveVideoFromChannelPage:",e),null}}function C(e,t){try{let o="";for(let t of[/<meta property="og:title" content="([^"]+)"/i,/"title":"([^"]+)"[^}]*"isLive":true/i,/"title":"([^"]+)"[^}]*"isLiveContent":true/i,/<title[^>]*>([^<]+)<\/title>/i]){let r=e.match(t);if(r&&r[1]&&(o=r[1].replace(" - YouTube","").replace(/\\u([0-9a-fA-F]{4})/g,(e,t)=>String.fromCharCode(parseInt(t,16))).replace(/\\"/g,'"').trim())&&"YouTube"!==o){console.log(`üìù T\xedtulo extra\xeddo: "${o}"`);break}}if(!o||"YouTube"===o){let t=e.match(/var ytInitialData = ({[\s\S]*?});/);if(t)try{let e=JSON.parse(t[1]),r=function e(t){if(!t||"object"!=typeof t)return null;if(t.title){if("string"==typeof t.title)return t.title;if(t.title.simpleText)return t.title.simpleText;if(t.title.runs&&t.title.runs[0]&&t.title.runs[0].text)return t.title.runs[0].text}if(t.videoDetails&&t.videoDetails.title)return t.videoDetails.title;for(let o of Object.values(t))if(Array.isArray(o))for(let t of o){let o=e(t);if(o)return o}else if("object"==typeof o&&null!==o){let t=e(o);if(t)return t}return null}(e);r&&(o=r,console.log(`üìù T\xedtulo extra\xeddo de ytInitialData: "${o}"`))}catch(e){console.warn("Error parseando ytInitialData para t\xedtulo:",e)}}o&&"YouTube"!==o||(o="Stream de YouTube");let r=[/watching now/i,/viewers watching/i,/en directo/i,/live now/i,/"isLiveContent":true/i,/"isLive":true/i].some(t=>t.test(e)),n=0;if(r){for(let t of[/"viewCount":{"videoViewCountRenderer":{"viewCount":{"simpleText":"([^"]+)"/,/"concurrentViewers":"([^"]+)"/,/"watching now"/i,/(\d+(?:,\d+)*)\s*watching/i,/(\d+(?:,\d+)*)\s*viewers?/i,/(\d+(?:\.\d+)?[KMB]?)\s*watching/i,/(\d+(?:\.\d+)?[KMB]?)\s*viewers?/i]){let o=e.match(t);if(o){let e=o[1];if((n=T(e))>0){console.log(`üë• Viewers encontrados con patr\xf3n: ${e} ‚Üí ${n}`);break}}}if(0===n){let t=e.match(/var ytInitialData = ({.*?});/);if(t)try{let e=JSON.parse(t[1]);n=function e(t){if(!t||"object"!=typeof t)return 0;for(let e of["concurrentViewers","viewCount","watching","viewers"])if(t[e]){let o="object"==typeof t[e]?t[e].simpleText||t[e].runs?.[0]?.text:t[e];if(o){let e=T(o.toString());if(e>0)return e}}for(let o of Object.values(t))if("object"==typeof o&&null!==o){let t=e(o);if(t>0)return t}return 0}(e)}catch(e){console.warn("Error parseando ytInitialData:",e)}}}else for(let t of[/(\d+(?:,\d+)*)\s*views?/i,/(\d+(?:\.\d+)?[KMB]?)\s*views?/i,/"viewCount":"([^"]+)"/]){let o=e.match(t);if(o&&(n=T(o[1]))>0)break}return{viewers:n,isLive:r,title:o,status:"success",timestamp:new Date().toISOString(),url:t}}catch(e){return console.error("Error extrayendo datos:",e),{viewers:0,isLive:!1,title:"",status:"error",message:"Error procesando respuesta de YouTube",timestamp:new Date().toISOString(),url:t}}}function T(e){if(!e)return 0;e=e.replace(/[^\d,.KMB]/gi,"");let t={K:1e3,M:1e6,B:1e9},o=e.match(/^([\d,.]+)([KMB])?$/i);if(o){let e=parseFloat(o[1].replace(/,/g,"")),r=o[2]?.toUpperCase();return r&&t[r]&&(e*=t[r]),Math.round(e)}let r=e.match(/[\d,]+/);return r&&parseInt(r[0].replace(/,/g,""),10)||0}let S=new n.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/youtube-scraper/route",pathname:"/api/youtube-scraper",filename:"route",bundlePath:"app/api/youtube-scraper/route"},resolvedPagePath:"C:\\Users\\German\\Desktop\\Dashboard Viewers- LaCasa\\youtube-viewers-lacasa\\src\\app\\api\\youtube-scraper\\route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:E,staticGenerationAsyncStorage:L,serverHooks:A}=S,R="/api/youtube-scraper/route";function $(){return(0,i.patchFetch)({serverHooks:A,staticGenerationAsyncStorage:L})}}};var t=require("../../../webpack-runtime.js");t.C(e);var o=e=>t(t.s=e),r=t.X(0,[948,972],()=>o(33890));module.exports=r})();