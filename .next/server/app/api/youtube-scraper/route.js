"use strict";(()=>{var e={};e.id=489,e.ids=[489],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},33890:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>C,patchFetch:()=>L,requestAsyncStorage:()=>I,routeModule:()=>E,serverHooks:()=>S,staticGenerationAsyncStorage:()=>x});var o={};r.r(o),r.d(o,{POST:()=>c});var n=r(49303),a=r(88716),i=r(60670),s=r(87070);async function c(e){try{let t;let{url:r,mode:o="video"}=await e.json();if(!r)return s.NextResponse.json({status:"error",message:"URL de YouTube requerida",viewers:0,isLive:!1,title:"",timestamp:new Date().toISOString(),url:""},{status:400});return console.log(`üîç Iniciando scraping de YouTube - Modo: ${o}, URL: ${r}`),t="channel"===o?await u(r):await l(r),console.log("‚úÖ Scraping completado:",t),s.NextResponse.json(t)}catch(e){return console.error("‚ùå Error en scraping de YouTube:",e),s.NextResponse.json({status:"error",message:e instanceof Error?e.message:"Error desconocido",viewers:0,isLive:!1,title:"",timestamp:new Date().toISOString(),url:""},{status:500})}}async function l(e){try{console.log("\uD83C\uDFAF Monitoreando video espec\xedfico:",e);let t=await y(e);if(t.isLive)return console.log("‚úÖ Video est\xe1 en vivo"),t;return console.log("‚ö†Ô∏è Video no est\xe1 en vivo"),{...t,message:"El video no est\xe1 en vivo actualmente."}}catch(t){return console.error("‚ùå Error monitoreando video:",t),{viewers:0,isLive:!1,title:"",status:"error",message:`Error monitoreando video: ${t instanceof Error?t.message:"Error desconocido"}`,timestamp:new Date().toISOString(),url:e}}}async function u(e){try{console.log("\uD83D\uDD0D Buscando streams en vivo en canal:",e);let t=e;t.startsWith("http")||(t=`https://www.youtube.com/${t.replace(/^[@\/]/,"@")}`);let r=[async()=>await d(t),async()=>await f(t),async()=>await h(t),async()=>await v(t)];for(let e=0;e<r.length;e++){console.log(`üîé Ejecutando estrategia ${e+1}...`);try{let o=await r[e]();if(o){console.log("‚úÖ Stream en vivo encontrado:",o);let e=await y(o);return e.redirectedUrl=o,e.channelName=await w(t),e}}catch(t){console.warn(`‚ö†Ô∏è Estrategia ${e+1} fall\xf3:`,t)}}let o=await w(t);return{viewers:0,isLive:!1,title:`${o} - Sin streams en vivo`,status:"success",message:"No se encontr\xf3 ning\xfan stream en vivo en este canal",timestamp:new Date().toISOString(),url:e,channelName:o}}catch(t){return console.error("‚ùå Error buscando stream en canal:",t),{viewers:0,isLive:!1,title:"",status:"error",message:`Error buscando stream en canal: ${t instanceof Error?t.message:"Error desconocido"}`,timestamp:new Date().toISOString(),url:e}}}async function d(e){try{console.log("\uD83D\uDCFA Buscando en p\xe1gina principal del canal...");let t=await fetch(e,{headers:D(),method:"GET"});if(!t.ok)return null;let r=await t.text();return g(r,e)}catch(e){return console.error("Error en searchInChannelHome:",e),null}}async function f(e){try{console.log("\uD83D\uDD34 Buscando en p\xe1gina /live del canal...");let t=`${e}/live`,r=await fetch(t,{headers:D(),method:"GET"});if(!r.ok)return null;let o=await r.text();if(r.url.includes("/watch?v="))return r.url;return g(o,e)}catch(e){return console.error("Error en searchInChannelLive:",e),null}}async function h(e){try{console.log("\uD83D\uDCF9 Buscando en p\xe1gina de videos del canal...");let t=`${e}/videos`,r=await fetch(t,{headers:D(),method:"GET"});if(!r.ok)return null;let o=await r.text();return g(o,e)}catch(e){return console.error("Error en searchInChannelVideos:",e),null}}async function v(e){try{console.log("\uD83D\uDCE1 Buscando en RSS feed del canal...");let t=await p(e);if(!t)return null;let r=`https://www.youtube.com/feeds/videos.xml?channel_id=${t}`,o=await fetch(r,{headers:D(),method:"GET"});if(!o.ok)return null;let n=(await o.text()).match(/<yt:videoId>([^<]+)<\/yt:videoId>/g);if(n)for(let e of n.slice(0,5)){let t=e.replace(/<\/?yt:videoId>/g,""),r=`https://www.youtube.com/watch?v=${t}`,o=await m(r);if(o?.isLive)return r}return null}catch(e){return console.error("Error en searchInChannelRSS:",e),null}}async function w(e){try{let t=await fetch(e,{headers:D(),method:"GET"});if(!t.ok)return"Canal de YouTube";let r=await t.text();for(let e of[/<meta property="og:title" content="([^"]+)"/,/<title[^>]*>([^<]+)<\/title>/,/"title":"([^"]+)"/]){let t=r.match(e);if(t)return t[1].replace(" - YouTube","").trim()}return"Canal de YouTube"}catch(e){return console.error("Error extrayendo nombre del canal:",e),"Canal de YouTube"}}async function p(e){try{let t=e.match(/\/channel\/([UC][a-zA-Z0-9_-]+)/);if(t)return t[1];if(e.includes("/@")){let t=await fetch(e,{headers:D(),method:"GET"});if(t.ok){let e=(await t.text()).match(/"channelId":"([UC][a-zA-Z0-9_-]+)"/);if(e)return e[1]}}return null}catch(e){return console.error("Error extrayendo channel ID:",e),null}}async function m(e){try{let t=await fetch(e,{headers:D(),method:"GET"});if(!t.ok)return null;let r=await t.text();return{isLive:[/"isLiveContent":true/i,/"isLive":true/i,/watching now/i,/viewers watching/i].some(e=>e.test(r))}}catch(e){return console.error("Error en quickCheckIfLive:",e),null}}function g(e,t){try{for(let t of(console.log("\uD83D\uDD0D Analizando HTML para encontrar streams en vivo..."),[/href="\/watch\?v=([a-zA-Z0-9_-]{11})[^"]*"[^>]*>[^<]*(?:LIVE|EN VIVO|üî¥|DIRECTO)/i,/href="\/watch\?v=([a-zA-Z0-9_-]{11})[^"]*"[^>]*data-live="true"/i,/"videoId":"([a-zA-Z0-9_-]{11})"[^}]*"isLive":true/g,/"videoId":"([a-zA-Z0-9_-]{11})"[^}]*"isLiveContent":true/g])){let r=e.match(t);if(r&&r[1]){let e=r[1];return console.log("‚úÖ Video ID encontrado con patr\xf3n directo:",e),`https://www.youtube.com/watch?v=${e}`}}let t=e.match(/var ytInitialData = ({[\s\S]*?});/);if(t)try{console.log("\uD83D\uDD0D Analizando ytInitialData...");let e=JSON.parse(t[1]),r=function e(t){if(!t||"object"!=typeof t)return null;if(t.videoId&&(t.isLive||t.isLiveContent))return t.videoId;if(t.videoId&&t.badges){for(let e of t.badges)if(e.liveBadgeRenderer||e.metadataBadgeRenderer&&e.metadataBadgeRenderer.label&&/live|en vivo/i.test(e.metadataBadgeRenderer.label))return t.videoId}for(let r of Object.values(t))if(Array.isArray(r))for(let t of r){let r=e(t);if(r)return r}else if("object"==typeof r&&null!==r){let t=e(r);if(t)return t}return null}(e);if(r)return console.log("‚úÖ Video ID encontrado en ytInitialData:",r),`https://www.youtube.com/watch?v=${r}`}catch(e){console.warn("‚ùå Error parseando ytInitialData:",e)}let r=new Set;for(let t of[/\/watch\?v=([a-zA-Z0-9_-]{11})/g,/"videoId":"([a-zA-Z0-9_-]{11})"/g]){let o;for(;null!==(o=t.exec(e));)o[1]&&r.add(o[1]),t.lastIndex===o.index&&t.lastIndex++;t.lastIndex=0}for(let t of Array.from(r).slice(0,10)){let r=function(e,t){let r=e.indexOf(t);if(-1===r)return"";let o=Math.min(e.length,r+500);return e.substring(Math.max(0,r-500),o)}(e,t);if(function(e){return[/live/i,/en vivo/i,/directo/i,/watching/i,/viewers/i,/üî¥/,/"isLive":true/i,/"isLiveContent":true/i,/badge.*live/i].some(t=>t.test(e))}(r))return console.log("‚úÖ Video ID encontrado por contexto:",t),`https://www.youtube.com/watch?v=${t}`}for(let t of[/LIVE<\/span>[^<]*<[^>]*href="\/watch\?v=([a-zA-Z0-9_-]{11})"/i,/EN VIVO<\/span>[^<]*<[^>]*href="\/watch\?v=([a-zA-Z0-9_-]{11})"/i,/üî¥[^<]*<[^>]*href="\/watch\?v=([a-zA-Z0-9_-]{11})"/i]){let r=e.match(t);if(r&&r[1])return console.log("‚úÖ Video ID encontrado por indicador:",r[1]),`https://www.youtube.com/watch?v=${r[1]}`}return console.log("‚ùå No se encontraron streams en vivo en la p\xe1gina"),null}catch(e){return console.error("‚ùå Error extrayendo video en vivo:",e),null}}async function y(e){try{if(!/^(https?:\/\/)?(www\.)?(youtube\.com|youtu\.be)\/.+$/.test(e))throw Error("URL de YouTube inv\xe1lida");let t=await fetch(e,{headers:D(),method:"GET"});if(!t.ok)throw Error(`HTTP ${t.status}: ${t.statusText}`);let r=await t.text();return function(e,t){try{let r="",o=e.match(/<title[^>]*>([^<]+)<\/title>/i);o&&(r=o[1].replace(" - YouTube","").trim());let n=[/watching now/i,/viewers watching/i,/en directo/i,/live now/i,/"isLiveContent":true/i,/"isLive":true/i].some(t=>t.test(e)),a=0;if(n){for(let t of[/"viewCount":{"videoViewCountRenderer":{"viewCount":{"simpleText":"([^"]+)"/,/"concurrentViewers":"([^"]+)"/,/"watching now"/i,/(\d+(?:,\d+)*)\s*watching/i,/(\d+(?:,\d+)*)\s*viewers?/i,/(\d+(?:\.\d+)?[KMB]?)\s*watching/i,/(\d+(?:\.\d+)?[KMB]?)\s*viewers?/i]){let r=e.match(t);if(r){let e=r[1];if((a=b(e))>0){console.log(`ÔøΩ Viewers encontrados con patr\xf3n: ${e} ‚Üí ${a}`);break}}}if(0===a){let t=e.match(/var ytInitialData = ({.*?});/);if(t)try{let e=JSON.parse(t[1]);a=function e(t){if(!t||"object"!=typeof t)return 0;for(let e of["concurrentViewers","viewCount","watching","viewers"])if(t[e]){let r="object"==typeof t[e]?t[e].simpleText||t[e].runs?.[0]?.text:t[e];if(r){let e=b(r.toString());if(e>0)return e}}for(let r of Object.values(t))if("object"==typeof r&&null!==r){let t=e(r);if(t>0)return t}return 0}(e)}catch(e){console.warn("Error parseando ytInitialData:",e)}}}else for(let t of[/(\d+(?:,\d+)*)\s*views?/i,/(\d+(?:\.\d+)?[KMB]?)\s*views?/i,/"viewCount":"([^"]+)"/]){let r=e.match(t);if(r&&(a=b(r[1]))>0)break}return{viewers:a,isLive:n,title:r,status:"success",timestamp:new Date().toISOString(),url:t}}catch(e){return console.error("Error extrayendo datos:",e),{viewers:0,isLive:!1,title:"",status:"error",message:"Error procesando respuesta de YouTube",timestamp:new Date().toISOString(),url:t}}}(r,e)}catch(t){return console.error("‚ùå Error haciendo scraping del video:",t),{viewers:0,isLive:!1,title:"",status:"error",message:t instanceof Error?t.message:"Error desconocido",timestamp:new Date().toISOString(),url:e}}}function D(){return{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36",Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8","Accept-Language":"es-ES,es;q=0.9,en;q=0.8","Accept-Encoding":"gzip, deflate, br",Connection:"keep-alive","Upgrade-Insecure-Requests":"1","Cache-Control":"no-cache","Sec-Fetch-Dest":"document","Sec-Fetch-Mode":"navigate","Sec-Fetch-Site":"none"}}function b(e){if(!e)return 0;e=e.replace(/[^\d,.KMB]/gi,"");let t={K:1e3,M:1e6,B:1e9},r=e.match(/^([\d,.]+)([KMB])?$/i);if(r){let e=parseFloat(r[1].replace(/,/g,"")),o=r[2]?.toUpperCase();return o&&t[o]&&(e*=t[o]),Math.round(e)}let o=e.match(/[\d,]+/);return o&&parseInt(o[0].replace(/,/g,""),10)||0}let E=new n.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/youtube-scraper/route",pathname:"/api/youtube-scraper",filename:"route",bundlePath:"app/api/youtube-scraper/route"},resolvedPagePath:"C:\\Users\\German\\Desktop\\Dashboard Viewers- LaCasa\\youtube-viewers-lacasa\\src\\app\\api\\youtube-scraper\\route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:I,staticGenerationAsyncStorage:x,serverHooks:S}=E,C="/api/youtube-scraper/route";function L(){return(0,i.patchFetch)({serverHooks:S,staticGenerationAsyncStorage:x})}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[948,972],()=>r(33890));module.exports=o})();