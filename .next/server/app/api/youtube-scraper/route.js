"use strict";(()=>{var e={};e.id=489,e.ids=[489],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},33890:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>m,patchFetch:()=>f,requestAsyncStorage:()=>l,routeModule:()=>p,serverHooks:()=>w,staticGenerationAsyncStorage:()=>d});var i={};r.r(i),r.d(i,{POST:()=>u});var o=r(49303),s=r(88716),a=r(60670),n=r(87070);async function u(e){try{let{url:t}=await e.json();if(!t)return n.NextResponse.json({status:"error",message:"URL de YouTube requerida",viewers:0,isLive:!1,title:"",timestamp:new Date().toISOString(),url:""},{status:400});if(!/^(https?:\/\/)?(www\.)?(youtube\.com|youtu\.be)\/.+$/.test(t))return n.NextResponse.json({status:"error",message:"URL de YouTube inv\xe1lida",viewers:0,isLive:!1,title:"",timestamp:new Date().toISOString(),url:t},{status:400});console.log("\uD83D\uDD0D Iniciando scraping de YouTube:",t);let r=await fetch(t,{headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36",Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8","Accept-Language":"es-ES,es;q=0.9,en;q=0.8","Accept-Encoding":"gzip, deflate, br",Connection:"keep-alive","Upgrade-Insecure-Requests":"1","Cache-Control":"no-cache"},method:"GET"});if(!r.ok)throw Error(`HTTP ${r.status}: ${r.statusText}`);let i=await r.text(),o=function(e,t){try{let r="",i=e.match(/<title[^>]*>([^<]+)<\/title>/i);i&&(r=i[1].replace(" - YouTube","").trim());let o=[/watching now/i,/viewers watching/i,/en directo/i,/live now/i,/"isLiveContent":true/i,/"isLive":true/i].some(t=>t.test(e)),s=0;if(o){for(let t of[/"viewCount":{"videoViewCountRenderer":{"viewCount":{"simpleText":"([^"]+)"/,/"concurrentViewers":"([^"]+)"/,/"watching now"/i,/(\d+(?:,\d+)*)\s*watching/i,/(\d+(?:,\d+)*)\s*viewers?/i,/(\d+(?:\.\d+)?[KMB]?)\s*watching/i,/(\d+(?:\.\d+)?[KMB]?)\s*viewers?/i]){let r=e.match(t);if(r){let e=r[1];if((s=c(e))>0){console.log(`� Viewers encontrados con patr\xf3n: ${e} → ${s}`);break}}}if(0===s){let t=e.match(/var ytInitialData = ({.*?});/);if(t)try{let e=JSON.parse(t[1]);s=function e(t){if(!t||"object"!=typeof t)return 0;for(let e of["concurrentViewers","viewCount","watching","viewers"])if(t[e]){let r="object"==typeof t[e]?t[e].simpleText||t[e].runs?.[0]?.text:t[e];if(r){let e=c(r.toString());if(e>0)return e}}for(let r of Object.values(t))if("object"==typeof r&&null!==r){let t=e(r);if(t>0)return t}return 0}(e)}catch(e){console.warn("Error parseando ytInitialData:",e)}}}else for(let t of[/(\d+(?:,\d+)*)\s*views?/i,/(\d+(?:\.\d+)?[KMB]?)\s*views?/i,/"viewCount":"([^"]+)"/]){let r=e.match(t);if(r&&(s=c(r[1]))>0)break}return{viewers:s,isLive:o,title:r,status:"success",timestamp:new Date().toISOString(),url:t}}catch(e){return console.error("Error extrayendo datos:",e),{viewers:0,isLive:!1,title:"",status:"error",message:"Error procesando respuesta de YouTube",timestamp:new Date().toISOString(),url:t}}}(i,t);return console.log("✅ Scraping completado:",o),n.NextResponse.json(o)}catch(e){return console.error("❌ Error en scraping de YouTube:",e),n.NextResponse.json({status:"error",message:e instanceof Error?e.message:"Error desconocido",viewers:0,isLive:!1,title:"",timestamp:new Date().toISOString(),url:""},{status:500})}}function c(e){if(!e)return 0;e=e.replace(/[^\d,.KMB]/gi,"");let t={K:1e3,M:1e6,B:1e9},r=e.match(/^([\d,.]+)([KMB])?$/i);if(r){let e=parseFloat(r[1].replace(/,/g,"")),i=r[2]?.toUpperCase();return i&&t[i]&&(e*=t[i]),Math.round(e)}let i=e.match(/[\d,]+/);return i&&parseInt(i[0].replace(/,/g,""),10)||0}let p=new o.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/youtube-scraper/route",pathname:"/api/youtube-scraper",filename:"route",bundlePath:"app/api/youtube-scraper/route"},resolvedPagePath:"C:\\Users\\German\\Desktop\\Dashboard Viewers- LaCasa\\youtube-viewers-lacasa\\src\\app\\api\\youtube-scraper\\route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:l,staticGenerationAsyncStorage:d,serverHooks:w}=p,m="/api/youtube-scraper/route";function f(){return(0,a.patchFetch)({serverHooks:w,staticGenerationAsyncStorage:d})}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),i=t.X(0,[948,972],()=>r(33890));module.exports=i})();