"use strict";(()=>{var e={};e.id=623,e.ids=[623],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},85810:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>h,patchFetch:()=>m,requestAsyncStorage:()=>d,routeModule:()=>c,serverHooks:()=>f,staticGenerationAsyncStorage:()=>g});var a={};r.r(a),r.d(a,{GET:()=>p});var s=r(49303),o=r(88716),n=r(60670),i=r(87070);function u(e){let t=Object.prototype.toString.call(e);return e instanceof Date||"object"==typeof e&&"[object Date]"===t?new e.constructor(+e):new Date("number"==typeof e||"[object Number]"===t||"string"==typeof e||"[object String]"===t?e:NaN)}let l=new(r(53524)).PrismaClient;async function p(e){let{searchParams:t}=new URL(e.url),r=t.get("start"),a=t.get("end");if(!r||!a)return i.NextResponse.json({error:"Faltan par\xe1metros de fecha"},{status:400});try{let e=new Date(r),t=new Date(a);t.setHours(23,59,59,999),console.log("Fechas recibidas:",{startDate:e,endDate:t});let s=(function(e,t){let r=u(e.start),a=u(e.end),s=+r>+a,o=s?+r:+a,n=s?a:r;n.setHours(0,0,0,0);let i=(void 0)??1;if(!i)return[];i<0&&(i=-i,s=!s);let l=[];for(;+n<=o;)l.push(u(n)),n.setDate(n.getDate()+i),n.setHours(0,0,0,0);return s?l.reverse():l})({start:e,end:t}).filter(e=>{let t=u(e).getDay();return 0!==t&&6!==t});console.log("Fechas filtradas (lunes a viernes):",s);let o=await l.programas.findMany({where:{fecha:{gte:e,lte:t}},orderBy:{fecha:"asc"}}),n=s.map(e=>{let t=o.filter(t=>t.fecha.toISOString().split("T")[0]===e.toISOString().split("T")[0]),r=t.filter(e=>e.total>1e3),a=r.length>0?r.reduce((e,t)=>e+t.total,0)/r.length:0;return{fecha:e,avg_total:a,dayData:t}});return console.log("Datos agrupados por d\xeda:",n),i.NextResponse.json(n,{status:200})}catch(e){return console.error("Error al consultar los datos:",e),i.NextResponse.json({error:"Error al consultar los datos"},{status:500})}}let c=new s.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/queryMaxViewers/route",pathname:"/api/queryMaxViewers",filename:"route",bundlePath:"app/api/queryMaxViewers/route"},resolvedPagePath:"C:\\Users\\German\\Desktop\\Dashboard Viewers- LaCasa\\youtube-viewers-lacasa\\src\\app\\api\\queryMaxViewers\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:d,staticGenerationAsyncStorage:g,serverHooks:f}=c,h="/api/queryMaxViewers/route";function m(){return(0,n.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:g})}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[948,972],()=>r(85810));module.exports=a})();